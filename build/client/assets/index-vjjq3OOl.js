import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-Bk2QJ2_x.js";import{A as N,C as S}from"./ContentLayout-DJkdQ0NX.js";import{u as v}from"./AuthContext-Dy_OYH0z.js";import{j as E,o as I,I as R,H as T}from"./lib-BG3QhE8T.js";import{z as d,u as A,s as L}from"./index-BH1rD2l9.js";import{I as j,B as U}from"./Input-DEGqe8hg.js";import{f as V,g as _}from"./WhiteLogo-CopYdH_8.js";import{u as k}from"./NotificationContext-C3CTMWMc.js";import{C as B}from"./CardHeader-BwI3w6Z4.js";import"./UserMenu-nNvVXzjp.js";import"./index-CZzcNMWS.js";import"./index-DnjbWNXW.js";import"./HomeNav-DPSRur1x.js";import"./SrchNavbar-Rer4twtT.js";import"./json-IagZRcWu.js";import"./index-DjxDxbeq.js";import"./HamburgerSecondary-DNdyeqp7.js";import"./CardTitle-e_7rmtxE.js";const b=new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!()Â£@$%^&*-]).{8,}$/),F=d.object({oldpassword:d.string().min(1,{message:"Please enter old password."}).min(8,{message:"Password must be up to 8 characters."}).regex(b,{message:"Please enter a valid password"}),newpassword:d.string().min(1,{message:"Please enter new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(b,{message:"Please enter a valid password"}),newpassword2:d.string().min(1,{message:"Please retype new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(b,{message:"Please enter a valid password"})}).superRefine((r,s)=>{r.oldpassword===r.newpassword&&s.addIssue({code:d.ZodIssueCode.custom,path:["newpassword"],message:"New password cannot be the same as old password"}),r.newpassword!==r.newpassword2&&s.addIssue({code:d.ZodIssueCode.custom,path:["newpd2"],message:"Your new password don't match"})}),H=({loaderData:r,user:s})=>{var y;const[a,g]=t.useState(null),[n,p]=t.useState(!1),l=k(),c=o=>{let x=o.target.value,P=o.target.name;g(u=>({...u,[P]:x}))},w=async o=>{var u;p(!0),l.notify("In progress..."),await new Promise(i=>setTimeout(i,1e3));const x="/api/user/change_password/"+((u=r.userProfile)==null?void 0:u.user_guid),P=I.BASE_URL+x;o.password=o==null?void 0:o.newpassword,delete o.oldpassword,delete o.newpassword,delete o.newpassword2;try{const i=await fetch(P,{method:"PUT",headers:E,body:JSON.stringify(o)});if(i.ok)l.alertReload("Success","Password Successfully Changed! Use new password on next login");else{let q=i.json().then(C=>{l.alertCancel("",C.message)})}}catch(i){l.alertCancel("",i.message)}finally{p(!1)}},{register:m,handleSubmit:f,getValues:W,setValue:Z,watch:$,setError:z,formState:{errors:h,isSubmitting:D}}=A({defaultValues:r.listing,resolver:L(F)});return e.jsx("form",{onSubmit:f(w),children:e.jsx("div",{className:`${V} mt-0  
            rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:_,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Change Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(y=r.userProfile)==null?void 0:y.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(j,{controlTitle:"Current Password",controlPlaceholder:"Enter current password",controlType:"password",controlName:"oldpassword",register:m,changeHandler:c,error:h.oldpassword}),e.jsx(j,{controlTitle:"New Password",controlType:"password",controlPlaceholder:"Enter new password",controlName:"newpassword",register:m,changeHandler:c,error:h.newpassword}),e.jsx(j,{controlTitle:"Retype New Password",controlPlaceholder:"Retype new password",controlName:"newpassword2",controlType:"password",register:m,changeHandler:c,error:h.newpassword2}),e.jsx(U,{working:n})]})})})},me=()=>{t.useEffect(()=>{R(localStorage)},[]);const r=v();if(!r)return null;const{user:s}=r,[a,g]=t.useState(null),[n,p]=t.useState(null),[l,c]=t.useState(!0);return t.useEffect(()=>{async function w(m){const f=await T(m||"");g(f)}s!=null&&s.guid&&w(s==null?void 0:s.guid)},[s==null?void 0:s.guid]),t.useEffect(()=>{a&&p({userProfile:a})},[a]),t.useEffect(()=>{n&&c(!1)},[n]),l?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(N,{children:e.jsxs(S,{title:"Change Password",children:[a===null?"Loading...":"",e.jsx(B,{base_url:"/web/account/profile",title:a==null?void 0:a.email}),n&&e.jsx(H,{loaderData:n,user:s})]})})};export{me as default};
