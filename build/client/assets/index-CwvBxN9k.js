import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-qdL6XBti.js";import{A as N}from"./AccountLayout-DqEKwYFJ.js";import{u as C}from"./AuthContext-BnKqVxnU.js";import{p as A,z as L,I,j as R}from"./lib-gdbuLEb8.js";import{u as U,s as q}from"./zod-g2XesUsp.js";import{I as _,B as k}from"./Input-BGESB1pz.js";import{z as S}from"./index-C4bLmoCR.js";import{f as B,g as F}from"./WhiteLogo-BTe8ysqQ.js";import{u as T}from"./NotificationContext-BN71CfFW.js";import{P as V}from"./ProfileContentLayout-BTr2le8U.js";import"./UserMenu-CECLlKRK.js";import"./index-CeMHKdet.js";import"./HomeNav-CYWF0wT0.js";import"./SrchNavbar-AcngZQKL.js";import"./json-BNowKBeR.js";import"./BusinessMenu-CriD0Rgx.js";const W=S.object({email:S.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),z=({loaderData:a,user:t})=>{var h,j;const[n,d]=s.useState(null),[r,l]=s.useState(!1),i=T(),[x,f]=s.useState(!0),m=o=>{let E=o.target.value,g=o.target.name;d(u=>({...u,[g]:E}))},p=async o=>{var u,b;if(l(!0),i.notify("","Updating email..."),await new Promise(c=>setTimeout(c,1e3)),o.email===((u=a.userProfile)==null?void 0:u.email))return i.alertCancel("Email is the same.","Enter a different email to continue."),l(!1),!1;const g=L.BASE_URL+"/api/user/change_email_request";o.guid=(b=a.userProfile)==null?void 0:b.user_guid;try{const c=await fetch(g,{method:"POST",headers:A,body:JSON.stringify(o)});if(c.ok)i.alertCancel("Email Change Request","Email Change Request Successfully Sent!");else{let G=c.json().then(w=>{i.alertCancel("Error",w.error)})}}catch{return}finally{l(!1)}},{register:y,handleSubmit:P,getValues:O,setValue:H,watch:J,setError:$,formState:{errors:v,isSubmitting:D}}=U({defaultValues:a.listing,resolver:q(W)});return e.jsx("form",{onSubmit:P(p),children:e.jsx("div",{className:`${B} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:F,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(h=a.userProfile)==null?void 0:h.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-full px-3 py-3 bg-gray-50",children:[(j=a.userProfile)==null?void 0:j.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(_,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:y,changeHandler:m,error:v.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(k,{working:r})]})})})},ue=()=>{s.useEffect(()=>{I(localStorage)},[]);const a=C();if(!a)return null;const{user:t}=a,[n,d]=s.useState(null),[r,l]=s.useState(null),[i,x]=s.useState(!0);return s.useEffect(()=>{async function f(m){const p=await R(m||"");d(p)}try{t!=null&&t.guid&&f(t==null?void 0:t.guid)}catch(m){console.log(m.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{n&&l({userProfile:n})},[n]),s.useEffect(()=>{r&&x(!1)},[r]),i?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(N,{children:e.jsxs(V,{title:"Email Address",children:[n===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md"}),r&&e.jsx(z,{loaderData:r,user:t})]})})};export{ue as default};
