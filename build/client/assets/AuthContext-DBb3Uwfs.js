import{j as y}from"./jsx-runtime-0DLF9kdB.js";import{r as l,a as v}from"./components-DN9bEK-g.js";import{h as c}from"./lib-0UoF-2jt.js";const f=l.createContext(null),h="https://garssete.gasimg.com";function _(){return l.useContext(f)}function b({children:d}){let[E,r]=l.useState(null),[p,a]=l.useState(null);const m=async s=>{try{let t=h+"/api/user/verifytoken";const e=await fetch(t,{method:"POST",headers:c,body:JSON.stringify({token:s})});if(e.status!==200)throw new Error("Could not obtain token");return await e.json()}catch(o){return console.log(o.message),alert(o.message),null}};l.useEffect(()=>{const s=localStorage.getItem("authTokens");if(s!==null){const e=JSON.parse(s);r(e)}else r(null);if(s){const u=JSON.parse(s).accessToken;m(u).then(n=>{n===null?(r(null),a(null),localStorage.removeItem("authTokens")):a(n)})}else a(null);T(!1);let o=1e3*60*60*12,t=setInterval(()=>{g()},o);return()=>clearInterval(t)},[]);let[P,T]=l.useState(!0);const S=h+"/api/user/signin";v();let k=async s=>{try{const o=await fetch(S,{method:"POST",headers:c,body:JSON.stringify(s)});let t=await o.json();return o.status===200?(r(t),m(t.accessToken).then(e=>{a(e)}),localStorage.setItem("authTokens",JSON.stringify(t)),new Promise(e=>{setTimeout(()=>{e(!0)},100)})):new Promise(e=>{setTimeout(()=>{e(t)},100)})}catch{return new Promise(t=>{setTimeout(()=>{t(!1)},100)})}};const g=()=>{r(null),a(null),localStorage.removeItem("authTokens")};let w={user:p,signin:k,signoutNoReload:g,signoutReload:()=>{r(null),a(null),localStorage.removeItem("authTokens"),window.location.reload()},resetpw:async s=>{const e="https://garssete.gasimg.com"+"/api/user/reset_password_request";try{const n=await fetch(e,{method:"POST",headers:c,body:JSON.stringify(s)});var u=await n.json();if(n.ok)return new Promise(i=>{setTimeout(()=>{i(u.message)},100)});throw new Error(`Error Code: ${n.status} - ${u.message}`)}catch(n){return new Promise(i=>{setTimeout(()=>{i(n.message)},100)})}finally{}}};return y.jsx(f.Provider,{value:w,children:d})}export{b as A,_ as u};
