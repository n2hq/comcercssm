import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t,a as B,c as A}from"./components-CCwaTRgT.js";import{U as O,p as I,J as C,L as U,N as k,S as z}from"./lib-B-TVjvlj.js";import{A as F}from"./AccountLayout-5U_AUe5s.js";import{C as J}from"./ContentLayout-CM9186i0.js";import{u as V}from"./AuthContext-Crea6u0m.js";import{u as R,s as W}from"./zod-PtQGc9r6.js";import{I as L,B as $}from"./Input-BRG1qQUx.js";import{u as G}from"./NotificationContext-Bgz3_41l.js";import{z as S}from"./index-C4bLmoCR.js";import{u as H}from"./OperationContext-CaoUEJma.js";import"./UserMenu-C2Rk3u9z.js";import"./WhiteLogo-BBidgNJe.js";import"./index-C7mLXbsN.js";import"./HomeNav-DE440SxH.js";import"./SrchNavbar-DscsmWtA.js";import"./HamburgerSecondary-Bmo0MaKr.js";import"./json-DW8pLu6r.js";import"./BusinessMenu-BPCH-skN.js";const Y=/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).{8,}$/,Z=S.object({confirm_delete:S.string().refine(a=>a==="DELETE",{message:'You must type "DELETE" to confirm'}),password:S.string({message:"Please enter a password"}).min(8,"Password must be at least 8 characters").regex(Y,"Please enter a valid password")}),q=({userGuid:a,businessGuid:m})=>{const[p,g]=t.useState(null),[o,h]=t.useState(!0);G();const n=B(),[j,c]=t.useState(!1),[d,i]=t.useState(null),{showOperation:w,showError:v,completeOperation:u,showSuccess:l}=H(),f=r=>{let b=r.target.value,E=r.target.name;i(s=>({...s,[E]:b}))},x=async r=>{c(!0),w("processing"),await new Promise(s=>setTimeout(s,1e3)),r.user_guid=a;const b="/api/listing/delete_business/"+m,E=C.BASE_URL+b;try{const s=await fetch(E,{method:"PUT",headers:I,body:JSON.stringify(r)});if(s.status!==200){const y=await s.text(),N=JSON.parse(y);let _=N.message||N.error;throw new Error(`${_}`)}else try{l("Success","Page Deleted."),await new Promise(y=>setTimeout(y,3e3)),u()}finally{n("/web/account/portfolio")}}catch(s){console.log(s.message),v("Error",s.message||s.error||"Delete failed."),u()}},{register:P,handleSubmit:T,getValues:K,setValue:M,watch:Q,setError:X,formState:{errors:D,isSubmitting:ee}}=R({defaultValues:{},resolver:W(Z)});return t.useEffect(()=>{try{O(a,m).then(r=>{g(r[0].active_status),h(!1)})}catch{alert("Could not fetch business")}},[]),o?e.jsx("div",{children:"Loading..."}):e.jsx("div",{children:e.jsx("form",{className:" w-full",onSubmit:T(x),children:e.jsxs("div",{className:`p-6  rounded  max-w-2xl
        mx-auto mt-12`,children:[e.jsx("h2",{className:"text-lg mb-4 font-semibold",children:"Delete this Business or Organization"}),e.jsx("p",{className:"mb-4 text-gray-500",children:"Once you delete this business, it cannot be undone. Every resource or item entered under this business will be deleted completely and will not be recoverable."}),e.jsxs("div",{className:"border-[3px] border-gray-100 pt-5 pl-5 pr-5 rounded-lg shadow",children:[e.jsx(L,{controlTitle:"Confirm Delete",controlPlaceholder:'Type the word "DELETE"',controlName:"confirm_delete",register:P,controlType:"text",changeHandler:f,error:D.confirm_delete,controlInformation:"Please enter password to delete this business."}),e.jsx(L,{controlTitle:"Password",controlPlaceholder:"Enter password",controlName:"password",register:P,controlType:"password",changeHandler:f,error:D.password,controlInformation:"Please enter password to delete this business."}),e.jsx($,{value:"Delete Business",working:!1})]})]})})})},Ee=()=>{t.useEffect(()=>{U(localStorage)},[]);const[a,m]=t.useState(!0),[p,g]=t.useState(null),[o,h]=t.useState(""),[n,j]=t.useState(""),{business_guid:c,user_guid:d}=A(),[i,w]=t.useState(null);return V()?(t.useEffect(()=>{const u=async(l,f)=>{h(l),j(f);const x=await z(l||"");w(x)};try{c&&d&&u(c,d)}catch(l){k(l)}},[c,d]),t.useEffect(()=>{o&&n&&i&&(g({businessGuid:o,userGuid:n,businessProfile:i}),m(!1))},[o,n,i]),a?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(F,{children:e.jsx(J,{title:"Delete Business Profile",businessGuid:o,data:p,businessProfile:i,children:p&&e.jsx(q,{userGuid:n,businessGuid:o})})})):null};export{Ee as default};
