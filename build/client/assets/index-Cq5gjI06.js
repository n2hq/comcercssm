import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-qdL6XBti.js";import{A as S}from"./AccountLayout-DbrzReIn.js";import{u as C}from"./AuthContext-C3M4QnT1.js";import{p as v,z as E,I,j as R}from"./lib-ClTvlenw.js";import{u as T,s as A}from"./zod-g2XesUsp.js";import{I as j,B as L}from"./Input-CH_zuSnr.js";import{z as d}from"./index-C4bLmoCR.js";import{f as U,g as V}from"./WhiteLogo-BbkPtNln.js";import{u as k}from"./NotificationContext-DWfQct5-.js";import{P as z}from"./ProfileContentLayout-CVRPkJwn.js";import"./UserMenu-DhuDjlu1.js";import"./index-DBZSphUT.js";import"./HomeNav-DquwwIxa.js";import"./SrchNavbar-BSFAt3zc.js";import"./json-CS1Ohf1x.js";import"./BusinessMenu-CGE5pLZJ.js";const y=new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!()Â£@$%^&*-]).{8,}$/),B=d.object({oldpassword:d.string().min(1,{message:"Please enter old password."}).min(8,{message:"Password must be up to 8 characters."}).regex(y,{message:"Please enter a valid password"}),newpassword:d.string().min(1,{message:"Please enter new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(y,{message:"Please enter a valid password"}),newpassword2:d.string().min(1,{message:"Please retype new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(y,{message:"Please enter a valid password"})}).superRefine((r,e)=>{r.oldpassword===r.newpassword&&e.addIssue({code:d.ZodIssueCode.custom,path:["newpassword"],message:"New password cannot be the same as old password"}),r.newpassword!==r.newpassword2&&e.addIssue({code:d.ZodIssueCode.custom,path:["newpd2"],message:"Your new password don't match"})}),F=({loaderData:r,user:e})=>{var b;const[c,f]=t.useState(null),[a,u]=t.useState(!1),l=k(),m=o=>{let x=o.target.value,P=o.target.name;f(w=>({...w,[P]:x}))},p=async o=>{var w;u(!0),l.notify("In progress..."),await new Promise(i=>setTimeout(i,1e3));const x="/api/user/change_password/"+((w=r.userProfile)==null?void 0:w.user_guid),P=E.BASE_URL+x;o.password=o==null?void 0:o.newpassword,delete o.oldpassword,delete o.newpassword,delete o.newpassword2;try{const i=await fetch(P,{method:"PUT",headers:v,body:JSON.stringify(o)});if(i.ok)l.alertReload("Success","Password Successfully Changed! Use new password on next login");else{let q=i.json().then(N=>{l.alertCancel("",N.message)})}}catch(i){l.alertCancel("",i.message)}finally{u(!1)}},{register:n,handleSubmit:g,getValues:W,setValue:Z,watch:_,setError:$,formState:{errors:h,isSubmitting:D}}=T({defaultValues:r.listing,resolver:A(B)});return s.jsx("form",{onSubmit:g(p),children:s.jsx("div",{className:`${U} mt-0  
            rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:s.jsxs("div",{className:V,children:[s.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Change Password"}),s.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[s.jsx("b",{children:(b=r.userProfile)==null?void 0:b.email})," is your current email. It will be used be used for password resets or changes."]}),s.jsx("div",{className:"mt-[20px]"}),s.jsx(j,{controlTitle:"Current Password",controlPlaceholder:"Enter current password",controlType:"password",controlName:"oldpassword",register:n,changeHandler:m,error:h.oldpassword}),s.jsx(j,{controlTitle:"New Password",controlType:"password",controlPlaceholder:"Enter new password",controlName:"newpassword",register:n,changeHandler:m,error:h.newpassword}),s.jsx(j,{controlTitle:"Retype New Password",controlPlaceholder:"Retype new password",controlName:"newpassword2",controlType:"password",register:n,changeHandler:m,error:h.newpassword2}),s.jsx(L,{working:a})]})})})},ie=()=>{t.useEffect(()=>{I(localStorage)},[]);const r=C();if(!r)return null;const{user:e}=r,[c,f]=t.useState(null),[a,u]=t.useState(null),[l,m]=t.useState(!0);return t.useEffect(()=>{async function p(n){const g=await R(n||"");f(g)}try{e!=null&&e.guid&&p(e==null?void 0:e.guid)}catch(n){console.log(n.message)}},[e==null?void 0:e.guid]),t.useEffect(()=>{if(c&&e){const p={userProfile:c,...e};u(p)}},[c,e]),t.useEffect(()=>{a&&m(!1)},[a]),l?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(S,{children:s.jsxs(z,{title:"Change Password",data:a,children:[c===null?"Loading...":"",a&&s.jsx(F,{loaderData:a,user:e})]})})};export{ie as default};
