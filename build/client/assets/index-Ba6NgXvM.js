import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t,u as N,b as A}from"./components-CooaLra5.js";import{a1 as _,l as L,x as T,I,A as O}from"./lib-Cg9WoxhQ.js";import{A as k,C}from"./ContentLayout-D07V8mcl.js";import{B as z,a as F}from"./BusinessHeader-3Xg_4em3.js";import{u as U}from"./AuthContext-JHB1Dy7Y.js";import{u as V,s as H}from"./zod-CNQGm8c5.js";import{I as P,B as J}from"./Input-B6TYey88.js";import{u as R}from"./NotificationContext-CM1puaMG.js";import{z as y}from"./index-C4bLmoCR.js";import"./UserMenu-mWxpW0M8.js";import"./WhiteLogo-B6c8rBbr.js";import"./index-Da5aMTHl.js";import"./HomeNav-DEEYgHYx.js";import"./SrchNavbar-DtqWKNpp.js";import"./HamburgerSecondary-Dt26qOcl.js";import"./json-PjGSZg5X.js";import"./CardTitle-ii5rf5je.js";const W=/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).{8,}$/,$=y.object({confirm_delete:y.string().refine(n=>n==="DELETE",{message:'You must type "DELETE" to confirm'}),password:y.string({message:"Please enter a password"}).min(8,"Password must be at least 8 characters").regex(W,"Please enter a valid password")}),G=({userGuid:n,businessGuid:u})=>{const[d,f]=t.useState(null),[s,p]=t.useState(!0),r=R(),g=N(),[m,l]=t.useState(!1),[i,h]=t.useState(null),x=o=>{let j=o.target.value,E=o.target.name;h(a=>({...a,[E]:j}))},w=async o=>{l(!0),r.notify("Deleting business..."),await new Promise(a=>setTimeout(a,1e3)),o.user_guid=n;const j="/api/listing/delete_business/"+u,E=T.BASE_URL+j;try{const a=await fetch(E,{method:"PUT",headers:L,body:JSON.stringify(o)});if(a.ok)r.cancel(),g("/web/account/portfolio");else{const D=await a.text(),B=JSON.parse(D);throw new Error(`${B.error}`)}}catch{}},{register:c,handleSubmit:b,getValues:v,setValue:M,watch:Y,setError:Z,formState:{errors:S,isSubmitting:q}}=V({defaultValues:{},resolver:H($)});return t.useEffect(()=>{try{_(n,u).then(o=>{f(o[0].active_status),p(!1)})}catch{alert("Could not fetch business")}},[]),s?e.jsx("div",{children:"Loading..."}):e.jsx("div",{children:e.jsx("form",{className:" w-full",onSubmit:b(w),children:e.jsxs("div",{className:`p-6  rounded  max-w-2xl
        mx-auto mt-12`,children:[e.jsx("h2",{className:"text-lg mb-4 font-semibold",children:"Delete this Business or Organization"}),e.jsx("p",{className:"mb-4 text-gray-500",children:"Once you delete this business, it cannot be undone. Every resource or item entered under this business will be deleted completely and will not be recoverable."}),e.jsxs("div",{className:"border-[3px] border-gray-100 pt-5 pl-5 pr-5 rounded-lg shadow",children:[e.jsx(P,{controlTitle:"Confirm Delete",controlPlaceholder:'Type the word "DELETE"',controlName:"confirm_delete",register:c,controlType:"text",changeHandler:x,error:S.confirm_delete,controlInformation:"Please enter password to delete this business."}),e.jsx(P,{controlTitle:"Password",controlPlaceholder:"Enter password",controlName:"password",register:c,controlType:"password",changeHandler:x,error:S.password,controlInformation:"Please enter password to delete this business."}),e.jsx(J,{value:"Delete Business",working:!1})]})]})})})},ge=()=>{t.useEffect(()=>{I(localStorage)},[]);const[n,u]=t.useState(!0),[d,f]=t.useState(null),[s,p]=t.useState(""),[r,g]=t.useState(""),{business_guid:m,user_guid:l}=A(),[i,h]=t.useState(null);return U()?(t.useEffect(()=>{m&&l&&(async(c,b)=>{p(c),g(b);const v=await O(c||"");h(v)})(m,l)},[m,l]),t.useEffect(()=>{s&&r&&i&&(f({businessGuid:s,userGuid:r,businessProfile:i}),u(!1))},[s,r,i]),n?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(k,{children:e.jsxs(C,{title:"Delete Business Profile",businessGuid:s,data:d,businessProfile:i,children:[e.jsx(z,{businessGuid:s,data:d,businessProfile:i}),s&&r&&e.jsx(F,{guid:s,userGuid:r}),d&&e.jsx(G,{userGuid:r,businessGuid:s})]})})):null};export{ge as default};
