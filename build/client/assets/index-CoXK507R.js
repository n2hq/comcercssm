import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-CCwaTRgT.js";import{A as C}from"./AccountLayout-CXqZGER3.js";import{u as I}from"./AuthContext-CvE59IA2.js";import{p as O,J as k,L as U,m as W}from"./lib-D8ORuzEY.js";import{u as _,s as q}from"./zod-PtQGc9r6.js";import{I as B,B as F}from"./Input-DIbCFyon.js";import{z as S}from"./index-C4bLmoCR.js";import{f as R,g as T}from"./WhiteLogo-gEYeivBz.js";import{u as V}from"./NotificationContext-vMvOhavO.js";import{u as J}from"./OperationContext-CaoUEJma.js";import{P as z}from"./ProfileContentLayout-slp7e9-w.js";import"./UserMenu-BsBedOLT.js";import"./index-D0Bf6ERf.js";import"./HomeNav-DzANm2OX.js";import"./SrchNavbar-ClpRmELQ.js";import"./HamburgerSecondary-CfJsLndv.js";import"./json-DR30y5fg.js";import"./BusinessMenu-DWxSIaW1.js";const H=S.object({email:S.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),$=({loaderData:r,user:t})=>{var E,j;const[i,p]=s.useState(null),[a,n]=s.useState(!1);V();const[h,x]=s.useState(!0),{showOperation:u,showSuccess:l,showError:m,showWarning:D,showInfo:G,completeOperation:d}=J(),P=o=>{let w=o.target.value,g=o.target.name;p(f=>({...f,[g]:w}))},y=async o=>{var f,b;if(n(!0),u("processing"),await new Promise(c=>setTimeout(c,1e3)),o.email===((f=r.userProfile)==null?void 0:f.email))return m("Error","Email is in use. Enter a new email."),d(),n(!1),!1;const g=k.BASE_URL+"/api/user/change_email_request";o.guid=(b=r.userProfile)==null?void 0:b.user_guid;try{const c=await fetch(g,{method:"POST",headers:O,body:JSON.stringify(o)});if(c.ok)l("Success","Please check your new email to continue."),d();else{let Z=c.json().then(A=>{m("Error",A.message),d()})}}catch{m("Error","Change request failed"),d()}finally{n(!1)}},{register:v,handleSubmit:N,getValues:K,setValue:M,watch:Q,setError:X,formState:{errors:L,isSubmitting:Y}}=_({defaultValues:r.listing,resolver:q(H)});return e.jsx("form",{onSubmit:N(y),children:e.jsx("div",{className:`${R} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:T,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(E=r.userProfile)==null?void 0:E.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-full px-3 py-3 bg-gray-50",children:[(j=r.userProfile)==null?void 0:j.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(B,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:v,changeHandler:P,error:L.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(F,{working:a})]})})})},je=()=>{s.useEffect(()=>{U(localStorage)},[]);const r=I();if(!r)return null;const{user:t}=r,[i,p]=s.useState(null),[a,n]=s.useState(null),[h,x]=s.useState(!0);return s.useEffect(()=>{async function u(l){const m=await W(l||"");p(m)}try{t!=null&&t.guid&&u(t==null?void 0:t.guid)}catch(l){console.log(l.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{i&&n({userProfile:i})},[i]),s.useEffect(()=>{a&&x(!1)},[a]),h?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(C,{children:e.jsxs(z,{title:"Email Address",children:[i===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md"}),a&&e.jsx($,{loaderData:a,user:t})]})})};export{je as default};
