import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-kAvIA9Ge.js";import{A as V,C as q}from"./ContentLayout-Bxcpe8UR.js";import{z as n,u as H,s as K}from"./index-CLh2UBG4.js";import{I as b,B as Z}from"./Input-mt8WJjzD.js";import{S as z}from"./Select-BeTJtSHp.js";import{h as Q,q as O,r as W,i as X,u as Y,p as ee,s as te,t as se,x as oe}from"./index-BKi4tw_A.js";import{u as $}from"./NotificationContext-BnBjis1x.js";import{f as D,e as ae,a as ne}from"./css-DMkAD1zc.js";import"./MobileNav-WD4SLO32.js";import"./Hamburger-1rpR6E2l.js";import"./index-hJsRv-pT.js";import"./HomeNav-T9IOjZgo.js";const re=n.object({first_name:n.string().min(1,{message:"Enter a first name"}),lastname:n.any(),country_code:n.any(),state_code:n.any(),city_id:n.any(),phone:n.any(),address_one:n.any(),address_two:n.any(),country:n.any(),xsocial:n.any(),linksocial:n.any(),fbsocial:n.any(),zipcode:n.any()}),le=({user:s,userProfileImageData:o})=>{const _="https://oxbyt.com",d=$();let g="";o!=null&&o.image_url?g=_+o.image_url:g="https://trendyblinds.ca/wp-content/uploads/2023/09/3.-3D-WALLPAPER-SKU0015.jpg";const[x,P]=t.useState(g),[u,N]=t.useState(null),h=t.useRef(null),[v,y]=t.useState(!1),[S,c]=t.useState(!1),E=()=>{var a;(a=h.current)==null||a.click()},I=a=>{var f;const m=(f=a.target.files)==null?void 0:f[0];if(m){const j=URL.createObjectURL(m);P(j),N(m),y(!0)}},U=async()=>{if(c(!0),d.notify("Working..."),await new Promise(a=>setTimeout(a,1e3)),v){const a=new FormData;a.append("file",u),a.append("guid",s.user_guid);const j="https://oxbyt.com"+"/user_profile_pic_upload";try{const p=await fetch(j,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:a});if(p.ok)d.alertReload("","Image uploaded successfully!");else{let A=p.json().then(r=>{d.alertCancel("",r.message)})}}catch{return}finally{c(!1)}}else d.alertCancel("","Please select an image to continue."),c(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden`,children:[e.jsx("img",{src:x,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),e.jsx("input",{type:"file",accept:"image/*",ref:h,className:" hidden",onChange:I}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:E,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(Q,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${S?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:U,disabled:S,children:S?"Uploading...":"Upload"})})]})},ce=({loaderData:s,user:o,userProfileData:_})=>{var B,M;const[d,g]=t.useState(null),[x,P]=t.useState(!1),u=$(),N=s.countries;let[h,v]=t.useState(s.states),[y,S]=t.useState(s.cities);s.categories;const[c,E]=t.useState((B=s.userProfileData)==null?void 0:B.country_code),[I,U]=t.useState((M=s.userProfileData)==null?void 0:M.state_code),[a,m]=t.useState(""),[f,j]=t.useState(""),p=async l=>{E(l),m(l);const w=await O(l);v(w),A("")},A=async l=>{U(l),j(l);const w=await W(c,l);S(w)},r=l=>{let w=l.target.value,R=l.target.name;g(F=>({...F,[R]:w}))},L=async l=>{P(!0),u.notify("Updating user profile..."),await new Promise(C=>setTimeout(C,1e3));const w="https://tynk.cc",R="/api/user/"+o.guid,F=w+R;try{const C=await fetch(F,{method:"PUT",headers:X,body:JSON.stringify(l)});if(C.ok)u.alertReload("Success","Update is Successful!");else{var G=await C.json();throw new Error(`Error Code: ${C.status} - ${G.error}`)}}catch(C){u.alertCancel("Error",C.message);return}finally{P(!1)}},{register:i,handleSubmit:J,getValues:ie,setValue:k,watch:de,setError:ue,formState:{errors:T,isSubmitting:me}}=H({defaultValues:_,resolver:K(re)});return t.useEffect(()=>{a&&(k("state_code",""),k("city_id",""))},[a]),t.useEffect(()=>{f&&k("city_id","")},[f]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:D,children:e.jsxs("div",{className:`${ae} flex flex-col place-items-center`,children:[e.jsx("div",{className:ne,children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(le,{user:_,userProfileImageData:s.userProfileImageData})})]})}),e.jsx("hr",{}),e.jsx("form",{onSubmit:J(L),children:e.jsxs("div",{className:`${D} mt-0  rounded-lg pt-4
                 max-w-[400px] w-full mx-auto `,children:[e.jsx(b,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:i,changeHandler:r,error:T.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(b,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:i,changeHandler:r,error:T.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx(z,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:N,register:i,changeHandler:r,error:T.country_code,setCode:p,controlInformation:"Please select country. "}),e.jsx(z,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:h,register:i,changeHandler:r,setCode:A,controlInformation:"Please select state. "}),e.jsx(z,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:y,register:i,changeHandler:r,controlInformation:"Please select a city. "}),e.jsx(b,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:i,changeHandler:r,controlInformation:"Please a zipcode. "}),e.jsx(b,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:i,changeHandler:r,controlInformation:"Please enter a phone or mobile. "}),e.jsx(b,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:i,changeHandler:r,controlInformation:"Please enter an address. "}),e.jsx(b,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:i,changeHandler:r,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(Z,{working:x})]})})]})},Ne=()=>{const{user:s}=Y(),[o,_]=t.useState(null),[d,g]=t.useState(null),[x,P]=t.useState(null),[u,N]=t.useState(null),[h,v]=t.useState(null),[y,S]=t.useState(null),[c,E]=t.useState(null),[I,U]=t.useState(!0);return t.useEffect(()=>{async function a(m){const f=await ee(m||""),j=await te(),p=f,A=await O(p.country_code||""),r=await W(p.country_code||"",p.state_code||""),L=await se(),i=await oe(m||"");_(f),P(j),g(A),N(r),v(i),S(L)}s!=null&&s.guid&&a(s==null?void 0:s.guid)},[s==null?void 0:s.guid]),t.useEffect(()=>{o&&x&&d&&u&&h&&y&&E({userProfile:o,countries:x,states:d,cities:u,userProfileImageData:h,categories:y})},[y,x,d,u,h,o]),t.useEffect(()=>{c&&U(!1)},[c]),I?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(V,{children:e.jsx(q,{title:"Account Profile",children:o&&c&&s&&!I?e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 text-md",children:[o==null?void 0:o.first_name," ",o==null?void 0:o.lastname]}),e.jsx(ce,{loaderData:c,user:s,userProfileData:c.userProfile})]}):e.jsx("div",{children:"Loading..."})})})};export{Ne as default};
