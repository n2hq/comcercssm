import{r as s,j as e}from"./components-BAvBE3fA.js";import{A as N,C}from"./ContentLayout-BULv8Qdt.js";import{h as P,c as L,u as A,g as R}from"./AuthContext-Tj_b5086.js";import{z as b,u as U,s as q}from"./index-CC8pXzgA.js";import{f as _,d as k,I as B,B as F}from"./Input-Dw9jNG5H.js";import{u as I}from"./NotificationContext-C8wtauTv.js";import"./MobileNav-C2nYESeh.js";import"./index-E-6-scJO.js";import"./UserMenu-CzhSTjVp.js";const T=b.object({email:b.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),V=({loaderData:t,user:a})=>{var x,h;const[g,r]=s.useState(null),[c,l]=s.useState(!1),i=I(),[d,p]=s.useState(!0),u=n=>{let j=n.target.value,f=n.target.name;r(m=>({...m,[f]:j}))},E=async n=>{var m;l(!0),i.notify("","Updating email..."),await new Promise(o=>setTimeout(o,1e3));const f=L.BASE_URL+"/api/user/change_email_request";n.guid=(m=t.userProfile)==null?void 0:m.user_guid;try{const o=await fetch(f,{method:"POST",headers:P,body:JSON.stringify(n)});if(o.ok)i.alertCancel("Email Change Request","Email Change Request Successfully Sent!");else{let J=o.json().then(w=>{i.alertCancel("Error",w.error)})}}catch{return}finally{l(!1)}},{register:S,handleSubmit:y,getValues:W,setValue:O,watch:z,setError:D,formState:{errors:v,isSubmitting:H}}=U({defaultValues:t.listing,resolver:q(T)});return e.jsx("form",{onSubmit:y(E),children:e.jsx("div",{className:`${_} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:k,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(x=t.userProfile)==null?void 0:x.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-[8px] px-3 py-3 bg-gray-100",children:[(h=t.userProfile)==null?void 0:h.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(B,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:S,changeHandler:u,error:v.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(F,{working:c})]})})})},te=()=>{const{user:t}=A(),[a,g]=s.useState(null),[r,c]=s.useState(null),[l,i]=s.useState(!0);return s.useEffect(()=>{async function d(p){const u=await R(p||"");g(u)}t!=null&&t.guid&&d(t==null?void 0:t.guid)},[t==null?void 0:t.guid]),s.useEffect(()=>{a&&c({userProfile:a})},[a]),s.useEffect(()=>{r&&i(!1)},[r]),l?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(N,{children:e.jsxs(C,{title:"Email Address",children:[a===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md",children:a==null?void 0:a.email}),r&&e.jsx(V,{loaderData:r,user:t})]})})};export{te as default};
