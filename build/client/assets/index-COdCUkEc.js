import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r,c as G}from"./components-_iSq0a46.js";import{A as Z,C as q}from"./ContentLayout-r32bNjeq.js";import{u as K}from"./AuthContext-DopcVI1K.js";import{k as J,D as Y,E as $,h as Q,I as X,z as ee,i as se,H as te,J as oe,N as re,P as ne}from"./lib-BHrocJru.js";import{z as t,u as ae,s as ie}from"./index-tW0-2oYE.js";import{b as le}from"./index-DGHBhGkX.js";import{u as V}from"./NotificationContext-DoOVhrLn.js";import{f as O,e as ce,a as ue}from"./WhiteLogo-CdpZOKeo.js";import{I as c,B as de}from"./Input-BG11kxDy.js";import{T as H}from"./TextareaWithWordLimit-BvFeFUkH.js";import{S as F}from"./Select-BQpz8QHd.js";import{b as me}from"./json-GhpSrAJS.js";import{B as fe,a as he}from"./BusinessHeader-CjfuwdWv.js";import"./UserMenu-xqMWeKnH.js";import"./index-lCGivmNT.js";import"./HomeNav-CjDO1tzT.js";import"./SrchNavbar-DGFJXuGf.js";import"./HamburgerSecondary-BfYMWBJX.js";import"./index-CCSWQEh1.js";import"./CardTitle-BDvi6d6P.js";const ge=t.object({username:t.any(),email_address:t.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:t.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:t.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:t.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:t.string().refine(s=>s.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(s=>s.trim().split(/\s+/).filter(Boolean).length<=50,{message:"You can only write up to 50 words."}),long_description:t.string().refine(s=>s.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:t.any(),state_code:t.any(),state_text:t.any(),country_text:t.any(),city_id:t.any(),established:t.string({message:"Please enter year established"}).min(4,{message:"Year must be at least 4 characters"}),call_code:t.any(),phone:t.any(),zipcode:t.any(),intro:t.any(),category:t.string().min(2,{message:"Please select a business category"}),business_phrases:t.union([t.literal(""),t.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:t.any(),services:t.any(),xsocial:t.any(),fbsocial:t.any(),linksocial:t.any(),website:t.union([t.string().url().nullish(),t.literal("")])}).superRefine((s,f)=>{var l,u;((l=s==null?void 0:s.address_two)==null?void 0:l.length)!==0&&((u=s==null?void 0:s.address_two)==null?void 0:u.length)<3&&f.addIssue({code:t.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),pe=({listing:s,user:f,businessProfileImageData:l})=>{let u="";l.image_url?u=J.IMG_BASE_URL+l.image_url:u="/images/imgplaceholder.jpg";const[I,j]=r.useState(u),[_,v]=r.useState(null),p=r.useRef(null),[T,N]=r.useState(!1),[C,y]=r.useState(!1),w=V(),E=()=>{var d;(d=p.current)==null||d.click()},B=d=>{var S;const m=(S=d.target.files)==null?void 0:S[0];if(m){const h=URL.createObjectURL(m);j(h),v(m),N(!0)}},P=async()=>{y(!0),w.notify("Working..."),await new Promise(m=>setTimeout(m,1e3));const d=new FormData;if(T){d.append("file",_),d.append("guid",f.user_guid),d.append("bid",s.gid);const S=J.IMG_BASE_URL+"/business_profile_pic_upload";try{const h=await fetch(S,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:d});if(h.ok)w.alertReload("","Image uploaded successfully!");else{let A=h.json().then(o=>{w.alertCancel("",o.message)})}}catch{return}finally{y(!1)}}else w.alertCancel("","Please select an image to continue."),y(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden",children:[e.jsx("img",{src:I,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),e.jsx("input",{type:"file",accept:"image/*",ref:p,className:" hidden",onChange:B}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:E,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(le,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`${C?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:P,disabled:C,children:C?"Uploading...":"Upload"})})]})},be=({data:s})=>{var z;const[f,l]=r.useState(null),[u,I]=r.useState(!1),j=V(),_=s.countries;let[v,p]=r.useState(s.states),[T,N]=r.useState(s.cities);const C=(z=me)==null?void 0:z.sort((i,g)=>i.name.localeCompare(g.name)),[y,w]=r.useState(s.businessProfile.country_code),[E,B]=r.useState(s.businessProfile.state_code),[P,d]=r.useState(""),[m,S]=r.useState(""),h=async i=>{w(i),d(i);const g=await Y(i);p(g),A("")},A=async i=>{B(i),S(i);const g=await $(y,i);N(g)},o=i=>{let g=i.target.value,k=i.target.name;l(x=>({...x,[k]:g}))},M=async i=>{I(!0),j.notify("Updating business profile..."),await new Promise(x=>setTimeout(x,1e3));const g="/api/listing/"+s.businessProfile.gid,k=J.BASE_URL+g;try{const x=await fetch(k,{method:"PUT",headers:Q,body:JSON.stringify(i)});if(x.ok)j.alertReload("Success!","Successfully updated!");else throw new Error(`HTTP error! Status: ${x.status}`)}catch(x){j.alertCancel("Error!",x.message)}finally{I(!1)}},{register:n,handleSubmit:U,getValues:D,setValue:b,watch:L,setError:W,formState:{errors:a,isSubmitting:R}}=ae({defaultValues:s.businessProfile,resolver:ie(ge)});return r.useEffect(()=>{s.businessProfile&&(b("state_code",s.businessProfile.state_code),b("city_id",s.businessProfile.city_id))},[s.businessProfile]),r.useEffect(()=>{P&&(b("state_code",""),b("city_id",""))},[P,s]),r.useEffect(()=>{m&&b("city_id","")},[m]),e.jsx("div",{children:e.jsxs("div",{className:O,children:[e.jsxs("div",{className:`${ce} flex flex-col place-items-center`,children:[e.jsx("div",{className:ue,children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(pe,{listing:s.businessProfile,user:s.userProfile,businessProfileImageData:s.businessProfileImageData})})]}),e.jsx("hr",{className:"w-full"}),e.jsx("form",{className:" w-full",onSubmit:U(M),children:e.jsxs("div",{className:`${O} mt-0  rounded-lg pt-4
                                lg:max-w-[500px] w-full mx-auto  `,children:[e.jsx(c,{controlTitle:"Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:o,error:a.username,controlInformation:"Choose a username. "}),e.jsx(c,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:o,error:a.email_address,controlInformation:"Email address is compulsory."}),e.jsx(c,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:o,error:a.title,controlInformation:"Please enter page name. Page name is compulsory. "}),e.jsx(c,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:o,error:a.established,controlInformation:"This is the name the business was registered or started "}),e.jsx(F,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:_,register:n,changeHandler:o,error:a.country_code,setCode:h,controlInformation:"This is the country the business was registered. "}),e.jsx(F,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:v,register:n,changeHandler:o,error:a.state_code,setCode:A,controlInformation:"This is the state the business was registered. "}),e.jsx(F,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:T,register:n,changeHandler:o,error:a.city_id,controlInformation:"This is the city the business was registered. "}),e.jsx(c,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:o,error:a.address_one,width:100,controlInformation:"Contact address for the business. "}),e.jsx(c,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:o,error:a.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),e.jsx(c,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:o,error:a.zipcode,controlInformation:"Enter the zipcode. "}),e.jsx(c,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:o,error:a.phone,controlInformation:"Mobile number or phoone number. "}),e.jsx(F,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:C,register:n,changeHandler:o,error:a.category}),e.jsx(c,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:n,changeHandler:o,error:a.business_phrases}),e.jsx(c,{controlTitle:"Products",controlPlaceholder:"Enter products",controlName:"products",register:n,changeHandler:o,error:a.products}),e.jsx(c,{controlTitle:"Services",controlPlaceholder:"Enter services",controlName:"services",register:n,changeHandler:o,error:a.services}),e.jsx(H,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:o,error:a.short_description,setValue:b,getValues:D,watch:L}),e.jsx(H,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:o,error:a.long_description,setValue:b,getValues:D,watch:L}),e.jsx(c,{controlTitle:"Twitter",controlPlaceholder:"@handle",controlName:"xsocial",register:n,changeHandler:o,error:a.address}),e.jsx(c,{controlTitle:"Facebook",controlPlaceholder:"@handle",controlName:"fbsocial",register:n,changeHandler:o,error:a.fbsocial}),e.jsx(c,{controlTitle:"LinkedIn",controlPlaceholder:"https://linkedin.com/company/username",controlName:"linksocial",register:n,changeHandler:o,error:a.linksocial}),e.jsx(c,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:o,error:a.website}),e.jsx(de,{working:u})]})})]})})},Fe=()=>{var n;r.useEffect(()=>{X(localStorage)},[]);const s=G(),f=K();if(!f)return null;const l=s.business_guid,u=(n=f==null?void 0:f.user)==null?void 0:n.guid,[I,j]=r.useState(!0),[_,v]=r.useState(null),[p,T]=r.useState(null),[N,C]=r.useState(null),[y,w]=r.useState(null),[E,B]=r.useState(null),[P,d]=r.useState(null),[m,S]=r.useState(null),[h,A]=r.useState(null),[o,M]=r.useState(null);return r.useEffect(()=>{async function U(D,b){const L=await ee(D||""),W=await se(b||""),a=await te(),R=W,z=await Y(R.country_code||""),i=await $(R.country_code||"",R.state_code||""),g=await oe(),k=await re(D||""),x=await ne(b||"");v(L),T(W),w(a),C(z),B(i),d(k),S(x),A(g)}u&&l&&U(u,l)},[u,l]),r.useEffect(()=>{_&&p&&y&&N&&E&&P&&h&&m&&M({userProfile:_,businessProfile:p,countries:y,states:N,cities:E,userProfileImageData:P,businessProfileImageData:m,categories:h})},[h,y,N,E,P,m,_,p]),r.useEffect(()=>{o&&j(!1)},[o]),I?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(Z,{children:e.jsxs(q,{title:"Update Business",businessGuid:l,data:o,businessProfile:p,children:[e.jsx(fe,{businessGuid:l,data:o,businessProfile:p}),o&&e.jsxs("div",{children:[l&&u&&e.jsx(he,{guid:l,userGuid:u}),e.jsx(be,{data:o})]})]})})};export{Fe as default};
