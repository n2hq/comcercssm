import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-CCwaTRgT.js";import{u as q}from"./AuthContext-C7k3lHjW.js";import{x as T,a2 as H,u as X,X as D,Y as V,m as Y,I as K,j as Q,Z as ee,_ as te,a3 as se,a4 as oe}from"./lib-d5lyMBXU.js";import{u as G}from"./NotificationContext-BVMvs2cM.js";import{u as ae,s as ne}from"./zod-PtQGc9r6.js";import{z as c}from"./index-C4bLmoCR.js";import{I as R,B as re}from"./Input-Be1j46Iq.js";import{S as B}from"./Select-DQLS2q0Z.js";import{f as le}from"./WhiteLogo-hx6VZQD6.js";import{u as ce}from"./OperationContext-BhT9SWU1.js";import{P as ie}from"./ProfileLayout-tLXLRTfj.js";import"./UserMenu-BJva0xcL.js";import"./index-oI16Z90E.js";import"./HomeNav-CVNWGNT6.js";import"./SrchNavbar-BmbhUp-t.js";import"./HamburgerSecondary-BkHc2D4C.js";const de=({user:i,userProfileImageData:s})=>{const o=G();let y="";s!=null&&s.image_url&&(y=T.IMG_BASE_URL+s.image_url);const[f,I]=t.useState(y),[p,b]=t.useState(null),d=t.useRef(null),[P,_]=t.useState(!1),[v,N]=t.useState(!1),E=()=>{var a;(a=d.current)==null||a.click()},S=a=>{var u;const j=(u=a.target.files)==null?void 0:u[0];if(j){const g=URL.createObjectURL(j);I(g),b(j),_(!0)}},C=async()=>{if(N(!0),o.notify("Working..."),await new Promise(a=>setTimeout(a,1e3)),P){const a=new FormData;a.append("file",p),a.append("guid",i.user_guid);const u=T.IMG_BASE_URL+"/user_profile_pic_upload";try{const g=await fetch(u,{method:"POST",body:a});if(g.ok)o.alertReload("","Image uploaded successfully!");else{let n=g.json().then(r=>{o.alertCancel("",r.message)})}}catch{return}finally{N(!1)}}else o.alertCancel("","Please select an image to continue."),N(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden
                flex place-content-center place-items-center border-[3px] border-white`,children:[f!==""?e.jsx("img",{src:f,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}):e.jsx(H,{className:"object-cover w-[70%] h-[70%]"}),e.jsx("input",{type:"file",accept:"image/*",ref:d,className:" hidden",onChange:S}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:E,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out bg-white/50`,children:e.jsx(X,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${v?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:C,disabled:v,children:v?"Uploading...":"Submit"})})]})},ue=c.object({first_name:c.string().min(1,{message:"Enter a first name"}),lastname:c.any(),country_code:c.any(),state_code:c.any(),city_id:c.any(),phone:c.any(),address_one:c.any(),address_two:c.any(),country:c.any(),xsocial:c.any(),linksocial:c.any(),fbsocial:c.any(),zipcode:c.any()}),me=({listing:i,user:s,userProfileBgData:o})=>{const[y,f]=t.useState(!1),[I,p]=t.useState(""),b=t.useRef(null),[d,P]=t.useState(!1),_=G(),[v,N]=t.useState(null),{showOperation:E,showError:S,completeOperation:C,showSuccess:a}=ce();t.useEffect(()=>{o!=null&&o.image_url?p(T.IMG_BASE_URL+(o==null?void 0:o.image_url)):p("/images/newyork.jpg")},[]);const j=()=>{var n;(n=b.current)==null||n.click()},u=n=>{var h;const r=(h=n.target.files)==null?void 0:h[0];if(r){const x=URL.createObjectURL(r);p(x),N(r),P(!0)}},g=async()=>{f(!0),E("processing"),await new Promise(r=>setTimeout(r,1e3));const n=new FormData;if(d){n.append("file",v),n.append("guid",s.user_guid);const h=T.IMG_BASE_URL+"/user_profile_bg_upload";try{const x=await fetch(h,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:n});if(x.ok)try{a("Success","Image saved.")}finally{C()}else{let l=x.json().then(A=>{console.log(A.message),S("Error",A.message),C()})}}catch(x){console.log(x),S("Error","Image save failed"),C()}finally{f(!1)}}else _.alertCancel("","Please select an image to continue."),f(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-black w-full h-[200px] relative shadow-lg",children:[e.jsx("img",{src:I,alt:"user",className:"object-cover w-full h-full"}),e.jsx("input",{type:"file",accept:"image/*",ref:b,className:" hidden",onChange:u})]}),e.jsxs("div",{className:` flex place-items-center gap-3
                place-content-center bottom-[5px] right-[5px] w-fit z-[120] absolute`,children:[e.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:y,onMouseDown:j,children:"Browse"}),e.jsx("button",{className:`bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:g,disabled:y,children:y?"Uploading...":"Upload"})]})]})},fe=({loaderData:i,user:s,userProfileData:o,userProfileBgData:y})=>{var J,$;const[f,I]=t.useState(null),[p,b]=t.useState(!1),d=G(),P=i.countries;let[_,v]=t.useState(i.states),[N,E]=t.useState(i.cities);i.categories;const[S,C]=t.useState((J=i.userProfileData)==null?void 0:J.country_code),[a,j]=t.useState(($=i.userProfileData)==null?void 0:$.state_code),[u,g]=t.useState(""),[n,r]=t.useState(""),h=async m=>{C(m),g(m);const U=await D(m);v(U),x("")},x=async m=>{j(m),r(m);const U=await V(S,m);E(U)},l=m=>{let U=m.target.value,M=m.target.name;I(z=>({...z,[M]:U}))},A=async m=>{b(!0),d.notify("Updating user profile..."),await new Promise(k=>setTimeout(k,1e3));const U="https://garssete.gasimg.com",M="/api/user/"+s.guid,z=U+M;try{const k=await fetch(z,{method:"PUT",headers:Y,body:JSON.stringify(m)});if(k.ok)d.alertReload("Success","Update is Successful!");else{var Z=await k.json();throw new Error(`Error Code: ${k.status} - ${Z.error}`)}}catch(k){d.alertCancel("Error",k.message);return}finally{b(!1)}},{register:w,handleSubmit:F,getValues:W,setValue:L,watch:pe,setError:ge,formState:{errors:O,isSubmitting:he}}=ae({defaultValues:o,resolver:ne(ue)});return t.useEffect(()=>{u&&(L("state_code",""),L("city_id",""))},[u]),t.useEffect(()=>{n&&L("city_id","")},[n]),e.jsxs("div",{children:[e.jsx(me,{user:o,userProfileBgData:y}),e.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:e.jsx("div",{className:"absolute top-[-50px]",children:e.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:e.jsx(de,{user:o,userProfileImageData:i.userProfileImageData})})})}),e.jsxs("div",{className:"px-[15px]",children:[e.jsx("hr",{}),e.jsx("form",{onSubmit:F(A),children:e.jsxs("div",{className:`${le} mt-0  rounded-lg pt-4
                 md:max-w-[400px] w-full mx-auto `,children:[e.jsx(R,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:w,changeHandler:l,error:O.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(R,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:w,changeHandler:l,error:O.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx(B,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:P,register:w,changeHandler:l,error:O.country_code,setCode:h,controlInformation:"Please select country. "}),e.jsx(B,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:_,register:w,changeHandler:l,setCode:x,controlInformation:"Please select state. "}),e.jsx(B,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:N,register:w,changeHandler:l,controlInformation:"Please select a city. "}),e.jsx(R,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:w,changeHandler:l,controlInformation:"Please a zipcode. "}),e.jsx(R,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:w,changeHandler:l,controlInformation:"Please enter a phone or mobile. "}),e.jsx(R,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:w,changeHandler:l,controlInformation:"Please enter an address. "}),e.jsx(R,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:w,changeHandler:l,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(re,{working:p})]})})]})]})},Le=()=>{t.useEffect(()=>{K(localStorage)},[]);const i=q();if(!i)return null;const{user:s}=i,[o,y]=t.useState(null),[f,I]=t.useState(null),[p,b]=t.useState(null),[d,P]=t.useState(null),[_,v]=t.useState(null),[N,E]=t.useState(null),[S,C]=t.useState(null),[a,j]=t.useState(null),[u,g]=t.useState(!0);return t.useEffect(()=>{async function n(r){try{const h=await Q(r||""),x=await ee(),l=h,A=await D(l.country_code||""),w=await V(l.country_code||"",l.state_code||""),F=await te(),W=await se(r||""),L=await oe(r||"");y(h),b(x),I(A),P(w),v(W),E(L),C(F)}catch(h){console.log(h.message)}}s!=null&&s.guid&&n(s==null?void 0:s.guid)},[s==null?void 0:s.guid]),t.useEffect(()=>{o&&p&&f&&d&&_&&S&&j({userProfile:o,countries:p,states:f,cities:d,userProfileImageData:_,categories:S})},[S,p,f,d,_,o]),t.useEffect(()=>{a&&g(!1)},[a]),u?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Garssete"})}):e.jsx(ie,{children:o&&a&&!u&&s&&e.jsx(fe,{loaderData:a,user:s,userProfileData:a.userProfile,userProfileBgData:N})})};export{Le as default};
