import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,c as Q}from"./components-qdL6XBti.js";import{A as ee,C as se}from"./ContentLayout-BxrbsZcp.js";import{u as te}from"./AuthContext-BnCYfHn3.js";import{w as M,t as H,S as oe,U as q,V as X,n as re,I as ne,P as ae,J as ie,W as le,X as ce,a0 as ue,aa as de,ab as me}from"./lib-Vg6a-bJE.js";import{u as fe,s as ge}from"./zod-g2XesUsp.js";import{z as o}from"./index-C4bLmoCR.js";import{u as G}from"./NotificationContext-jkHr5VFO.js";import{g as he,f as pe,c as V}from"./WhiteLogo-CmRTgcFd.js";import{I as x,B as be}from"./Input-BrM5rnni.js";import{T as Z}from"./TextareaWithWordLimit-CqEKDtkd.js";import{S as $}from"./Select-C3Hi5AUr.js";import{B as xe,a as we}from"./BusinessHeader-Ta45pSoe.js";import"./UserMenu-C8vdknC1.js";import"./index-Cj0zFx3r.js";import"./HomeNav-DdgaWdh1.js";import"./SrchNavbar-8eek0ggc.js";import"./json-CfA3Rlrt.js";import"./CardTitle-BY0Ps6Ga.js";const ye=o.object({username:o.any(),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:o.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),long_description:o.string().nullish().refine(e=>!e||e.trim()===""?!0:e.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:o.any(),state_code:o.any(),state_text:o.any(),country_text:o.any(),city_id:o.any(),established:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Year established must contain only numbers"}).refine(e=>e===""||e.length<=4,{message:"Year established must not be more than 4 digits"}),zipcode:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Zipcode must contain only numbers"}).refine(e=>e===""||e.length<=7,{message:"Zipcode must not be more than 7 digits"}),call_code:o.any(),phone:o.string().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),intro:o.any(),category:o.string().min(2,{message:"Please select a business category"}),business_phrases:o.union([o.literal(""),o.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:o.any(),services:o.any(),xsocial:o.any(),fbsocial:o.any(),linksocial:o.any(),website:o.string().nullable().optional().refine(e=>{if(!e||e==="")return!0;try{return new URL(e),!0}catch{return!1}},{message:"Please enter a valid website. Example: http://example.com"})}).superRefine((e,f)=>{var c,d;((c=e==null?void 0:e.address_two)==null?void 0:c.length)!==0&&((d=e==null?void 0:e.address_two)==null?void 0:d.length)<3&&f.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),Pe=({listing:e,user:f,businessProfileImageData:c})=>{let d="";c.image_url?d=M.IMG_BASE_URL+c.image_url:d="/images/placeholder-icon.webp";const[j,_]=t.useState(d),[v,A]=t.useState(null),g=t.useRef(null),[B,C]=t.useState(!1),[w,h]=t.useState(!1),p=G(),I=()=>{var n;(n=g.current)==null||n.click()},D=n=>{var b;const i=(b=n.target.files)==null?void 0:b[0];if(i){const u=URL.createObjectURL(i);_(u),A(i),C(!0)}},E=async()=>{h(!0),p.notify("Working..."),await new Promise(i=>setTimeout(i,1e3));const n=new FormData;if(B){n.append("file",v),n.append("guid",f.user_guid),n.append("bid",e.gid);const b=M.IMG_BASE_URL+"/business_profile_pic_upload";try{const u=await fetch(b,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:n});if(u.ok)p.alertReload("","Image uploaded successfully!");else{let T=u.json().then(N=>{p.alertCancel("",N.message)})}}catch{return}finally{h(!1)}}else p.alertCancel("","Please select an image to continue."),h(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden border-[2px] border-gray-200",children:[s.jsx("img",{src:j,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),s.jsx("input",{type:"file",accept:"image/*",ref:g,className:" hidden",onChange:D}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:I,children:s.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(H,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:s.jsx("button",{className:`${w?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:E,disabled:w,children:w?"Uploading...":"Upload"})})]})},Se=({listing:e,user:f,businessProfileBgData:c})=>{let d="";c.image_url&&(d=M.IMG_BASE_URL+c.image_url);const[j,_]=t.useState(d),[v,A]=t.useState(null),g=t.useRef(null),[B,C]=t.useState(!1),[w,h]=t.useState(!1),p=G(),I=()=>{var n;(n=g.current)==null||n.click()},D=n=>{var b;const i=(b=n.target.files)==null?void 0:b[0];if(i){const u=URL.createObjectURL(i);_(u),A(i),C(!0)}},E=async()=>{h(!0),p.notify("Working..."),await new Promise(i=>setTimeout(i,1e3));const n=new FormData;if(B){n.append("file",v),n.append("guid",f.user_guid),n.append("bid",e.gid);const b=M.IMG_BASE_URL+"/business_profile_bg_upload";try{const u=await fetch(b,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:n});if(u.ok)p.alertReload("","Image uploaded successfully!");else{let T=u.json().then(N=>{p.alertCancel("",N.message)})}}catch{return}finally{h(!1)}}else p.alertCancel("","Please select an image to continue."),h(!1)};return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"relative rounded-xl bg-gray-600 w-full h-[150px] z-[40]  overflow-hidden",children:[j&&s.jsx("img",{src:j,alt:"Click to upload",className:" object-cover w-full h-full  absolute z-[40]"}),s.jsx("input",{type:"file",accept:"image/*",ref:g,className:" hidden",onChange:D}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-[60] top-0 object-cover
                                 text-white/80 `,onMouseDown:I,children:s.jsx("div",{className:`w-[70px] h-[70px] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(H,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center bottom-[5px] right-[5px] w-[100px] z-[120] absolute`,children:s.jsx("button",{className:`${w?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:E,disabled:w,children:w?"Uploading...":"Upload"})})]})},je=({data:e})=>{var W;const[f,c]=t.useState(null),[d,j]=t.useState(!1),_=G(),[v,A]=t.useState(null),g=e.countries;let[B,C]=t.useState(e.states),[w,h]=t.useState(e.cities);const p=(W=oe)==null?void 0:W.sort((m,P)=>m.name.localeCompare(P.name)),[I,D]=t.useState(e.businessProfile.country_code),[E,n]=t.useState(e.businessProfile.state_code),[i,b]=t.useState(""),[u,T]=t.useState(""),N=async m=>{D(m),b(m);const P=await q(m);C(P),R("")},R=async m=>{n(m),T(m);const P=await X(I,m);h(P)},r=m=>{let P=m.target.value,k=m.target.name;c(S=>({...S,[k]:P}))},J=async m=>{j(!0),_.notify("Updating business profile..."),await new Promise(S=>setTimeout(S,1e3));const P="/api/listing/"+e.businessProfile.gid,k=M.BASE_URL+P;try{const S=await fetch(k,{method:"PUT",headers:re,body:JSON.stringify(m)});if(S.ok)_.alertReload("Success!","Successfully updated!");else{const F=await S.text(),K=JSON.parse(F);throw new Error(`${K.error}`)}}catch(S){_.alertCancel("Unsuccessful",S.message)}finally{j(!1)}},{register:a,handleSubmit:L,getValues:U,setValue:y,watch:z,setError:Y,formState:{errors:l,isSubmitting:O}}=fe({defaultValues:e.businessProfile,resolver:ge(ye)});return t.useEffect(()=>{e.businessProfile&&(y("state_code",e.businessProfile.state_code),y("city_id",e.businessProfile.city_id))},[e.businessProfile]),t.useEffect(()=>{i&&(y("state_code",""),y("city_id",""))},[i,e]),t.useEffect(()=>{u&&y("city_id","")},[u]),s.jsx("div",{children:s.jsxs("div",{className:"formWrapperClass mt-[15px]",children:[s.jsxs("div",{className:`${he} flex flex-col place-items-center`,children:[s.jsx("div",{className:"z-[50] w-full  h-[150px]",children:s.jsx(Se,{listing:e.businessProfile,user:e.userProfile,businessProfileBgData:e.businessProfileBgData})}),s.jsx("div",{className:"-mt-10 z-[100]",children:s.jsx(Pe,{listing:e.businessProfile,user:e.userProfile,businessProfileImageData:e.businessProfileImageData})})]}),s.jsx("hr",{className:"w-full"}),s.jsx("form",{className:" w-full",onSubmit:L(J),children:s.jsxs("div",{className:`${pe} mt-0  rounded-lg pt-4
                                lg:max-w-[500px] w-full mx-auto  `,children:[s.jsx(x,{controlTitle:"Username",controlPlaceholder:"Enter username",controlName:"username",register:a,changeHandler:r,error:l.username,controlInformation:"Choose a username. "}),s.jsx(x,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:a,changeHandler:r,error:l.email_address,controlInformation:"Email address is compulsory."}),s.jsx(x,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:a,changeHandler:r,error:l.title,controlInformation:"Please enter page name. Page name is compulsory. "}),s.jsx(x,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:a,changeHandler:r,error:l.established,controlInformation:"This is the name the business was registered or started "}),s.jsx(x,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:a,changeHandler:r,error:l.address_one,width:100,controlInformation:"Contact address for the business. "}),s.jsx(x,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:a,changeHandler:r,error:l.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),s.jsx($,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:g,register:a,changeHandler:r,error:l.country_code,setCode:N,controlInformation:"Country the business was registered. "}),s.jsx($,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:B,register:a,changeHandler:r,error:l.state_code,setCode:R,controlInformation:"State the business was registered. "}),s.jsx($,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:w,register:a,changeHandler:r,error:l.city_id,controlInformation:"City the business was registered. "}),s.jsx(x,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:a,changeHandler:r,error:l.zipcode,controlInformation:"Enter the zipcode. E.g.: 51234 or 845219 "}),s.jsx(x,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:a,changeHandler:r,error:l.phone,controlInformation:"Mobile number or phone number. "}),s.jsx($,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:p,register:a,changeHandler:r,error:l.category,controlInformation:"Select business category."}),s.jsx(x,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:a,changeHandler:r,error:l.business_phrases,controlInformation:"Enter business phrases like: Solicitor, Advocate, Plumber, Business Analyst, Mechanical Engineers."}),s.jsx(x,{controlTitle:"Products",controlPlaceholder:"E.g.: Publications, Accessories, Shoes, Subscriptions, Magazines, Cars",controlName:"products",register:a,changeHandler:r,error:l.products,controlInformation:"Enter your products name like: Magazines, Generators, Accessories, Perfumes, Publications etc."}),s.jsx(x,{controlTitle:"Services",controlPlaceholder:"E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc.",controlName:"services",register:a,changeHandler:r,error:l.services,controlInformation:"Enter your services E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc."}),s.jsx(Z,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:a,changeHandler:r,error:l.short_description,setValue:y,getValues:U,watch:z,controlInformationClass:V,controlInformation:"Short description of business activities"}),s.jsx(Z,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:a,changeHandler:r,error:l.long_description,setValue:y,getValues:U,watch:z,controlInformationClass:V,controlInformation:"More description about the business."}),s.jsx(x,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:a,changeHandler:r,error:l.website,controlInformation:"Your website should look like this: http://example.com "}),s.jsx(be,{working:d})]})})]})})},$e=()=>{var a;t.useEffect(()=>{ne(localStorage)},[]);const e=Q(),f=te();if(!f)return null;const c=e.business_guid,d=(a=f==null?void 0:f.user)==null?void 0:a.guid,[j,_]=t.useState(!0),[v,A]=t.useState(null),[g,B]=t.useState(null),[C,w]=t.useState(null),[h,p]=t.useState(null),[I,D]=t.useState(null),[E,n]=t.useState(null),[i,b]=t.useState(null),[u,T]=t.useState(null),[N,R]=t.useState(null),[r,J]=t.useState(null);return t.useEffect(()=>{async function L(U,y){const z=await ae(U||""),Y=await ie(y||""),l=await le(),O=Y,W=await q(O.country_code||""),m=await X(O.country_code||"",O.state_code||""),P=await ce(),k=await ue(U||""),S=await de(y||""),F=await me(y||"");A(z),B(Y),p(l),w(W),D(m),n(k),b(S),R(P),T(F),console.log(F)}d&&c&&L(d,c)},[d,c]),t.useEffect(()=>{v&&g&&h&&C&&I&&E&&N&&i&&u&&J({userProfile:v,businessProfile:g,countries:h,states:C,cities:I,userProfileImageData:E,businessProfileImageData:i,businessProfileBgData:u,categories:N})},[N,h,C,I,E,i,v,g,u]),t.useEffect(()=>{r&&_(!1)},[r]),j?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(ee,{children:s.jsxs(se,{title:"Update Business",businessGuid:c,data:r,businessProfile:g,children:[s.jsx(xe,{businessGuid:c,data:r,businessProfile:g}),r&&s.jsxs("div",{children:[c&&d&&s.jsx(we,{guid:c,userGuid:d}),s.jsx(je,{data:r})]})]})})};export{$e as default};
