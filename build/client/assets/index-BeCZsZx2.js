import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,u as K}from"./components-CCwaTRgT.js";import{u as Q}from"./AuthContext-BLT8eIBS.js";import{E as M,z as ee,W as se,X as q,Y as H,m as te,I as oe,j as re,O as ne,Z as ie,_ as ae,a3 as le,ab as ce,ac as ue}from"./lib-CC-22j43.js";import{P as de}from"./ProfileLayout-BUfQvs7q.js";import{u as me,s as fe}from"./zod-PtQGc9r6.js";import{z as o}from"./index-C4bLmoCR.js";import{u as G}from"./NotificationContext-u_i63fMA.js";import{I as b,B as ge}from"./Input-BAJOR40w.js";import{f as pe,c as Z}from"./WhiteLogo-E4eqNMj1.js";import{T as V}from"./TextareaWithWordLimit-BXM3V1nG.js";import{S as W}from"./Select-DTLR1wti.js";import{B as he}from"./BusinessMenu-MNSt271k.js";import"./UserMenu-CJEstezG.js";import"./index-CdGC67h0.js";import"./HomeNav-C-07gCFe.js";import"./SrchNavbar-DUfsO58m.js";import"./HamburgerSecondary-D_c9cnZn.js";import"./json-OCF5soII.js";const be=o.object({username:o.any(),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:o.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),long_description:o.string().nullish().refine(e=>!e||e.trim()===""?!0:e.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:o.any(),state_code:o.any(),state_text:o.any(),country_text:o.any(),city_id:o.any(),established:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Year established must contain only numbers"}).refine(e=>e===""||e.length<=4,{message:"Year established must not be more than 4 digits"}),zipcode:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Zipcode must contain only numbers"}).refine(e=>e===""||e.length<=7,{message:"Zipcode must not be more than 7 digits"}),call_code:o.any(),phone:o.string().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),intro:o.any(),category:o.string().min(2,{message:"Please select a business category"}),business_phrases:o.union([o.literal(""),o.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:o.any(),services:o.any(),xsocial:o.any(),fbsocial:o.any(),linksocial:o.any(),website:o.string().nullable().optional().refine(e=>{if(!e||e==="")return!0;try{return new URL(e),!0}catch{return!1}},{message:"Please enter a valid website. Example: http://example.com"})}).superRefine((e,m)=>{var f,d;((f=e==null?void 0:e.address_two)==null?void 0:f.length)!==0&&((d=e==null?void 0:e.address_two)==null?void 0:d.length)<3&&m.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),xe=({listing:e,user:m,businessProfileBgData:f})=>{let d="";f.image_url&&(d=M.IMG_BASE_URL+f.image_url);const[j,_]=t.useState(d),[E,T]=t.useState(null),x=t.useRef(null),[B,I]=t.useState(!1),[w,g]=t.useState(!1),p=G(),C=()=>{var r;(r=x.current)==null||r.click()},D=r=>{var h;const a=(h=r.target.files)==null?void 0:h[0];if(a){const c=URL.createObjectURL(a);_(c),T(a),I(!0)}},v=async()=>{g(!0),p.notify("Working..."),await new Promise(a=>setTimeout(a,1e3));const r=new FormData;if(B){r.append("file",E),r.append("guid",m.user_guid),r.append("bid",e.gid);const h=M.IMG_BASE_URL+"/business_profile_bg_upload";try{const c=await fetch(h,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:r});if(c.ok)p.alertReload("","Image uploaded successfully!");else{let U=c.json().then(N=>{p.alertCancel("",N.message)})}}catch{return}finally{g(!1)}}else p.alertCancel("","Please select an image to continue."),g(!1)};return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"relative bg-gray-600 w-full h-[200px] z-[40] shadow-lg",children:[j&&s.jsx("img",{src:j,alt:"Click to upload",className:" object-cover w-full h-full  absolute z-[40]"}),s.jsx("input",{type:"file",accept:"image/*",ref:x,className:" hidden",onChange:D})]}),s.jsxs("div",{className:` flex place-items-center gap-3
                place-content-center bottom-[5px] right-[5px] w-fit z-[120] absolute`,children:[s.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:w,onMouseDown:C,children:"Browse"}),s.jsx("button",{className:` bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:v,disabled:w,children:w?"Uploading...":"Upload"})]})]})},we=({listing:e,user:m,businessProfileImageData:f})=>{let d="";f.image_url?d=M.IMG_BASE_URL+f.image_url:d="/images/placeholder-icon.webp";const[j,_]=t.useState(d),[E,T]=t.useState(null),x=t.useRef(null),[B,I]=t.useState(!1),[w,g]=t.useState(!1),p=G(),C=()=>{var r;(r=x.current)==null||r.click()},D=r=>{var h;const a=(h=r.target.files)==null?void 0:h[0];if(a){const c=URL.createObjectURL(a);_(c),T(a),I(!0)}},v=async()=>{g(!0),p.notify("Working..."),await new Promise(a=>setTimeout(a,1e3));const r=new FormData;if(B){r.append("file",E),r.append("guid",m.user_guid),r.append("bid",e.gid);const h=M.IMG_BASE_URL+"/business_profile_pic_upload";try{const c=await fetch(h,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:r});if(c.ok)p.alertReload("","Image uploaded successfully!");else{let U=c.json().then(N=>{p.alertCancel("",N.message)})}}catch{return}finally{g(!1)}}else p.alertCancel("","Please select an image to continue."),g(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden border-[2px] border-gray-200",children:[s.jsx("img",{src:j,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),s.jsx("input",{type:"file",accept:"image/*",ref:x,className:" hidden",onChange:D}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:C,children:s.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(ee,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:s.jsx("button",{className:`${w?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:v,disabled:w,children:w?"Uploading...":"Upload"})})]})},Pe=({data:e})=>{var F;console.log(e.businessProfile);const[m,f]=t.useState(null),[d,j]=t.useState(!1),_=G(),[E,T]=t.useState(null),x=e.countries;let[B,I]=t.useState(e.states),[w,g]=t.useState(e.cities);const p=(F=se)==null?void 0:F.sort((u,y)=>u.name.localeCompare(y.name)),[C,D]=t.useState(e.businessProfile.country_code),[v,r]=t.useState(e.businessProfile.state_code),[a,h]=t.useState(""),[c,U]=t.useState(""),N=async u=>{D(u),h(u);const y=await q(u);I(y),R("")},R=async u=>{r(u),U(u);const y=await H(C,u);g(y)},n=u=>{let y=u.target.value,k=u.target.name;f(S=>({...S,[k]:y}))},Y=async u=>{j(!0),_.notify("Updating business profile..."),await new Promise(S=>setTimeout(S,1e3));const y="/api/listing/"+e.businessProfile.gid,k=M.BASE_URL+y;try{const S=await fetch(k,{method:"PUT",headers:te,body:JSON.stringify(u)});if(S.ok)_.alertReload("Success!","Successfully updated!");else{const J=await S.text(),X=JSON.parse(J);throw new Error(`${X.error}`)}}catch(S){_.alertCancel("Unsuccessful",S.message)}finally{j(!1)}},{register:i,handleSubmit:L,getValues:A,setValue:P,watch:O,setError:$,formState:{errors:l,isSubmitting:z}}=me({defaultValues:e.businessProfile,resolver:fe(be)});return t.useEffect(()=>{e.businessProfile&&(P("state_code",e.businessProfile.state_code),P("city_id",e.businessProfile.city_id))},[e.businessProfile]),t.useEffect(()=>{a&&(P("state_code",""),P("city_id",""))},[a,e]),t.useEffect(()=>{c&&P("city_id","")},[c]),s.jsxs("div",{children:[s.jsx(xe,{listing:e.businessProfile,user:e.userProfile,businessProfileBgData:e.businessProfileBgData}),s.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:s.jsx("div",{className:"absolute top-[-50px]",children:s.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:s.jsx(we,{listing:e.businessProfile,user:e.userProfile,businessProfileImageData:e.businessProfileImageData})})})}),s.jsxs("div",{children:[s.jsx("hr",{}),s.jsxs("div",{className:"relative w-full flex place-items-center gap-1 place-content-end px-[10px]",children:[s.jsx("a",{href:"/web/account/portfolio",className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Portfolio"}),s.jsx("a",{href:`/${e.businessProfile.gid}`,className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Preview"}),(e==null?void 0:e.businessProfile)&&s.jsx(he,{guid:e==null?void 0:e.businessProfile.gid,userGuid:e==null?void 0:e.businessProfile.owner})]}),s.jsx("form",{className:"w-full px-[10px]",onSubmit:L(Y),children:s.jsxs("div",{className:`${pe} mt-0  rounded-lg pt-4 md:max-w-[80%]
                                lg:max-w-[60%] w-full mx-auto `,children:[s.jsx(b,{controlTitle:"Username",controlPlaceholder:"Enter username",controlName:"username",register:i,changeHandler:n,error:l.username,controlInformation:"Choose a username. "}),s.jsx(b,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:i,changeHandler:n,error:l.email_address,controlInformation:"Email address is compulsory."}),s.jsx(b,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:i,changeHandler:n,error:l.title,controlInformation:"Please enter page name. Page name is compulsory. "}),s.jsx(b,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:i,changeHandler:n,error:l.established,controlInformation:"This is the name the business was registered or started "}),s.jsx(b,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:i,changeHandler:n,error:l.address_one,width:100,controlInformation:"Contact address for the business. "}),s.jsx(b,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:i,changeHandler:n,error:l.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),s.jsx(W,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:x,register:i,changeHandler:n,error:l.country_code,setCode:N,controlInformation:"Country the business was registered. "}),s.jsx(W,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:B,register:i,changeHandler:n,error:l.state_code,setCode:R,controlInformation:"State the business was registered. "}),s.jsx(W,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:w,register:i,changeHandler:n,error:l.city_id,controlInformation:"City the business was registered. "}),s.jsx(b,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:i,changeHandler:n,error:l.zipcode,controlInformation:"Enter the zipcode. E.g.: 51234 or 845219 "}),s.jsx(b,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:i,changeHandler:n,error:l.phone,controlInformation:"Mobile number or phone number. "}),s.jsx(W,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:p,register:i,changeHandler:n,error:l.category,controlInformation:"Select business category."}),s.jsx(b,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:i,changeHandler:n,error:l.business_phrases,controlInformation:"Enter business phrases like: Solicitor, Advocate, Plumber, Business Analyst, Mechanical Engineers."}),s.jsx(b,{controlTitle:"Products",controlPlaceholder:"E.g.: Publications, Accessories, Shoes, Subscriptions, Magazines, Cars",controlName:"products",register:i,changeHandler:n,error:l.products,controlInformation:"Enter your products name like: Magazines, Generators, Accessories, Perfumes, Publications etc."}),s.jsx(b,{controlTitle:"Services",controlPlaceholder:"E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc.",controlName:"services",register:i,changeHandler:n,error:l.services,controlInformation:"Enter your services E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc."}),s.jsx(V,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:i,changeHandler:n,error:l.short_description,setValue:P,getValues:A,watch:O,controlInformationClass:Z,controlInformation:"Short description of business activities"}),s.jsx(V,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:i,changeHandler:n,error:l.long_description,setValue:P,getValues:A,watch:O,controlInformationClass:Z,controlInformation:"More description about the business."}),s.jsx(b,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:i,changeHandler:n,error:l.website,controlInformation:"Your website should look like this: http://example.com "}),s.jsx(ge,{working:d})]})})]})]})},ze=()=>{var i;t.useEffect(()=>{oe(localStorage)},[]);const e=K(),m=Q();if(!m)return null;const f=e.business_guid,d=(i=m==null?void 0:m.user)==null?void 0:i.guid,[j,_]=t.useState(!0),[E,T]=t.useState(null),[x,B]=t.useState(null),[I,w]=t.useState(null),[g,p]=t.useState(null),[C,D]=t.useState(null),[v,r]=t.useState(null),[a,h]=t.useState(null),[c,U]=t.useState(null),[N,R]=t.useState(null),[n,Y]=t.useState(null);return t.useEffect(()=>{async function L(A,P){const O=await re(A||""),$=await ne(P||""),l=await ie(),z=$,F=await q(z.country_code||""),u=await H(z.country_code||"",z.state_code||""),y=await ae(),k=await le(A||""),S=await ce(P||""),J=await ue(P||"");T(O),B($),p(l),w(F),D(u),r(k),h(S),R(y),U(J)}try{d&&f&&L(d,f)}catch(A){console.log(A.message)}},[d,f]),t.useEffect(()=>{E&&x&&g&&I&&C&&v&&N&&a&&c&&Y({userProfile:E,businessProfile:x,countries:g,states:I,cities:C,userProfileImageData:v,businessProfileImageData:a,businessProfileBgData:c,categories:N})},[N,g,I,C,v,a,E,x,c]),t.useEffect(()=>{n&&_(!1)},[n]),j?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(de,{children:n!==null&&s.jsx(Pe,{data:n})})};export{ze as default};
