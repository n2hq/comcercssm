import{r,j as e}from"./components-BAvBE3fA.js";import{A as S,C as y}from"./ContentLayout-BULv8Qdt.js";import{h as P,c as v,u as E,g as N}from"./AuthContext-Tj_b5086.js";import{z as h,u as R,s as A}from"./index-CC8pXzgA.js";import{f as C,d as L,I as q,B as k}from"./Input-Dw9jNG5H.js";import{u as I}from"./NotificationContext-C8wtauTv.js";import"./MobileNav-C2nYESeh.js";import"./index-E-6-scJO.js";import"./UserMenu-CzhSTjVp.js";const T=h.object({email:h.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),_=({loaderData:s,user:t})=>{var g;const[p,o]=r.useState(null),[d,l]=r.useState(!1),n=I(),c=i=>{let x=i.target.value,f=i.target.name;o(a=>({...a,[f]:x}))},m=async i=>{l(!0),n.notify("Sending reset password request."),await new Promise(a=>setTimeout(a,1e3));const f=v.BASE_URL+"/api/user/reset_password_request";i.owner=s.userProfile.user_guid;try{const a=await fetch(f,{method:"POST",headers:P,body:JSON.stringify(i)});if(a.ok)n.alertReload("Success!","Request Initiated. Please check your email to continue.");else{let D=a.json().then(b=>{n.alertCancel("Error handling request",b.message)})}}catch(a){n.alertCancel("Error handling request",a.message)}finally{l(!1)}},{register:u,handleSubmit:j,getValues:B,setValue:F,watch:U,setError:V,formState:{errors:w,isSubmitting:W}}=R({defaultValues:s.userProfile,resolver:A(T)});return e.jsx("form",{onSubmit:j(m),children:e.jsx("div",{className:`${C} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:L,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(g=s.userProfile)==null?void 0:g.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(q,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:u,changeHandler:c,error:w.email}),e.jsx(k,{working:d,value:"Send Reset Email"})]})})})},Q=()=>{const{user:s}=E(),[t,p]=r.useState(null),[o,d]=r.useState(null),[l,n]=r.useState(!0);return r.useEffect(()=>{async function c(m){const u=await N(m||"");p(u)}s!=null&&s.guid&&c(s==null?void 0:s.guid)},[s==null?void 0:s.guid]),r.useEffect(()=>{t&&d({userProfile:t})},[t]),r.useEffect(()=>{o&&n(!1)},[o]),l?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(S,{children:e.jsxs(y,{title:"Reset Password",children:[t===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md",children:t==null?void 0:t.email}),o&&e.jsx(_,{loaderData:o,user:s})]})})};export{Q as default};
