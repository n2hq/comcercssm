import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-CCwaTRgT.js";import{u as Y}from"./AuthContext-BLT8eIBS.js";import{E as R,a2 as K,z as Q,X as Z,Y as q,m as ee,I as te,j as se,Z as oe,_ as ae,a3 as ne,a4 as re}from"./lib-CC-22j43.js";import{u as J}from"./NotificationContext-u_i63fMA.js";import{u as $}from"./OperationContext-CaoUEJma.js";import{u as le,s as ce}from"./zod-PtQGc9r6.js";import{z as i}from"./index-C4bLmoCR.js";import{I as L,B as ie}from"./Input-BAJOR40w.js";import{S as W}from"./Select-DTLR1wti.js";import{f as de}from"./WhiteLogo-E4eqNMj1.js";import{P as ue}from"./ProfileLayout-DnTJfUK8.js";import"./UserMenu-XEbZqAOR.js";import"./index-CdGC67h0.js";import"./HomeNav-C-07gCFe.js";import"./SrchNavbar-Bfx6m5q6.js";import"./HamburgerSecondary-D_c9cnZn.js";import"./json-OCF5soII.js";const me=({user:d,userProfileImageData:o})=>{J();let a="";o!=null&&o.image_url&&(a=R.IMG_BASE_URL+o.image_url);const[w,S]=t.useState(a),[I,y]=t.useState(null),j=t.useRef(null),[v,C]=t.useState(!1),[p,N]=t.useState(!1),{showOperation:U,showSuccess:E,showError:l,showWarning:O,showInfo:b,completeOperation:h}=$(),P=()=>{var s;(s=j.current)==null||s.click()},r=s=>{var _;const n=(_=s.target.files)==null?void 0:_[0];if(n){const c=URL.createObjectURL(n);S(c),y(n),C(!0)}},u=async()=>{if(N(!0),U("processing"),await new Promise(s=>setTimeout(s,1e3)),v){const s=new FormData;s.append("file",I),s.append("guid",d.user_guid);const _=R.IMG_BASE_URL+"/user_profile_pic_upload";try{const c=await fetch(_,{method:"POST",body:s});if(c.ok)E("Success","Image uploaded."),h();else{let T=c.json().then(A=>{l("Error",A.message),h()})}}catch{l("Error","Image upload failed."),h()}finally{N(!1)}}else l("Error","Please select an image to continue"),h(),N(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden
                flex place-content-center place-items-center border-[3px] border-white`,children:[w!==""?e.jsx("img",{src:w,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}):e.jsx(K,{className:"object-cover w-[70%] h-[70%]"}),e.jsx("input",{type:"file",accept:"image/*",ref:j,className:" hidden",onChange:r}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:P,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out bg-white/50`,children:e.jsx(Q,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${p?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:u,disabled:p,children:p?"Uploading...":"Submit"})})]})},fe=i.object({first_name:i.string().min(1,{message:"Enter a first name"}),lastname:i.any(),country_code:i.any(),state_code:i.any(),city_id:i.any(),phone:i.any(),address_one:i.any(),address_two:i.any(),country:i.any(),xsocial:i.any(),linksocial:i.any(),fbsocial:i.any(),zipcode:i.any()}),pe=({listing:d,user:o,userProfileBgData:a})=>{const[w,S]=t.useState(!1),[I,y]=t.useState(""),j=t.useRef(null),[v,C]=t.useState(!1);J();const[p,N]=t.useState(null),{showOperation:U,showError:E,completeOperation:l,showSuccess:O}=$();t.useEffect(()=>{a!=null&&a.image_url&&y(R.IMG_BASE_URL+(a==null?void 0:a.image_url))},[]);const b=()=>{var r;(r=j.current)==null||r.click()},h=r=>{var s;const u=(s=r.target.files)==null?void 0:s[0];if(u){const n=URL.createObjectURL(u);y(n),N(u),C(!0)}},P=async()=>{S(!0),U("processing"),await new Promise(u=>setTimeout(u,1e3));const r=new FormData;if(v){r.append("file",p),r.append("guid",o.user_guid);const s=R.IMG_BASE_URL+"/user_profile_bg_upload";try{const n=await fetch(s,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:r});if(n.ok)try{O("Success","Image saved.")}finally{l()}else{let _=n.json().then(c=>{console.log(c.message),E("Error",c.message),l()})}}catch(n){console.log(n),E("Error","Image save failed"),l()}finally{S(!1)}}else E("Error","Please select an image to continue."),l(),S(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-black w-full h-[200px] relative shadow-lg text-white flex place-items-center place-content-center flex-col",children:[I===""&&"Add Photo.",e.jsx("img",{src:I,alt:"",className:"object-cover w-full h-full "}),e.jsx("input",{type:"file",accept:"image/*",ref:j,className:" hidden",onChange:h})]}),e.jsxs("div",{className:` flex place-items-center gap-1.5
                place-content-center top-[5px] right-[5px] w-fit z-[120] absolute`,children:[e.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:w,onMouseDown:b,children:"Browse"}),e.jsx("button",{className:`bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:P,disabled:w,children:w?"Uploading...":"Upload"})]})]})},he=({loaderData:d,user:o,userProfileData:a,userProfileBgData:w})=>{var D,V;const[S,I]=t.useState(null),[y,j]=t.useState(!1);J();const v=d.countries;let[C,p]=t.useState(d.states),[N,U]=t.useState(d.cities);d.categories;const[E,l]=t.useState((D=d.userProfileData)==null?void 0:D.country_code),[O,b]=t.useState((V=d.userProfileData)==null?void 0:V.state_code),[h,P]=t.useState(""),[r,u]=t.useState(""),{showOperation:s,showError:n,completeOperation:_,showSuccess:c}=$(),T=async m=>{l(m),P(m);const k=await Z(m);p(k),A("")},A=async m=>{b(m),u(m);const k=await q(E,m);U(k)},g=m=>{let k=m.target.value,B=m.target.name;I(G=>({...G,[B]:k}))},F=async m=>{j(!0),s("processing"),await new Promise(f=>setTimeout(f,1e3));const k="https://edition.garssete.com",B="/api/user/"+o.guid,G=k+B;try{const f=await fetch(G,{method:"PUT",headers:ee,body:JSON.stringify(m)});if(f.ok)c("Success","Updated."),_();else{var X=await f.json();throw new Error(`Error Code: ${f.status} - ${X.error}`)}}catch(f){n("Error",(f==null?void 0:f.message)||(f==null?void 0:f.error)||"Update failed."),_();return}finally{j(!1)}},{register:x,handleSubmit:H,getValues:ge,setValue:z,watch:xe,setError:we,formState:{errors:M,isSubmitting:Se}}=le({defaultValues:a,resolver:ce(fe)});return t.useEffect(()=>{h&&(z("state_code",""),z("city_id",""))},[h]),t.useEffect(()=>{r&&z("city_id","")},[r]),e.jsxs("div",{children:[e.jsx(pe,{user:a,userProfileBgData:w}),e.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:e.jsx("div",{className:"absolute top-[-50px]",children:e.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:e.jsx(me,{user:a,userProfileImageData:d.userProfileImageData})})})}),e.jsxs("div",{className:"px-[15px]",children:[e.jsx("hr",{}),e.jsx("form",{onSubmit:H(F),children:e.jsxs("div",{className:`${de} mt-0  rounded-lg pt-4
                 md:max-w-[400px] w-full mx-auto `,children:[e.jsx(L,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:x,changeHandler:g,error:M.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(L,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:x,changeHandler:g,error:M.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx(W,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:v,register:x,changeHandler:g,error:M.country_code,setCode:T,controlInformation:"Please select country. "}),e.jsx(W,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:C,register:x,changeHandler:g,setCode:A,controlInformation:"Please select state. "}),e.jsx(W,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:N,register:x,changeHandler:g,controlInformation:"Please select a city. "}),e.jsx(L,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:x,changeHandler:g,controlInformation:"Please a zipcode. "}),e.jsx(L,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:x,changeHandler:g,controlInformation:"Please enter a phone or mobile. "}),e.jsx(L,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:x,changeHandler:g,controlInformation:"Please enter an address. "}),e.jsx(L,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:x,changeHandler:g,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(ie,{working:y})]})})]})]})},ze=()=>{t.useEffect(()=>{te(localStorage)},[]);const d=Y();if(!d)return null;const{user:o}=d,[a,w]=t.useState(null),[S,I]=t.useState(null),[y,j]=t.useState(null),[v,C]=t.useState(null),[p,N]=t.useState(null),[U,E]=t.useState(null),[l,O]=t.useState(null),[b,h]=t.useState(null),[P,r]=t.useState(!0);return t.useEffect(()=>{async function u(s){try{const n=await se(s||""),_=await oe(),c=n,T=await Z(c.country_code||""),A=await q(c.country_code||"",c.state_code||""),g=await ae(),F=await ne(s||""),x=await re(s||"");w(n),j(_),I(T),C(A),N(F),E(x),O(g)}catch(n){console.log(n.message)}}o!=null&&o.guid&&u(o==null?void 0:o.guid)},[o==null?void 0:o.guid]),t.useEffect(()=>{a&&y&&S&&v&&p&&l&&h({userProfile:a,countries:y,states:S,cities:v,userProfileImageData:p,categories:l})},[l,y,S,v,p,a]),t.useEffect(()=>{b&&r(!1)},[b]),P?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Garssete"})}):e.jsx(ue,{children:a&&b&&!P&&o&&e.jsx(he,{loaderData:b,user:o,userProfileData:b.userProfile,userProfileBgData:U})})};export{ze as default};
