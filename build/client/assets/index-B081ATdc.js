import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-kAvIA9Ge.js";import{A as N,C}from"./ContentLayout-B6qiGWEm.js";import{i as P,n as L,u as A,p as R}from"./index-GByQRoqj.js";import{z as b,u as U,s as q}from"./index-CLh2UBG4.js";import{I as _,B as k}from"./Input-CyoftheY.js";import{f as B,e as F}from"./css-DMkAD1zc.js";import{u as I}from"./NotificationContext-C5j2oTiB.js";import"./MobileNav-DPPAZEV-.js";import"./Hamburger-D1YOVBs3.js";import"./index-ByWTzbAh.js";import"./HomeNav-Clr5vEBG.js";const T=b.object({email:b.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),V=({loaderData:t,user:a})=>{var x,h;const[p,r]=s.useState(null),[c,l]=s.useState(!1),i=I(),[d,g]=s.useState(!0),u=n=>{let j=n.target.value,f=n.target.name;r(m=>({...m,[f]:j}))},E=async n=>{var m;l(!0),i.notify("","Updating email..."),await new Promise(o=>setTimeout(o,1e3));const f=L.BASE_URL+"/api/user/change_email_request";n.guid=(m=t.userProfile)==null?void 0:m.user_guid;try{const o=await fetch(f,{method:"POST",headers:P,body:JSON.stringify(n)});if(o.ok)i.alertCancel("Email Change Request","Email Change Request Successfully Sent!");else{let J=o.json().then(w=>{i.alertCancel("Error",w.error)})}}catch{return}finally{l(!1)}},{register:S,handleSubmit:y,getValues:W,setValue:O,watch:z,setError:D,formState:{errors:v,isSubmitting:H}}=U({defaultValues:t.listing,resolver:q(T)});return e.jsx("form",{onSubmit:y(E),children:e.jsx("div",{className:`${B} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:F,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(x=t.userProfile)==null?void 0:x.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-[8px] px-3 py-3 bg-gray-100",children:[(h=t.userProfile)==null?void 0:h.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(_,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:S,changeHandler:u,error:v.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(k,{working:c})]})})})},re=()=>{const{user:t}=A(),[a,p]=s.useState(null),[r,c]=s.useState(null),[l,i]=s.useState(!0);return s.useEffect(()=>{async function d(g){const u=await R(g||"");p(u)}t!=null&&t.guid&&d(t==null?void 0:t.guid)},[t==null?void 0:t.guid]),s.useEffect(()=>{a&&c({userProfile:a})},[a]),s.useEffect(()=>{r&&i(!1)},[r]),l?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(N,{children:e.jsxs(C,{title:"Email Address",children:[a===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md",children:a==null?void 0:a.email}),r&&e.jsx(V,{loaderData:r,user:t})]})})};export{re as default};
