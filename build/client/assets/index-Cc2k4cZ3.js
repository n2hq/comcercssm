import{j as t}from"./jsx-runtime-0DLF9kdB.js";import{r as s,a as F}from"./components-Bk2QJ2_x.js";import{A as V,C as K}from"./ContentLayout-DtT1BXRK.js";import{u as M}from"./AuthContext-DeNGy5FN.js";import{z as r,u as q,s as G}from"./index-BH1rD2l9.js";import{E as k,H as z,h as Q,l as X,I as ee,J as te,K as se,A as oe}from"./lib-RHKiv4wQ.js";import{I as d,B as re}from"./Input-kfTxLU3u.js";import{S as E}from"./Select-yzeCpQlO.js";import{f as ne,c as ae}from"./WhiteLogo-BhUAv2T9.js";import{T as ie}from"./TextareaWithWordLimit-CpG_eAO3.js";import{u as ce}from"./NotificationContext-Cdx0hYKs.js";import{b as le}from"./json-Bhd33LFq.js";import{C as me}from"./CardHeader-BwI3w6Z4.js";import"./UserMenu-B9FBSf08.js";import"./index-DExc8zpn.js";import"./index-DJmu-Y-y.js";import"./HomeNav-DYJ1T61_.js";import"./SrchNavbar-D-yk7ccv.js";import"./HamburgerSecondary-J_GQtXkg.js";import"./index-DgE776xS.js";import"./CardTitle-e_7rmtxE.js";const de=r.object({title:r.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),category:r.string().min(1,{message:"Please select a business category."}),country_code:r.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),state_code:r.any(),city_id:r.any(),zipcode:r.string().min(1,{message:"Zipcode must not be empty"}).max(7,{message:"Zipcode must not be more than 7 characters"}),short_description:r.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=50,{message:"You can only write up to 50 words."}),email_address:r.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),phone:r.string().min(1,{message:"Phone must not be empty"}).max(30,{message:"PHone must not be more than 30 characters"}),address_one:r.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),address_two:r.any(),established:r.string().optional().refine(e=>!e||/^\d{1,4}$/.test(e),{message:"Must be only numbers and not more than 4 digits"})}).superRefine((e,c)=>{var h,u;((h=e==null?void 0:e.address_two)==null?void 0:h.length)!==0&&((u=e==null?void 0:e.address_two)==null?void 0:u.length)<3&&c.addIssue({code:r.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),ue=({data:e,user:c})=>{const[h,u]=s.useState(null),[_,p]=s.useState(!1),l=ce();F();const w=e.countries;let[j,N]=s.useState(e.states),[I,T]=s.useState(e.cities);const v=le,[S,A]=s.useState(""),[b,B]=s.useState(""),[y,f]=s.useState(""),[x,L]=s.useState(""),D=async n=>{A(n),f(n);const g=await k(n);N(g),C("")},C=async n=>{B(n),L(n);const g=await z(S,n);T(g)},o=n=>{let g=n.target.value,J=n.target.name;u(O=>({...O,[J]:g}))},Y=async n=>{p(!0),l.notify("Creating page..."),await new Promise(m=>setTimeout(m,1e3)),n.owner=c.guid;const J=X.BASE_URL+"/api/listing";try{const m=await fetch(J,{method:"POST",headers:Q,body:JSON.stringify(n)});if(m.ok){const U=async W=>{W||(window.location.href="/web/account/portfolio",await new Promise($=>setTimeout($,1e3))),l.cancel()};l.confirm("Page Created. Do you wish to create another page?",U)}else{var O=await m.json();throw new Error(`Error Code: ${m.status} - ${O.message}`)}}catch(m){l.alertCancel("Error!",m.message)}finally{p(!1)}},{register:a,handleSubmit:Z,getValues:H,watch:R,setValue:P,setError:fe,formState:{errors:i,isSubmitting:ge}}=q({resolver:G(de)});return s.useEffect(()=>{y&&(P("state_code",""),P("city_id",""))},[y]),s.useEffect(()=>{x&&P("city_id","")},[x]),t.jsx("form",{onSubmit:Z(Y),children:t.jsxs("div",{className:`${ne} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto `,children:[t.jsx(d,{controlTitle:"Business Name",controlPlaceholder:"Enter business name",controlName:"title",register:a,changeHandler:o,error:i.title,width:80,controlInformation:"Business name is compulsory."}),t.jsx(d,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:a,changeHandler:o,error:i.email_address,controlInformation:"Email address is compulsory."}),t.jsx(E,{controlTitle:"Business Category",controlName:"category",controlPlaceholder:"Select business category",selectJson:v,register:a,changeHandler:o,error:i.category,controlInformation:"Select business category."}),t.jsx(d,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:a,changeHandler:o,error:i.address_one,width:100,controlInformation:"Address of Business. E.g. 28 New York Street "}),t.jsx(d,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:a,changeHandler:o,error:i.address_two,width:100,controlInformation:"Continuation of address. E.g. Crown Tower, Off Belleveu Avenue or Valu Complex, Kingston Donnel Boulevard. "}),t.jsx(E,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:w,register:a,changeHandler:o,error:i.country_code,setCode:D,controlInformation:"Country the business was registered or active. "}),t.jsx(E,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:j,register:a,changeHandler:o,error:i.state_code,setCode:C,controlInformation:"State the business is registered or active. "}),t.jsx(E,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:I,register:a,changeHandler:o,error:i.city_id,controlInformation:"City the business is registered or active. "}),t.jsx(d,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:a,changeHandler:o,error:i.zipcode,controlInformation:"Zipcode of location of business. Eg. 92829 or 239484 "}),t.jsx(d,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:a,changeHandler:o,error:i.phone,controlInformation:"Phone OR Mobile number. "}),t.jsx(d,{controlTitle:"Year established - Optional",controlPlaceholder:"Enter year established",controlName:"established",register:a,changeHandler:o,error:i.established,controlInformation:"Year registered is compulsory."}),t.jsx(ie,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:a,changeHandler:o,error:i.short_description,setValue:P,getValues:H,watch:R,controlInformationClass:ae,controlInformation:"Enter a short description of this business. It should be a maximum of 50 words. "}),t.jsx(re,{working:_})]})})},Oe=()=>{s.useEffect(()=>{ee(localStorage)},[]);const e=M();if(!e)return null;const[c,h]=s.useState(null),[u,_]=s.useState(!0),[p,l]=s.useState(null),[w,j]=s.useState(null),[N,I]=s.useState(null),[T,v]=s.useState(null),[S,A]=s.useState(null),[b,B]=s.useState(null);return s.useEffect(()=>{const y=async f=>{const x=await te(),L=await k(""),D=await z("",""),C=await se(),o=await oe((f==null?void 0:f.guid)||"");B(o),j(x),I(L),v(D),A(C),h(f)};e!=null&&e.user&&y(e==null?void 0:e.user)},[e]),s.useEffect(()=>{c&&w&&S&&(l({user:c,countries:w,states:N,cities:T,categories:S}),_(!1))},[w,c]),u?t.jsx("div",{className:"flex justify-center items-center h-screen",children:t.jsx("div",{className:"text-lg",children:"Loading..."})}):t.jsx(V,{children:t.jsx(K,{title:"Create Business",children:p&&t.jsxs("div",{children:[t.jsx(me,{base_url:"/web/account/profile",title:b==null?void 0:b.email}),t.jsx(ue,{data:p,user:c})]})})})};export{Oe as default};
