import{j as t}from"./jsx-runtime-0DLF9kdB.js";import{r as s,a as $}from"./components-_iSq0a46.js";import{A as V,C as q}from"./ContentLayout-TY6yxOt9.js";import{u as G}from"./AuthContext-Di_kKw7g.js";import{z as r,u as K,s as M}from"./index-tW0-2oYE.js";import{q as J,r as Y,h as Q,k as X,I as ee,s as te,u as se,p as oe}from"./lib-D3V1-_xT.js";import{I as d,B as re}from"./Input-LRKC9eDG.js";import{S as j}from"./Select-BaG4yLWO.js";import{f as ae}from"./WhiteLogo-CgiFAK2a.js";import{T as ne}from"./TextareaWithWordLimit-CFVMOIl3.js";import{u as ie}from"./NotificationContext-39lnpEWE.js";import{a as ce}from"./HamburgerSecondary-BxBy3BQ0.js";import{C as le}from"./CardHeader-Bxr5h553.js";import"./UserMenu-Dwi6NMN0.js";import"./index-CTbeVz01.js";import"./index-aaHDQ7n8.js";import"./HomeNav-Cn_zMeiO.js";import"./SrchNavbar-H3YWNLnx.js";import"./index-IMbIR-_2.js";import"./CardTitle-BDvi6d6P.js";const me=r.object({title:r.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),category:r.string().min(1,{message:"Please select a business category."}),country_code:r.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),state_code:r.any(),city_id:r.any(),zipcode:r.string().min(1,{message:"Zipcode must not be empty"}).max(7,{message:"Zipcode must not be more than 7 characters"}),short_description:r.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=50,{message:"You can only write up to 50 words."}),email_address:r.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),phone:r.string().min(1,{message:"Phone must not be empty"}).max(30,{message:"PHone must not be more than 30 characters"}),address_one:r.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),address_two:r.any(),established:r.string({message:"Please enter year established"}).min(4,{message:"Year must be at least 4 characters"})}).superRefine((e,c)=>{var f,u;((f=e==null?void 0:e.address_two)==null?void 0:f.length)!==0&&((u=e==null?void 0:e.address_two)==null?void 0:u.length)<3&&c.addIssue({code:r.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),de=({data:e,user:c})=>{const[f,u]=s.useState(null),[E,p]=s.useState(!1),l=ie();$();const y=e.countries;let[N,T]=s.useState(e.states),[A,B]=s.useState(e.cities);const S=ce;console.log(S);const[x,v]=s.useState(""),[C,I]=s.useState(""),[w,g]=s.useState(""),[b,L]=s.useState(""),k=async a=>{v(a),g(a);const h=await J(a);T(h),P("")},P=async a=>{I(a),L(a);const h=await Y(x,a);B(h)},o=a=>{let h=a.target.value,z=a.target.name;u(D=>({...D,[z]:h}))},U=async a=>{p(!0),l.notify("Creating page..."),await new Promise(m=>setTimeout(m,1e3)),a.owner=c.guid;const z=X.BASE_URL+"/api/listing";try{const m=await fetch(z,{method:"POST",headers:Q,body:JSON.stringify(a)});if(m.ok){const H=async O=>{O||(window.location.href="/web/account/portfolio",await new Promise(R=>setTimeout(R,1e3))),l.cancel()};l.confirm("Page Created. Do you wish to create another page?",H)}else{var D=await m.json();throw new Error(`Error Code: ${m.status} - ${D.message}`)}}catch(m){l.alertCancel("Error!",m.message)}finally{p(!1)}},{register:n,handleSubmit:W,getValues:Z,watch:F,setValue:_,setError:ue,formState:{errors:i,isSubmitting:ge}}=K({resolver:M(me)});return s.useEffect(()=>{w&&(_("state_code",""),_("city_id",""))},[w]),s.useEffect(()=>{b&&_("city_id","")},[b]),t.jsx("form",{onSubmit:W(U),children:t.jsxs("div",{className:`${ae} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto `,children:[t.jsx(d,{controlTitle:"Business Name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:o,error:i.title,width:80,controlInformation:"Business name is compulsory."}),t.jsx(d,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:o,error:i.email_address,controlInformation:"Email address is compulsory."}),t.jsx(j,{controlTitle:"Business Category",controlName:"category",controlPlaceholder:"Select business category",selectJson:S,register:n,changeHandler:o,error:i.category,controlInformation:"Select business category."}),t.jsx(d,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:o,error:i.established,controlInformation:"Year registered is compulsory."}),t.jsx(j,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:y,register:n,changeHandler:o,error:i.country_code,setCode:k}),t.jsx(j,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:N,register:n,changeHandler:o,error:i.state_code,setCode:P}),t.jsx(j,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:A,register:n,changeHandler:o,error:i.city_id}),t.jsx(d,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:o,error:i.address_one,width:100}),t.jsx(d,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:o,error:i.address_two,width:100}),t.jsx(d,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:o,error:i.zipcode}),t.jsx(d,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:o,error:i.phone}),t.jsx(ne,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:o,error:i.short_description,setValue:_,getValues:Z,watch:F}),t.jsx(re,{working:E})]})})},ke=()=>{s.useEffect(()=>{ee(localStorage)},[]);const e=G();if(!e)return null;const[c,f]=s.useState(null),[u,E]=s.useState(!0),[p,l]=s.useState(null),[y,N]=s.useState(null),[T,A]=s.useState(null),[B,S]=s.useState(null),[x,v]=s.useState(null),[C,I]=s.useState(null);return s.useEffect(()=>{const w=async g=>{const b=await te(),L=await J(""),k=await Y("",""),P=await se(),o=await oe((g==null?void 0:g.guid)||"");I(o),N(b),A(L),S(k),v(P),f(g)};e!=null&&e.user&&w(e==null?void 0:e.user)},[e]),s.useEffect(()=>{c&&y&&x&&(l({user:c,countries:y,states:T,cities:B,categories:x}),E(!1))},[y,c]),u?t.jsx("div",{className:"flex justify-center items-center h-screen",children:t.jsx("div",{className:"text-lg",children:"Loading..."})}):t.jsx(V,{children:t.jsx(q,{title:"Create Business",children:p&&t.jsxs("div",{children:[t.jsx(le,{base_url:"/web/account/profile",title:C==null?void 0:C.email}),t.jsx(de,{data:p,user:c})]})})})};export{ke as default};
