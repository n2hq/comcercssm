import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-BgCvqN9p.js";import{A}from"./AccountLayout-CLBsVvu0.js";import{u as S}from"./AuthContext-Y60KU9R0.js";import{_ as j,O as L,n as O}from"./lib-8z_1mPj7.js";import{u as C,s as I}from"./zod-VB2z1YQj.js";import{I as T,B as W}from"./Input-RLFO6toI.js";import{z as P}from"./index-C4bLmoCR.js";import{f as D,g as F}from"./UserMenu-BwjVdiH0.js";import{u as V}from"./NotificationContext-DbZLSl6Q.js";import{u as k}from"./OperationContext-C5fIEC6d.js";import{P as B}from"./ProfileContentLayout-C1oOWWIe.js";import"./HomeNav-D_CIR8dl.js";import"./SrchNavbar-DJkczKkO.js";import"./HamburgerSecondary-gldRpDpW.js";import"./index-ByZGKDc4.js";import"./BusinessMenu-gop1aCRE.js";const U=P.object({email:P.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),z=({loaderData:n,user:t})=>{var h;const[l,d]=s.useState(null),[o,m]=s.useState(!1);V();const r=S();if(!r)return null;const{showOperation:f,showError:c,completeOperation:a,showSuccess:p}=k(),E=g=>{let w=g.target.value,x=g.target.name;d(u=>({...u,[x]:w}))},b=async g=>{var u;m(!0),f("processing","Sending reset password email"),await new Promise(i=>setTimeout(i,1e3));const x={email:(u=r==null?void 0:r.user)==null?void 0:u.email.trim()};try{const i=await r.resetpw(x);JSON.stringify(i).includes("Error")?(m(!1),c("Error",j(i)),a()):(p("Success",j(i)),a(),await new Promise(R=>setTimeout(R,1e3)),m(!1))}catch{c("Error","Password reset failed. Wait for a minute and retry."),a()}},{register:y,handleSubmit:v,getValues:H,setValue:J,watch:Y,setError:_,formState:{errors:N,isSubmitting:$}}=C({defaultValues:n.userProfile,resolver:I(U)});return e.jsx("form",{onSubmit:v(b),children:e.jsx("div",{className:`${D} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:F,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(h=n.userProfile)==null?void 0:h.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(T,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:y,changeHandler:E,error:N.email}),e.jsx(W,{working:o,value:"Send Reset Email"})]})})})},ce=()=>{s.useEffect(()=>{L(localStorage)},[]);const n=S();if(!n)return null;const{user:t}=n,[l,d]=s.useState(null),[o,m]=s.useState(null),[r,f]=s.useState(!0);return s.useEffect(()=>{async function c(a){const p=await O(a||"");d(p)}try{t!=null&&t.guid&&c(t==null?void 0:t.guid)}catch(a){console.log(a.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{l&&m({userProfile:l})},[l]),s.useEffect(()=>{o&&f(!1)},[o]),r?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(A,{children:e.jsxs(B,{title:"Reset Password",children:[l===null?"Loading...":"",o&&e.jsx(z,{loaderData:o,user:t})]})})};export{ce as default};
