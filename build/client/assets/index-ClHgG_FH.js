import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-CooaLra5.js";import{A as V,C as q}from"./ContentLayout-nkga6CC2.js";import{u as Q,s as X}from"./zod-CNQGm8c5.js";import{I as b,B as Z}from"./Input-LKsXFt_f.js";import{S as B}from"./Select-CwzDEOez.js";import{z as n}from"./index-C4bLmoCR.js";import{e as D,Q as W,R as J,h as K,I as Y,O as ee,S as te,T as se,X as oe}from"./lib-BhfUFVcs.js";import{m as ae}from"./index-C-tqg277.js";import{b as ne}from"./index-DSqZvp0J.js";import{u as G}from"./NotificationContext-BC1zLXan.js";import{f as M,g as re,b as ce}from"./WhiteLogo-Dr6RRIef.js";import{u as le}from"./AuthContext-a-szS8iM.js";import{C as ie}from"./CardHeader-i8vu4Aui.js";import"./UserMenu-DPGD_Nj9.js";import"./HomeNav-Dv8GUi4i.js";import"./SrchNavbar-C92ikz5O.js";import"./json-hcEJPlxz.js";import"./index-Dmq_GUIc.js";import"./HamburgerSecondary-DUkaVWm8.js";import"./CardTitle-0ozTtK0F.js";const de=n.object({first_name:n.string().min(1,{message:"Enter a first name"}),lastname:n.any(),country_code:n.any(),state_code:n.any(),city_id:n.any(),phone:n.any(),address_one:n.any(),address_two:n.any(),country:n.any(),xsocial:n.any(),linksocial:n.any(),fbsocial:n.any(),zipcode:n.any()}),ue=({user:r,userProfileImageData:s})=>{const o=G();let N="";s!=null&&s.image_url&&(N=D.IMG_BASE_URL+s.image_url);const[h,P]=t.useState(N),[g,y]=t.useState(null),x=t.useRef(null),[v,S]=t.useState(!1),[j,u]=t.useState(!1),E=()=>{var a;(a=x.current)==null||a.click()},m=a=>{var p;const f=(p=a.target.files)==null?void 0:p[0];if(f){const l=URL.createObjectURL(f);P(l),y(f),S(!0)}},T=async()=>{if(u(!0),o.notify("Working..."),await new Promise(a=>setTimeout(a,1e3)),v){const a=new FormData;a.append("file",g),a.append("guid",r.user_guid);const p=D.IMG_BASE_URL+"/user_profile_pic_upload";try{const l=await fetch(p,{method:"POST",body:a});if(l.ok)o.alertReload("","Image uploaded successfully!");else{let I=l.json().then(U=>{o.alertCancel("",U.message)})}}catch{return}finally{u(!1)}}else o.alertCancel("","Please select an image to continue."),u(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden
                flex place-content-center place-items-center`,children:[h!==""?e.jsx("img",{src:h,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}):e.jsx(ae,{className:"object-cover w-[70%] h-[70%]"}),e.jsx("input",{type:"file",accept:"image/*",ref:x,className:" hidden",onChange:m}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:E,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(ne,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${j?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:T,disabled:j,children:j?"Uploading...":"Uploads"})})]})},me=({loaderData:r,user:s,userProfileData:o})=>{var $,O;const[N,h]=t.useState(null),[P,g]=t.useState(!1),y=G(),x=r.countries;let[v,S]=t.useState(r.states),[j,u]=t.useState(r.cities);r.categories;const[E,m]=t.useState(($=r.userProfileData)==null?void 0:$.country_code),[T,a]=t.useState((O=r.userProfileData)==null?void 0:O.state_code),[f,p]=t.useState(""),[l,I]=t.useState(""),U=async c=>{m(c),p(c);const w=await W(c);S(w),_("")},_=async c=>{a(c),I(c);const w=await J(E,c);u(w)},i=c=>{let w=c.target.value,F=c.target.name;h(z=>({...z,[F]:w}))},A=async c=>{g(!0),y.notify("Updating user profile..."),await new Promise(C=>setTimeout(C,1e3));const w="https://edition.garssete.com",F="/api/user/"+s.guid,z=w+F;try{const C=await fetch(z,{method:"PUT",headers:K,body:JSON.stringify(c)});if(C.ok)y.alertReload("Success","Update is Successful!");else{var H=await C.json();throw new Error(`Error Code: ${C.status} - ${H.error}`)}}catch(C){y.alertCancel("Error",C.message);return}finally{g(!1)}},{register:d,handleSubmit:L,getValues:fe,setValue:k,watch:pe,setError:he,formState:{errors:R,isSubmitting:ge}}=Q({defaultValues:o,resolver:X(de)});return t.useEffect(()=>{f&&(k("state_code",""),k("city_id",""))},[f]),t.useEffect(()=>{l&&k("city_id","")},[l]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:M,children:e.jsxs("div",{className:`${re} flex flex-col place-items-center`,children:[e.jsx("div",{className:ce,children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(ue,{user:o,userProfileImageData:r.userProfileImageData})})]})}),e.jsx("hr",{}),e.jsx("form",{onSubmit:L(A),children:e.jsxs("div",{className:`${M} mt-0  rounded-lg pt-4
                 max-w-[400px] w-full mx-auto `,children:[e.jsx(b,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:d,changeHandler:i,error:R.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(b,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:d,changeHandler:i,error:R.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx(B,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:x,register:d,changeHandler:i,error:R.country_code,setCode:U,controlInformation:"Please select country. "}),e.jsx(B,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:v,register:d,changeHandler:i,setCode:_,controlInformation:"Please select state. "}),e.jsx(B,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:j,register:d,changeHandler:i,controlInformation:"Please select a city. "}),e.jsx(b,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:d,changeHandler:i,controlInformation:"Please a zipcode. "}),e.jsx(b,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:d,changeHandler:i,controlInformation:"Please enter a phone or mobile. "}),e.jsx(b,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:d,changeHandler:i,controlInformation:"Please enter an address. "}),e.jsx(b,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:d,changeHandler:i,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(Z,{working:P})]})})]})},Be=()=>{t.useEffect(()=>{Y(localStorage)},[]);const r=le();if(!r)return null;const{user:s}=r,[o,N]=t.useState(null),[h,P]=t.useState(null),[g,y]=t.useState(null),[x,v]=t.useState(null),[S,j]=t.useState(null),[u,E]=t.useState(null),[m,T]=t.useState(null),[a,f]=t.useState(!0);return t.useEffect(()=>{async function p(l){const I=await ee(l||""),U=await te(),_=I,i=await W(_.country_code||""),A=await J(_.country_code||"",_.state_code||""),d=await se(),L=await oe(l||"");N(I),y(U),P(i),v(A),j(L),E(d)}s!=null&&s.guid&&p(s==null?void 0:s.guid)},[s==null?void 0:s.guid]),t.useEffect(()=>{o&&g&&h&&x&&S&&u&&T({userProfile:o,countries:g,states:h,cities:x,userProfileImageData:S,categories:u})},[u,g,h,x,S,o]),t.useEffect(()=>{m&&f(!1)},[m]),a?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Garssete"})}):e.jsx(V,{children:e.jsx(q,{title:"Account Profile",children:o&&m&&s&&!a?e.jsxs("div",{children:[e.jsx(ie,{base_url:"/web/account/profile",title:` ${(o==null?void 0:o.first_name)||""} ${(o==null?void 0:o.lastname)||""}`}),e.jsx(me,{loaderData:m,user:s,userProfileData:m.userProfile})]}):e.jsx("div",{children:"Loading..."})})})};export{Be as default};
