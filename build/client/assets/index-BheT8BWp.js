import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-CCwaTRgT.js";import{A}from"./AccountLayout-DO3oyorg.js";import{u as S}from"./AuthContext-BLT8eIBS.js";import{V as j,I,j as L}from"./lib-CC-22j43.js";import{u as C,s as O}from"./zod-PtQGc9r6.js";import{I as T,B as V}from"./Input-BAJOR40w.js";import{z as P}from"./index-C4bLmoCR.js";import{f as W,g as D}from"./WhiteLogo-E4eqNMj1.js";import{u as F}from"./NotificationContext-u_i63fMA.js";import{u as k}from"./OperationContext-CaoUEJma.js";import{P as B}from"./ProfileContentLayout-CC3RBmKX.js";import"./UserMenu-CJEstezG.js";import"./index-CdGC67h0.js";import"./HomeNav-C-07gCFe.js";import"./SrchNavbar-DUfsO58m.js";import"./HamburgerSecondary-D_c9cnZn.js";import"./json-OCF5soII.js";import"./BusinessMenu-MNSt271k.js";const U=P.object({email:P.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),z=({loaderData:n,user:t})=>{var h;const[l,d]=s.useState(null),[o,m]=s.useState(!1);F();const r=S();if(!r)return null;const{showOperation:f,showError:c,completeOperation:a,showSuccess:p}=k(),E=g=>{let w=g.target.value,x=g.target.name;d(u=>({...u,[x]:w}))},b=async g=>{var u;m(!0),f("processing","Sending reset password email"),await new Promise(i=>setTimeout(i,1e3));const x={email:(u=r==null?void 0:r.user)==null?void 0:u.email.trim()};try{const i=await r.resetpw(x);JSON.stringify(i).includes("Error")?(m(!1),c("Error",j(i)),a()):(p("Success",j(i)),a(),await new Promise(R=>setTimeout(R,1e3)),m(!1))}catch{c("Error","Password reset failed. Wait for a minute and retry."),a()}},{register:y,handleSubmit:v,getValues:H,setValue:J,watch:Y,setError:$,formState:{errors:N,isSubmitting:q}}=C({defaultValues:n.userProfile,resolver:O(U)});return e.jsx("form",{onSubmit:v(b),children:e.jsx("div",{className:`${W} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:D,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(h=n.userProfile)==null?void 0:h.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(T,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:y,changeHandler:E,error:N.email}),e.jsx(V,{working:o,value:"Send Reset Email"})]})})})},de=()=>{s.useEffect(()=>{I(localStorage)},[]);const n=S();if(!n)return null;const{user:t}=n,[l,d]=s.useState(null),[o,m]=s.useState(null),[r,f]=s.useState(!0);return s.useEffect(()=>{async function c(a){const p=await L(a||"");d(p)}try{t!=null&&t.guid&&c(t==null?void 0:t.guid)}catch(a){console.log(a.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{l&&m({userProfile:l})},[l]),s.useEffect(()=>{o&&f(!1)},[o]),r?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(A,{children:e.jsxs(B,{title:"Reset Password",children:[l===null?"Loading...":"",o&&e.jsx(z,{loaderData:o,user:t})]})})};export{de as default};
