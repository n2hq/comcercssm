import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as a}from"./components-DN9bEK-g.js";import{A as S,C as y}from"./ContentLayout-B6bhunUs.js";import{u as P}from"./AuthContext-Di52-8xF.js";import{h as v,f as E,l as N}from"./lib-Beoi9XbN.js";import{z as j,u as R,s as A}from"./index-CORT_df8.js";import{I as C,B as L}from"./Input-B_aZf7-x.js";import{f as q,e as k}from"./WhiteLogo-Jdu1eOyO.js";import{u as I}from"./NotificationContext-Bn-KUFn_.js";import"./MobileNav-BY9m6_zI.js";import"./index-D_01F9sx.js";import"./index-CCT4pt4V.js";import"./index-CFPekBpB.js";import"./HomeNav-S9PvM5xM.js";const T=j.object({email:j.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),_=({loaderData:o,user:t})=>{var x;const[s,u]=a.useState(null),[i,m]=a.useState(!1),n=I(),d=l=>{let h=l.target.value,g=l.target.name;u(r=>({...r,[g]:h}))},c=async l=>{m(!0),n.notify("Sending reset password request."),await new Promise(r=>setTimeout(r,1e3));const g=E.BASE_URL+"/api/user/reset_password_request";l.owner=o.userProfile.user_guid;try{const r=await fetch(g,{method:"POST",headers:v,body:JSON.stringify(l)});if(r.ok)n.alertReload("Success!","Request Initiated. Please check your email to continue.");else{let D=r.json().then(b=>{n.alertCancel("Error handling request",b.message)})}}catch(r){n.alertCancel("Error handling request",r.message)}finally{m(!1)}},{register:f,handleSubmit:p,getValues:B,setValue:F,watch:U,setError:V,formState:{errors:w,isSubmitting:W}}=R({defaultValues:o.userProfile,resolver:A(T)});return e.jsx("form",{onSubmit:p(c),children:e.jsx("div",{className:`${q} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:k,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(x=o.userProfile)==null?void 0:x.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(C,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:f,changeHandler:d,error:w.email}),e.jsx(L,{working:i,value:"Send Reset Email"})]})})})},se=()=>{const o=P();if(!o)return null;const{user:t}=o,[s,u]=a.useState(null),[i,m]=a.useState(null),[n,d]=a.useState(!0);return a.useEffect(()=>{async function c(f){const p=await N(f||"");u(p)}t!=null&&t.guid&&c(t==null?void 0:t.guid)},[t==null?void 0:t.guid]),a.useEffect(()=>{s&&m({userProfile:s})},[s]),a.useEffect(()=>{i&&d(!1)},[i]),n?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(S,{children:e.jsxs(y,{title:"Reset Password",children:[s===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md",children:s==null?void 0:s.email}),i&&e.jsx(_,{loaderData:i,user:t})]})})};export{se as default};
