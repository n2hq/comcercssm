import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,c as Q}from"./components-CooaLra5.js";import{A as X,C as ee}from"./ContentLayout-DQpeTS8Q.js";import{u as se}from"./AuthContext-B0qzJKTb.js";import{x as Y,u as te,a7 as oe,a8 as Z,a9 as G,l as re,I as ne,a5 as ae,A as ie,aa as le,ab as ce,ag as ue,ah as me}from"./lib-BCLBukrA.js";import{u as de,s as ge}from"./zod-CNQGm8c5.js";import{z as o}from"./index-C4bLmoCR.js";import{u as V}from"./NotificationContext-CoL3X9fZ.js";import{f as J,g as fe,b as he,c as pe}from"./WhiteLogo-DB4_wYDt.js";import{I as f,B as be}from"./Input-8wfvqmeD.js";import{T as H}from"./TextareaWithWordLimit-CUBW1kdJ.js";import{S as W}from"./Select-DsC6cWHz.js";import{B as xe,a as ye}from"./BusinessHeader-Blgya0hR.js";import"./UserMenu-DX3qq08i.js";import"./index-DanP5xsO.js";import"./HomeNav-BgVaD2QV.js";import"./SrchNavbar-l-xy2bEb.js";import"./HamburgerSecondary-D58X9wks.js";import"./json-C1_lNnGy.js";import"./CardTitle-ii5rf5je.js";const Pe=o.object({username:o.any(),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:o.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),long_description:o.string().nullish().refine(e=>!e||e.trim()===""?!0:e.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:o.any(),state_code:o.any(),state_text:o.any(),country_text:o.any(),city_id:o.any(),established:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Year established must contain only numbers"}).refine(e=>e===""||e.length<=4,{message:"Year established must not be more than 4 digits"}),zipcode:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Zipcode must contain only numbers"}).refine(e=>e===""||e.length<=7,{message:"Zipcode must not be more than 7 digits"}),call_code:o.any(),phone:o.string().min(1,{message:"Phone must not be empty"}).max(30,{message:"PHone must not be more than 30 characters"}),intro:o.any(),category:o.string().min(2,{message:"Please select a business category"}),business_phrases:o.union([o.literal(""),o.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:o.any(),services:o.any(),xsocial:o.any(),fbsocial:o.any(),linksocial:o.any(),website:o.string().nullable().optional().refine(e=>{if(!e||e==="")return!0;try{return new URL(e),!0}catch{return!1}},{message:"Please enter a valid website. Example: http://example.com"})}).superRefine((e,d)=>{var l,c;((l=e==null?void 0:e.address_two)==null?void 0:l.length)!==0&&((c=e==null?void 0:e.address_two)==null?void 0:c.length)<3&&d.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),we=({listing:e,user:d,businessProfileImageData:l})=>{let c="";l.image_url?c=Y.IMG_BASE_URL+l.image_url:c="/images/placeholder-icon.webp";const[I,j]=t.useState(c),[N,A]=t.useState(null),p=t.useRef(null),[B,_]=t.useState(!1),[C,y]=t.useState(!1),P=V(),E=()=>{var u;(u=p.current)==null||u.click()},T=u=>{var w;const m=(w=u.target.files)==null?void 0:w[0];if(m){const g=URL.createObjectURL(m);j(g),A(m),_(!0)}},v=async()=>{y(!0),P.notify("Working..."),await new Promise(m=>setTimeout(m,1e3));const u=new FormData;if(B){u.append("file",N),u.append("guid",d.user_guid),u.append("bid",e.gid);const w=Y.IMG_BASE_URL+"/business_profile_pic_upload";try{const g=await fetch(w,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:u});if(g.ok)P.alertReload("","Image uploaded successfully!");else{let D=g.json().then(b=>{P.alertCancel("",b.message)})}}catch{return}finally{y(!1)}}else P.alertCancel("","Please select an image to continue."),y(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden",children:[s.jsx("img",{src:I,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),s.jsx("input",{type:"file",accept:"image/*",ref:p,className:" hidden",onChange:T}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:E,children:s.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(te,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:s.jsx("button",{className:`${C?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:v,disabled:C,children:C?"Uploading...":"Upload"})})]})},Se=({data:e})=>{var z;const[d,l]=t.useState(null),[c,I]=t.useState(!1),j=V(),[N,A]=t.useState(null),p=e.countries;let[B,_]=t.useState(e.states),[C,y]=t.useState(e.cities);const P=(z=oe)==null?void 0:z.sort((i,h)=>i.name.localeCompare(h.name)),[E,T]=t.useState(e.businessProfile.country_code),[v,u]=t.useState(e.businessProfile.state_code),[m,w]=t.useState(""),[g,D]=t.useState(""),b=async i=>{T(i),w(i);const h=await Z(i);_(h),U("")},U=async i=>{u(i),D(i);const h=await G(E,i);y(h)},r=i=>{let h=i.target.value,F=i.target.name;l(S=>({...S,[F]:h}))},k=async i=>{I(!0),j.notify("Updating business profile..."),await new Promise(S=>setTimeout(S,1e3));const h="/api/listing/"+e.businessProfile.gid,F=Y.BASE_URL+h;try{const S=await fetch(F,{method:"PUT",headers:re,body:JSON.stringify(i)});if(S.ok)j.alertReload("Success!","Successfully updated!");else{const q=await S.text(),K=JSON.parse(q);throw new Error(`${K.error}`)}}catch(S){j.alertCancel("Unsuccessful",S.message)}finally{I(!1)}},{register:n,handleSubmit:M,getValues:L,setValue:x,watch:O,setError:R,formState:{errors:a,isSubmitting:$}}=de({defaultValues:e.businessProfile,resolver:ge(Pe)});return t.useEffect(()=>{e.businessProfile&&(x("state_code",e.businessProfile.state_code),x("city_id",e.businessProfile.city_id))},[e.businessProfile]),t.useEffect(()=>{m&&(x("state_code",""),x("city_id",""))},[m,e]),t.useEffect(()=>{g&&x("city_id","")},[g]),s.jsx("div",{children:s.jsxs("div",{className:J,children:[s.jsxs("div",{className:`${fe} flex flex-col place-items-center`,children:[s.jsx("div",{className:he,children:"Add/Change Photo"}),s.jsx("div",{className:"mt-4",children:s.jsx(we,{listing:e.businessProfile,user:e.userProfile,businessProfileImageData:e.businessProfileImageData})})]}),s.jsx("hr",{className:"w-full"}),s.jsx("form",{className:" w-full",onSubmit:M(k),children:s.jsxs("div",{className:`${J} mt-0  rounded-lg pt-4
                                lg:max-w-[500px] w-full mx-auto  `,children:[s.jsx(f,{controlTitle:"Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:r,error:a.username,controlInformation:"Choose a username. "}),s.jsx(f,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:r,error:a.email_address,controlInformation:"Email address is compulsory."}),s.jsx(f,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:r,error:a.title,controlInformation:"Please enter page name. Page name is compulsory. "}),s.jsx(f,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:r,error:a.established,controlInformation:"This is the name the business was registered or started "}),s.jsx(f,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:r,error:a.address_one,width:100,controlInformation:"Contact address for the business. "}),s.jsx(f,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:r,error:a.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),s.jsx(W,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:p,register:n,changeHandler:r,error:a.country_code,setCode:b,controlInformation:"Country the business was registered. "}),s.jsx(W,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:B,register:n,changeHandler:r,error:a.state_code,setCode:U,controlInformation:"State the business was registered. "}),s.jsx(W,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:C,register:n,changeHandler:r,error:a.city_id,controlInformation:"City the business was registered. "}),s.jsx(f,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:r,error:a.zipcode,controlInformation:"Enter the zipcode. E.g.: 51234 or 845219 "}),s.jsx(f,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:r,error:a.phone,controlInformation:"Mobile number or phone number. "}),s.jsx(W,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:P,register:n,changeHandler:r,error:a.category,controlInformation:"Select business category."}),s.jsx(f,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:n,changeHandler:r,error:a.business_phrases,controlInformation:"Enter business phrases like: Solicitor, Advocate, Plumber, Business Analyst, Mechanical Engineers."}),s.jsx(f,{controlTitle:"Products",controlPlaceholder:"E.g.: Publications, Accessories, Shoes, Subscriptions, Magazines, Cars",controlName:"products",register:n,changeHandler:r,error:a.products,controlInformation:"Enter your products name like: Magazines, Generators, Accessories, Perfumes, Publications etc."}),s.jsx(f,{controlTitle:"Services",controlPlaceholder:"E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc.",controlName:"services",register:n,changeHandler:r,error:a.services,controlInformation:"Enter your services E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc."}),s.jsx(H,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:r,error:a.short_description,setValue:x,getValues:L,watch:O,controlInformationClass:pe,controlInformation:"Enter your services E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc."}),s.jsx(H,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:r,error:a.long_description,setValue:x,getValues:L,watch:O}),s.jsx(f,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:r,error:a.website,controlInformation:"Your website should look like this: http://example.com "}),s.jsx(be,{working:c})]})})]})})},Ye=()=>{var r;t.useEffect(()=>{ne(localStorage)},[]);const e=Q(),d=se();if(!d)return null;const l=e.business_guid,c=(r=d==null?void 0:d.user)==null?void 0:r.guid,[I,j]=t.useState(!0),[N,A]=t.useState(null),[p,B]=t.useState(null),[_,C]=t.useState(null),[y,P]=t.useState(null),[E,T]=t.useState(null),[v,u]=t.useState(null),[m,w]=t.useState(null),[g,D]=t.useState(null),[b,U]=t.useState(null);return t.useEffect(()=>{async function k(n,M){const L=await ae(n||""),x=await ie(M||""),O=await le(),R=x,a=await Z(R.country_code||""),$=await G(R.country_code||"",R.state_code||""),z=await ce(),i=await ue(n||""),h=await me(M||"");A(L),B(x),P(O),C(a),T($),u(i),w(h),D(z)}c&&l&&k(c,l)},[c,l]),t.useEffect(()=>{N&&p&&y&&_&&E&&v&&g&&m&&U({userProfile:N,businessProfile:p,countries:y,states:_,cities:E,userProfileImageData:v,businessProfileImageData:m,categories:g})},[g,y,_,E,v,m,N,p]),t.useEffect(()=>{b&&j(!1)},[b]),I?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(X,{children:s.jsxs(ee,{title:"Update Business",businessGuid:l,data:b,businessProfile:p,children:[s.jsx(xe,{businessGuid:l,data:b,businessProfile:p}),b&&s.jsxs("div",{children:[l&&c&&s.jsx(ye,{guid:l,userGuid:c}),s.jsx(Se,{data:b})]})]})})};export{Ye as default};
