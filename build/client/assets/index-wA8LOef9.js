import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r,c as G,L as Z}from"./components-DN9bEK-g.js";import{A as K,C as Q}from"./ContentLayout-Dmj5mJqn.js";import{u as X}from"./AuthContext-Bw1iO2U4.js";import{i as F,o as J,p as $,h as ee,n as se,e as te,q as oe,r as re,v as ne,x as ae}from"./lib-mi7X90Kj.js";import{z as o,u as ie,s as le}from"./index-CORT_df8.js";import{b as ce}from"./index-BqiilUUJ.js";import{u as H}from"./NotificationContext-DIsBguWG.js";import{f as O,e as ue,a as de}from"./WhiteLogo-Q21Q_qJt.js";import{I as u,B as me}from"./Input-9-dRVDEr.js";import{T as Y}from"./TextareaWithWordLimit-CdKLe8GM.js";import{S as R}from"./Select-BVCMF9Ds.js";import{B as fe}from"./BusinessMenu-BlqJeUcB.js";import{C as he}from"./CardTitle-Vm8bzRht.js";import"./UserMenu-DuiTAoTF.js";import"./index-_V50BjgN.js";import"./HomeNav-BEbpq4eX.js";import"./SrchNavbar-tp8rR0qb.js";import"./HamburgerSecondary-D1k80ChW.js";const ge=o.object({username:o.any(),title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:o.string().refine(s=>s.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(s=>s.trim().split(/\s+/).filter(Boolean).length<=50,{message:"You can only write up to 50 words."}),long_description:o.string().refine(s=>s.trim().split(/\s+/).filter(Boolean).length>=100,{message:"You must write at least 100 words."}).refine(s=>s.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:o.any(),state_code:o.any(),state_text:o.any(),country_text:o.any(),city_id:o.any(),established:o.string({message:"Please enter year established"}).min(4,{message:"Year must be at least 4 characters"}),call_code:o.any(),phone:o.any(),zipcode:o.any(),intro:o.any(),category:o.string().min(2,{message:"Please select a business category"}),business_phrases:o.union([o.literal(""),o.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:o.any(),services:o.any(),xsocial:o.any(),fbsocial:o.any(),linksocial:o.any(),website:o.union([o.string().url().nullish(),o.literal("")])}).superRefine((s,d)=>{var l,c;((l=s==null?void 0:s.address_two)==null?void 0:l.length)!==0&&((c=s==null?void 0:s.address_two)==null?void 0:c.length)<3&&d.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),pe=({listing:s,user:d,businessProfileImageData:l})=>{let c="";l.image_url?c=F.IMG_BASE_URL+l.image_url:c="/images/imgplaceholder.jpg";const[v,S]=r.useState(c),[_,T]=r.useState(null),h=r.useRef(null),[E,N]=r.useState(!1),[C,x]=r.useState(!1),y=H(),I=()=>{var m;(m=h.current)==null||m.click()},B=m=>{var j;const f=(j=m.target.files)==null?void 0:j[0];if(f){const g=URL.createObjectURL(f);S(g),T(f),N(!0)}},P=async()=>{x(!0),y.notify("Working..."),await new Promise(f=>setTimeout(f,1e3));const m=new FormData;if(E){m.append("file",_),m.append("guid",d.user_guid),m.append("bid",s.gid);const j=F.IMG_BASE_URL+"/business_profile_pic_upload";try{const g=await fetch(j,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:m});if(g.ok)y.alertReload("","Image uploaded successfully!");else{let D=g.json().then(t=>{y.alertCancel("",t.message)})}}catch{return}finally{x(!1)}}else y.alertCancel("","Please select an image to continue."),x(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden",children:[e.jsx("img",{src:v,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),e.jsx("input",{type:"file",accept:"image/*",ref:h,className:" hidden",onChange:B}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:I,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(ce,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`${C?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:P,disabled:C,children:C?"Uploading...":"Upload"})})]})},be=({data:s})=>{const[d,l]=r.useState(null),[c,v]=r.useState(!1),S=H(),_=s.countries;let[T,h]=r.useState(s.states),[E,N]=r.useState(s.cities);const C=s.categories.data,[x,y]=r.useState(s.businessProfile.country_code),[I,B]=r.useState(s.businessProfile.state_code),[P,m]=r.useState(""),[f,j]=r.useState(""),g=async i=>{y(i),m(i);const w=await J(i);h(w),D("")},D=async i=>{B(i),j(i);const w=await $(x,i);N(w)},t=i=>{let w=i.target.value,U=i.target.name;l(b=>({...b,[U]:w}))},z=async i=>{v(!0),S.notify("Updating business profile..."),await new Promise(b=>setTimeout(b,1e3));const w="/api/listing/"+s.businessProfile.gid,U=F.BASE_URL+w;try{const b=await fetch(U,{method:"PUT",headers:ee,body:JSON.stringify(i)});if(b.ok)S.alertReload("Success!","Successfully updated!");else throw new Error(`HTTP error! Status: ${b.status}`)}catch(b){S.alertCancel("Error!",b.message)}finally{v(!1)}},{register:n,handleSubmit:L,getValues:k,setValue:p,watch:A,setError:M,formState:{errors:a,isSubmitting:W}}=ie({defaultValues:s.businessProfile,resolver:le(ge)});return r.useEffect(()=>{s.businessProfile&&(p("state_code",s.businessProfile.state_code),p("city_id",s.businessProfile.city_id))},[s.businessProfile]),r.useEffect(()=>{P&&(p("state_code",""),p("city_id",""))},[P,s]),r.useEffect(()=>{f&&p("city_id","")},[f]),e.jsx("div",{children:e.jsxs("div",{className:O,children:[e.jsxs("div",{className:`${ue} flex flex-col place-items-center`,children:[e.jsx("div",{className:de,children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(pe,{listing:s.businessProfile,user:s.userProfile,businessProfileImageData:s.businessProfileImageData})})]}),e.jsx("hr",{className:"w-full"}),e.jsx("form",{className:" w-full",onSubmit:L(z),children:e.jsxs("div",{className:`${O} mt-0  rounded-lg pt-4
                                lg:max-w-[500px] w-full mx-auto  `,children:[e.jsx(u,{controlTitle:"Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:t,error:a.username,controlInformation:"Choose a username. "}),e.jsx(u,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:t,error:a.title,controlInformation:"Please enter page name. Page name is compulsory. "}),e.jsx(u,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:t,error:a.established,controlInformation:"This is the name the business was registered or started "}),e.jsx(R,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:_,register:n,changeHandler:t,error:a.country_code,setCode:g,controlInformation:"This is the country the business was registered. "}),e.jsx(R,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:T,register:n,changeHandler:t,error:a.state_code,setCode:D,controlInformation:"This is the state the business was registered. "}),e.jsx(R,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:E,register:n,changeHandler:t,error:a.city_id,controlInformation:"This is the city the business was registered. "}),e.jsx(u,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:t,error:a.address_one,width:100,controlInformation:"Contact address for the business. "}),e.jsx(u,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:t,error:a.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),e.jsx(u,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:t,error:a.zipcode,controlInformation:"Enter the zipcode. "}),e.jsx(u,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:t,error:a.phone,controlInformation:"Mobile number or phoone number. "}),e.jsx(R,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:C,register:n,changeHandler:t,error:a.category}),e.jsx(u,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:n,changeHandler:t,error:a.business_phrases}),e.jsx(u,{controlTitle:"Products",controlPlaceholder:"Enter products",controlName:"products",register:n,changeHandler:t,error:a.products}),e.jsx(u,{controlTitle:"Services",controlPlaceholder:"Enter services",controlName:"services",register:n,changeHandler:t,error:a.services}),e.jsx(Y,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:t,error:a.short_description,setValue:p,getValues:k,watch:A}),e.jsx(Y,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:t,error:a.long_description,setValue:p,getValues:k,watch:A}),e.jsx(u,{controlTitle:"Twitter",controlPlaceholder:"@handle",controlName:"xsocial",register:n,changeHandler:t,error:a.address}),e.jsx(u,{controlTitle:"Facebook",controlPlaceholder:"@handle",controlName:"fbsocial",register:n,changeHandler:t,error:a.fbsocial}),e.jsx(u,{controlTitle:"LinkedIn",controlPlaceholder:"https://linkedin.com/company/username",controlName:"linksocial",register:n,changeHandler:t,error:a.linksocial}),e.jsx(u,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:t,error:a.website}),e.jsx(me,{working:c})]})})]})})},Re=()=>{var n,L;const s=G(),d=X();if(!d)return null;const l=s.business_guid,c=(n=d==null?void 0:d.user)==null?void 0:n.guid,[v,S]=r.useState(!0),[_,T]=r.useState(null),[h,E]=r.useState(null),[N,C]=r.useState(null),[x,y]=r.useState(null),[I,B]=r.useState(null),[P,m]=r.useState(null),[f,j]=r.useState(null),[g,D]=r.useState(null),[t,z]=r.useState(null);return r.useEffect(()=>{async function k(p,A){const M=await se(p||""),a=await te(A||""),W=await oe(),i=a,w=await J(i.country_code||""),U=await $(i.country_code||"",i.state_code||""),b=await re(),V=await ne(p||""),q=await ae(A||"");T(M),E(a),y(W),C(w),B(U),m(V),j(q),D(b)}c&&l&&k(c,l)},[c,l]),r.useEffect(()=>{_&&h&&x&&N&&I&&P&&g&&f&&z({userProfile:_,businessProfile:h,countries:x,states:N,cities:I,userProfileImageData:P,businessProfileImageData:f,categories:g})},[g,x,N,I,P,f,_,h]),r.useEffect(()=>{t&&S(!1)},[t]),v?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(K,{children:e.jsx(Q,{title:"Update Business",children:t&&e.jsxs("div",{children:[e.jsxs("div",{className:`bg-blue-100 w-full px-2 
                            flex place-content-between rounded-lg
                            place-items-center h-auto py-2 gap-[5px]
                            leading-[1.5em]`,children:[e.jsx("div",{className:"h-full",children:e.jsx(he,{baseUrl:"/web/account/portfolio/",guid:l,children:(L=t==null?void 0:t.businessProfile)==null?void 0:L.title})}),e.jsx(Z,{to:`/${h==null?void 0:h.gid}`,children:e.jsx("button",{className:`px-3 border border-black
                                    py-2 rounded-full hover:bg-white`,children:"Preview"})})]}),l&&c&&e.jsx(fe,{guid:l,userGuid:c}),e.jsx(be,{data:t})]})})})};export{Re as default};
