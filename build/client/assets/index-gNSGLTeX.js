import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-qdL6XBti.js";import{u as q}from"./AuthContext-BnKqVxnU.js";import{z as L,aa as H,w as X,X as D,Y as V,p as Y,I as K,j as Q,Z as ee,_ as te,ab as se,ac as oe}from"./lib-gdbuLEb8.js";import{u as W}from"./NotificationContext-BN71CfFW.js";import{u as ae,s as ne}from"./zod-g2XesUsp.js";import{z as c}from"./index-C4bLmoCR.js";import{I as k,B as re}from"./Input-BGESB1pz.js";import{S as B}from"./Select-BF1xdZV7.js";import{f as le}from"./WhiteLogo-BTe8ysqQ.js";import{P as ce}from"./ProfileLayout-7irUhfnf.js";import"./UserMenu-CECLlKRK.js";import"./index-CeMHKdet.js";import"./HomeNav-CYWF0wT0.js";import"./SrchNavbar-AcngZQKL.js";import"./json-BNowKBeR.js";const ie=({user:i,userProfileImageData:o})=>{const a=W();let x="";o!=null&&o.image_url&&(x=L.IMG_BASE_URL+o.image_url);const[p,_]=t.useState(x),[g,w]=t.useState(null),u=t.useRef(null),[v,m]=t.useState(!1),[y,S]=t.useState(!1),N=()=>{var s;(s=u.current)==null||s.click()},j=s=>{var l;const r=(l=s.target.files)==null?void 0:l[0];if(r){const n=URL.createObjectURL(r);_(n),w(r),m(!0)}},C=async()=>{if(S(!0),a.notify("Working..."),await new Promise(s=>setTimeout(s,1e3)),v){const s=new FormData;s.append("file",g),s.append("guid",i.user_guid);const l=L.IMG_BASE_URL+"/user_profile_pic_upload";try{const n=await fetch(l,{method:"POST",body:s});if(n.ok)a.alertReload("","Image uploaded successfully!");else{let I=n.json().then(b=>{a.alertCancel("",b.message)})}}catch{return}finally{S(!1)}}else a.alertCancel("","Please select an image to continue."),S(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden
                flex place-content-center place-items-center border-[3px] border-white`,children:[p!==""?e.jsx("img",{src:p,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}):e.jsx(H,{className:"object-cover w-[70%] h-[70%]"}),e.jsx("input",{type:"file",accept:"image/*",ref:u,className:" hidden",onChange:j}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:N,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out bg-white/50`,children:e.jsx(X,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${y?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:C,disabled:y,children:y?"Uploading...":"Submit"})})]})},de=c.object({first_name:c.string().min(1,{message:"Enter a first name"}),lastname:c.any(),country_code:c.any(),state_code:c.any(),city_id:c.any(),phone:c.any(),address_one:c.any(),address_two:c.any(),country:c.any(),xsocial:c.any(),linksocial:c.any(),fbsocial:c.any(),zipcode:c.any()}),ue=({listing:i,user:o,userProfileBgData:a})=>{const[x,p]=t.useState(!1),[_,g]=t.useState(""),w=t.useRef(null),[u,v]=t.useState(!1),m=W(),[y,S]=t.useState(null);t.useEffect(()=>{a!=null&&a.image_url?g(L.IMG_BASE_URL+(a==null?void 0:a.image_url)):g("/images/newyork.jpg")},[]);const N=()=>{var s;(s=w.current)==null||s.click()},j=s=>{var l;const r=(l=s.target.files)==null?void 0:l[0];if(r){const n=URL.createObjectURL(r);g(n),S(r),v(!0)}},C=async()=>{p(!0),m.notify("Working..."),await new Promise(r=>setTimeout(r,1e3));const s=new FormData;if(u){s.append("file",y),s.append("guid",o.user_guid);const l=L.IMG_BASE_URL+"/user_profile_bg_upload";try{const n=await fetch(l,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:s});if(n.ok)m.alertReload("","Image uploaded successfully!");else{let I=n.json().then(b=>{m.alertCancel("",b.message)})}}catch(n){console.log(n);return}finally{p(!1)}}else m.alertCancel("","Please select an image to continue."),p(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-black w-full h-[200px] relative shadow-lg",children:[e.jsx("img",{src:_,alt:"user",className:"object-cover w-full h-full"}),e.jsx("input",{type:"file",accept:"image/*",ref:w,className:" hidden",onChange:j})]}),e.jsxs("div",{className:` flex place-items-center gap-3
                place-content-center bottom-[5px] right-[5px] w-fit z-[120] absolute`,children:[e.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:x,onMouseDown:N,children:"Browse"}),e.jsx("button",{className:`bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:C,disabled:x,children:x?"Uploading...":"Upload"})]})]})},me=({loaderData:i,user:o,userProfileData:a,userProfileBgData:x})=>{var J,$;const[p,_]=t.useState(null),[g,w]=t.useState(!1),u=W(),v=i.countries;let[m,y]=t.useState(i.states),[S,N]=t.useState(i.cities);i.categories;const[j,C]=t.useState((J=i.userProfileData)==null?void 0:J.country_code),[s,r]=t.useState(($=i.userProfileData)==null?void 0:$.state_code),[l,n]=t.useState(""),[I,b]=t.useState(""),E=async f=>{C(f),n(f);const P=await D(f);y(P),A("")},A=async f=>{r(f),b(f);const P=await V(j,f);N(P)},d=f=>{let P=f.target.value,M=f.target.name;_(O=>({...O,[M]:P}))},T=async f=>{w(!0),u.notify("Updating user profile..."),await new Promise(U=>setTimeout(U,1e3));const P="https://edition.garssete.com",M="/api/user/"+o.guid,O=P+M;try{const U=await fetch(O,{method:"PUT",headers:Y,body:JSON.stringify(f)});if(U.ok)u.alertReload("Success","Update is Successful!");else{var Z=await U.json();throw new Error(`Error Code: ${U.status} - ${Z.error}`)}}catch(U){u.alertCancel("Error",U.message);return}finally{w(!1)}},{register:h,handleSubmit:F,getValues:G,setValue:R,watch:fe,setError:pe,formState:{errors:z,isSubmitting:ge}}=ae({defaultValues:a,resolver:ne(de)});return t.useEffect(()=>{l&&(R("state_code",""),R("city_id",""))},[l]),t.useEffect(()=>{I&&R("city_id","")},[I]),e.jsxs("div",{children:[e.jsx(ue,{user:a,userProfileBgData:x}),e.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:e.jsx("div",{className:"absolute top-[-50px]",children:e.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:e.jsx(ie,{user:a,userProfileImageData:i.userProfileImageData})})})}),e.jsxs("div",{className:"px-[15px]",children:[e.jsx("hr",{}),e.jsx("form",{onSubmit:F(T),children:e.jsxs("div",{className:`${le} mt-0  rounded-lg pt-4
                 md:max-w-[400px] w-full mx-auto `,children:[e.jsx(k,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:h,changeHandler:d,error:z.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(k,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:h,changeHandler:d,error:z.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx(B,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:v,register:h,changeHandler:d,error:z.country_code,setCode:E,controlInformation:"Please select country. "}),e.jsx(B,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:m,register:h,changeHandler:d,setCode:A,controlInformation:"Please select state. "}),e.jsx(B,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:S,register:h,changeHandler:d,controlInformation:"Please select a city. "}),e.jsx(k,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:h,changeHandler:d,controlInformation:"Please a zipcode. "}),e.jsx(k,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:h,changeHandler:d,controlInformation:"Please enter a phone or mobile. "}),e.jsx(k,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:h,changeHandler:d,controlInformation:"Please enter an address. "}),e.jsx(k,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:h,changeHandler:d,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(re,{working:g})]})})]})]})},Re=()=>{t.useEffect(()=>{K(localStorage)},[]);const i=q();if(!i)return null;const{user:o}=i,[a,x]=t.useState(null),[p,_]=t.useState(null),[g,w]=t.useState(null),[u,v]=t.useState(null),[m,y]=t.useState(null),[S,N]=t.useState(null),[j,C]=t.useState(null),[s,r]=t.useState(null),[l,n]=t.useState(!0);return t.useEffect(()=>{async function I(b){try{const E=await Q(b||""),A=await ee(),d=E,T=await D(d.country_code||""),h=await V(d.country_code||"",d.state_code||""),F=await te(),G=await se(b||""),R=await oe(b||"");x(E),w(A),_(T),v(h),y(G),N(R),C(F)}catch(E){console.log(E.message)}}o!=null&&o.guid&&I(o==null?void 0:o.guid)},[o==null?void 0:o.guid]),t.useEffect(()=>{a&&g&&p&&u&&m&&j&&r({userProfile:a,countries:g,states:p,cities:u,userProfileImageData:m,categories:j})},[j,g,p,u,m,a]),t.useEffect(()=>{s&&n(!1)},[s]),l?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Garssete"})}):e.jsx(ce,{children:a&&s&&!l&&o&&e.jsx(me,{loaderData:s,user:o,userProfileData:s.userProfile,userProfileBgData:S})})};export{Re as default};
