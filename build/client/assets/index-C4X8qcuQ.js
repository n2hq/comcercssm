import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-CCwaTRgT.js";import{u as H}from"./AuthContext-BLT8eIBS.js";import{E as T,a2 as X,z as Y,X as D,Y as V,m as K,I as Q,j as ee,Z as te,_ as se,a3 as oe,a4 as ae}from"./lib-CC-22j43.js";import{u as G}from"./NotificationContext-u_i63fMA.js";import{u as Z}from"./OperationContext-BhT9SWU1.js";import{u as ne,s as re}from"./zod-PtQGc9r6.js";import{z as i}from"./index-C4bLmoCR.js";import{I as L,B as le}from"./Input-BAJOR40w.js";import{S as B}from"./Select-DTLR1wti.js";import{f as ce}from"./WhiteLogo-E4eqNMj1.js";import{P as ie}from"./ProfileLayout-BUfQvs7q.js";import"./UserMenu-CJEstezG.js";import"./index-CdGC67h0.js";import"./HomeNav-C-07gCFe.js";import"./SrchNavbar-DUfsO58m.js";import"./HamburgerSecondary-D_c9cnZn.js";import"./json-OCF5soII.js";const de=({user:d,userProfileImageData:o})=>{G();let n="";o!=null&&o.image_url&&(n=T.IMG_BASE_URL+o.image_url);const[x,w]=t.useState(n),[N,p]=t.useState(null),S=t.useRef(null),[g,I]=t.useState(!1),[h,j]=t.useState(!1),{showOperation:C,showSuccess:E,showError:m,showWarning:v,showInfo:b,completeOperation:y}=Z(),_=()=>{var s;(s=S.current)==null||s.click()},P=s=>{var c;const l=(c=s.target.files)==null?void 0:c[0];if(l){const a=URL.createObjectURL(l);w(a),p(l),I(!0)}},r=async()=>{if(j(!0),C("processing"),await new Promise(s=>setTimeout(s,1e3)),g){const s=new FormData;s.append("file",N),s.append("guid",d.user_guid);const c=T.IMG_BASE_URL+"/user_profile_pic_upload";try{const a=await fetch(c,{method:"POST",body:s});if(a.ok)E("Success","Image uploaded."),y();else{let U=a.json().then(u=>{m("Error",u.message),y()})}}catch{m("Error","Image upload failed."),y()}finally{j(!1)}}else m("Error","Please select an image to continue"),y(),j(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden
                flex place-content-center place-items-center border-[3px] border-white`,children:[x!==""?e.jsx("img",{src:x,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}):e.jsx(X,{className:"object-cover w-[70%] h-[70%]"}),e.jsx("input",{type:"file",accept:"image/*",ref:S,className:" hidden",onChange:P}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:_,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out bg-white/50`,children:e.jsx(Y,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${h?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:r,disabled:h,children:h?"Uploading...":"Submit"})})]})},ue=i.object({first_name:i.string().min(1,{message:"Enter a first name"}),lastname:i.any(),country_code:i.any(),state_code:i.any(),city_id:i.any(),phone:i.any(),address_one:i.any(),address_two:i.any(),country:i.any(),xsocial:i.any(),linksocial:i.any(),fbsocial:i.any(),zipcode:i.any()}),me=({listing:d,user:o,userProfileBgData:n})=>{const[x,w]=t.useState(!1),[N,p]=t.useState(""),S=t.useRef(null),[g,I]=t.useState(!1),h=G(),[j,C]=t.useState(null),{showOperation:E,showError:m,completeOperation:v,showSuccess:b}=Z();t.useEffect(()=>{n!=null&&n.image_url?p(T.IMG_BASE_URL+(n==null?void 0:n.image_url)):p("/images/newyork.jpg")},[]);const y=()=>{var r;(r=S.current)==null||r.click()},_=r=>{var l;const s=(l=r.target.files)==null?void 0:l[0];if(s){const c=URL.createObjectURL(s);p(c),C(s),I(!0)}},P=async()=>{w(!0),E("processing"),await new Promise(s=>setTimeout(s,1e3));const r=new FormData;if(g){r.append("file",j),r.append("guid",o.user_guid);const l=T.IMG_BASE_URL+"/user_profile_bg_upload";try{const c=await fetch(l,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:r});if(c.ok)try{b("Success","Image saved.")}finally{v()}else{let a=c.json().then(U=>{console.log(U.message),m("Error",U.message),v()})}}catch(c){console.log(c),m("Error","Image save failed"),v()}finally{w(!1)}}else h.alertCancel("","Please select an image to continue."),w(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-black w-full h-[200px] relative shadow-lg",children:[e.jsx("img",{src:N,alt:"user",className:"object-cover w-full h-full"}),e.jsx("input",{type:"file",accept:"image/*",ref:S,className:" hidden",onChange:_})]}),e.jsxs("div",{className:` flex place-items-center gap-3
                place-content-center bottom-[5px] right-[5px] w-fit z-[120] absolute`,children:[e.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:x,onMouseDown:y,children:"Browse"}),e.jsx("button",{className:`bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:P,disabled:x,children:x?"Uploading...":"Upload"})]})]})},fe=({loaderData:d,user:o,userProfileData:n,userProfileBgData:x})=>{var J,$;const[w,N]=t.useState(null),[p,S]=t.useState(!1),g=G(),I=d.countries;let[h,j]=t.useState(d.states),[C,E]=t.useState(d.cities);d.categories;const[m,v]=t.useState((J=d.userProfileData)==null?void 0:J.country_code),[b,y]=t.useState(($=d.userProfileData)==null?void 0:$.state_code),[_,P]=t.useState(""),[r,s]=t.useState(""),l=async f=>{v(f),P(f);const k=await D(f);j(k),c("")},c=async f=>{y(f),s(f);const k=await V(m,f);E(k)},a=f=>{let k=f.target.value,z=f.target.name;N(M=>({...M,[z]:k}))},U=async f=>{S(!0),g.notify("Updating user profile..."),await new Promise(A=>setTimeout(A,1e3));const k="https://edition.garssete.com",z="/api/user/"+o.guid,M=k+z;try{const A=await fetch(M,{method:"PUT",headers:K,body:JSON.stringify(f)});if(A.ok)g.alertReload("Success","Update is Successful!");else{var q=await A.json();throw new Error(`Error Code: ${A.status} - ${q.error}`)}}catch(A){g.alertCancel("Error",A.message);return}finally{S(!1)}},{register:u,handleSubmit:O,getValues:W,setValue:R,watch:pe,setError:ge,formState:{errors:F,isSubmitting:he}}=ne({defaultValues:n,resolver:re(ue)});return t.useEffect(()=>{_&&(R("state_code",""),R("city_id",""))},[_]),t.useEffect(()=>{r&&R("city_id","")},[r]),e.jsxs("div",{children:[e.jsx(me,{user:n,userProfileBgData:x}),e.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:e.jsx("div",{className:"absolute top-[-50px]",children:e.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:e.jsx(de,{user:n,userProfileImageData:d.userProfileImageData})})})}),e.jsxs("div",{className:"px-[15px]",children:[e.jsx("hr",{}),e.jsx("form",{onSubmit:O(U),children:e.jsxs("div",{className:`${ce} mt-0  rounded-lg pt-4
                 md:max-w-[400px] w-full mx-auto `,children:[e.jsx(L,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:u,changeHandler:a,error:F.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(L,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:u,changeHandler:a,error:F.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx(B,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:I,register:u,changeHandler:a,error:F.country_code,setCode:l,controlInformation:"Please select country. "}),e.jsx(B,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:h,register:u,changeHandler:a,setCode:c,controlInformation:"Please select state. "}),e.jsx(B,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:C,register:u,changeHandler:a,controlInformation:"Please select a city. "}),e.jsx(L,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:u,changeHandler:a,controlInformation:"Please a zipcode. "}),e.jsx(L,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:u,changeHandler:a,controlInformation:"Please enter a phone or mobile. "}),e.jsx(L,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:u,changeHandler:a,controlInformation:"Please enter an address. "}),e.jsx(L,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:u,changeHandler:a,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(le,{working:p})]})})]})]})},Te=()=>{t.useEffect(()=>{Q(localStorage)},[]);const d=H();if(!d)return null;const{user:o}=d,[n,x]=t.useState(null),[w,N]=t.useState(null),[p,S]=t.useState(null),[g,I]=t.useState(null),[h,j]=t.useState(null),[C,E]=t.useState(null),[m,v]=t.useState(null),[b,y]=t.useState(null),[_,P]=t.useState(!0);return t.useEffect(()=>{async function r(s){try{const l=await ee(s||""),c=await te(),a=l,U=await D(a.country_code||""),u=await V(a.country_code||"",a.state_code||""),O=await se(),W=await oe(s||""),R=await ae(s||"");x(l),S(c),N(U),I(u),j(W),E(R),v(O)}catch(l){console.log(l.message)}}o!=null&&o.guid&&r(o==null?void 0:o.guid)},[o==null?void 0:o.guid]),t.useEffect(()=>{n&&p&&w&&g&&h&&m&&y({userProfile:n,countries:p,states:w,cities:g,userProfileImageData:h,categories:m})},[m,p,w,g,h,n]),t.useEffect(()=>{b&&P(!1)},[b]),_?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Garssete"})}):e.jsx(ie,{children:n&&b&&!_&&o&&e.jsx(fe,{loaderData:b,user:o,userProfileData:b.userProfile,userProfileBgData:C})})};export{Te as default};
