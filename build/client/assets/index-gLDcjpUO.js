import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s,b as U}from"./components-kAvIA9Ge.js";import{A as V,C as q}from"./ContentLayout-CZtaOHA6.js";import{q as J,r as W,j as G,o as K,u as M,s as Q,t as X}from"./index-BxK7zvFJ.js";import{z as o,u as ee,s as te}from"./index-CLh2UBG4.js";import{I as d,B as se}from"./Input-BGXasvAf.js";import{S as b}from"./Select-tDs6RUfr.js";import{f as oe}from"./css-DMkAD1zc.js";import{T as re}from"./TextareaWithWordLimit-ClSsGQmQ.js";import{u as ae}from"./NotificationContext-FWhkxiE2.js";import"./MobileNav-1MM-OJCr.js";import"./Hamburger-J4jB7Ggx.js";import"./index-DTO0etKg.js";const ne=o.object({title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),category:o.string().min(1,{message:"Please select a business category."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),state_code:o.any(),city_id:o.any(),zipcode:o.string().min(1,{message:"Zipcode must not be empty"}).max(7,{message:"Zipcode must not be more than 7 characters"}),short_description:o.string({message:"Please enter business phrase"}).min(3,{message:"Short Description must not be less than 3 characters"}).max(1e3,{message:"Short Description must not be more than 1000 characters"}),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),phone:o.string().min(1,{message:"Phone must not be empty"}).max(30,{message:"PHone must not be more than 30 characters"}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),address_two:o.any(),established:o.string({message:"Please enter year established"}).min(4,{message:"Year must be at least 4 characters"})}).superRefine((t,c)=>{var h,u;((h=t==null?void 0:t.address_two)==null?void 0:h.length)!==0&&((u=t==null?void 0:t.address_two)==null?void 0:u.length)<3&&c.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),ie=({data:t,user:c})=>{const[h,u]=s.useState(null),[C,f]=s.useState(!1),l=ae();U();const p=t.countries;let[P,j]=s.useState(t.states),[_,E]=s.useState(t.cities);const N=t.categories.data,[y,T]=s.useState(""),[v,A]=s.useState(""),[S,B]=s.useState(""),[x,I]=s.useState(""),Z=async r=>{T(r),B(r);const g=await J(r);j(g),z("")},z=async r=>{A(r),I(r);const g=await W(y,r);E(g)},a=r=>{let g=r.target.value,D=r.target.name;u(L=>({...L,[D]:g}))},k=async r=>{f(!0),l.notify("Creating page..."),await new Promise(m=>setTimeout(m,1e3)),r.owner=c.guid;const D=K.BASE_URL+"/api/listing";try{const m=await fetch(D,{method:"POST",headers:G,body:JSON.stringify(r)});if(m.ok){const Y=async $=>{$||(window.location.href="/web/account/portfolio",await new Promise(H=>setTimeout(H,1e3))),l.cancel()};l.confirm("Page Created. Do you wish to create another page?",Y)}else{var L=await m.json();throw new Error(`Error Code: ${m.status} - ${L.message}`)}}catch(m){l.alertCancel("Error!",m.message)}finally{f(!1)}},{register:n,handleSubmit:F,getValues:O,watch:R,setValue:w,setError:ce,formState:{errors:i,isSubmitting:le}}=ee({resolver:te(ne)});return s.useEffect(()=>{S&&(w("state_code",""),w("city_id",""))},[S]),s.useEffect(()=>{x&&w("city_id","")},[x]),e.jsx("form",{onSubmit:F(k),children:e.jsxs("div",{className:`${oe} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto `,children:[e.jsx(d,{controlTitle:"Business Name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:a,error:i.title,width:80,controlInformation:"Business name is compulsory."}),e.jsx(d,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:a,error:i.email_address,controlInformation:"Email address is compulsory."}),e.jsx(b,{controlTitle:"Business Category",controlName:"category",controlPlaceholder:"Select business category",selectJson:N,register:n,changeHandler:a,error:i.category,controlInformation:"Select business category."}),e.jsx(d,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:a,error:i.established,controlInformation:"Year registered is compulsory."}),e.jsx(b,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:p,register:n,changeHandler:a,error:i.country_code,setCode:Z}),e.jsx(b,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:P,register:n,changeHandler:a,error:i.state_code,setCode:z}),e.jsx(b,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:_,register:n,changeHandler:a,error:i.city_id}),e.jsx(d,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:a,error:i.address_one,width:100}),e.jsx(d,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:a,error:i.address_two,width:100}),e.jsx(d,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:a,error:i.zipcode}),e.jsx(d,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:a,error:i.phone}),e.jsx(re,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:a,error:i.short_description,setValue:w,getValues:O,watch:R}),e.jsx(se,{working:C})]})})},Pe=()=>{const t=M(),[c,h]=s.useState(null),[u,C]=s.useState(!0),[f,l]=s.useState(null),[p,P]=s.useState(null),[j,_]=s.useState(null),[E,N]=s.useState(null),[y,T]=s.useState(null);return s.useEffect(()=>{const v=async A=>{const S=await Q(),B=await J(""),x=await W("",""),I=await X();P(S),_(B),N(x),T(I),h(A)};t!=null&&t.user&&v(t==null?void 0:t.user)},[t]),s.useEffect(()=>{c&&p&&y&&(l({user:c,countries:p,states:j,cities:E,categories:y}),C(!1))},[p,c]),u?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(V,{children:e.jsx(q,{title:"Create Page",children:f&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2 text-md",children:"Create a page"}),e.jsx(ie,{data:f,user:c})]})})})};export{Pe as default};
