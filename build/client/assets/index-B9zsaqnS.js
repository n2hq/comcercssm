import{r as t,j as e}from"./components-UScJPEQZ.js";import{A as q,C as K}from"./ContentLayout-CH9JGj2M.js";import{z as n,u as Z,s as H}from"./index-DFVatVxl.js";import{a as Q,b as D,c as X,d as Y,f as W,i as ee,I as P,B as te}from"./Input-BLmtOyFp.js";import{b as se,c as ae}from"./MobileNav-aPg5T7ro.js";import{a as O,b as $,h as oe,u as ne,g as re,d as le,e as ce,f as ie}from"./AuthContext-DP2umk9J.js";import{u as G}from"./NotificationContext-LbrYtE65.js";import"./UserMenu-Bxj1AbP9.js";import"./index-DOwvlINV.js";const z=({controlName:s,controlTitle:a,controlPlaceholder:C,selectJson:r,register:u,changeHandler:m,error:g,setCode:i,controlInformation:h})=>{const[x,N]=t.useState(!1);return t.useEffect(()=>{u&&m&&r&&setTimeout(()=>{N(!0)},1e3)},[u,m,r]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:Q,children:[e.jsxs("div",{className:D,children:[e.jsx("div",{className:"mb-0",children:a}),(h==null?void 0:h.length)>1&&e.jsx("div",{className:X,children:h})]}),e.jsxs("div",{className:"w-[90%]",children:[x&&e.jsxs("select",{...u(s,{onChange:l=>{m(l),i&&i(l.target.value)}}),className:Y,children:[e.jsx("option",{value:"",children:C}),r.map((l,y)=>e.jsx("option",{value:l.id,children:l.name},y))]}),g&&e.jsxs("div",{className:"input__class__error",children:[e.jsx(se,{className:"text-lg"}),g.message]})]})]})})},de=n.object({first_name:n.string().min(1,{message:"Enter a first name"}),lastname:n.any(),country_code:n.any(),state_code:n.any(),city_id:n.any(),phone:n.any(),address_one:n.any(),address_two:n.any(),country:n.any(),xsocial:n.any(),linksocial:n.any(),fbsocial:n.any(),zipcode:n.any()}),ue=({user:s,userProfileImageData:a})=>{const C="https://oxbyt.com",r=G();let u="";a!=null&&a.image_url?u=C+a.image_url:u="https://trendyblinds.ca/wp-content/uploads/2023/09/3.-3D-WALLPAPER-SKU0015.jpg";const[m,g]=t.useState(u),[i,h]=t.useState(null),x=t.useRef(null),[N,l]=t.useState(!1),[y,f]=t.useState(!1),E=()=>{var o;(o=x.current)==null||o.click()},U=o=>{var S;const j=(S=o.target.files)==null?void 0:S[0];if(j){const _=URL.createObjectURL(j);g(_),h(j),l(!0)}},A=async()=>{if(f(!0),r.notify("Working..."),await new Promise(o=>setTimeout(o,1e3)),N){const o=new FormData;o.append("file",i),o.append("guid",s.user_guid);const _="https://oxbyt.com"+"/user_profile_pic_upload";try{const w=await fetch(_,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:o});if(w.ok)r.alertReload("","Image uploaded successfully!");else{let I=w.json().then(c=>{r.alertCancel("",c.message)})}}catch{return}finally{f(!1)}}else r.alertCancel("","Please select an image to continue."),f(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden`,children:[e.jsx("img",{src:m,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),e.jsx("input",{type:"file",accept:"image/*",ref:x,className:" hidden",onChange:U}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:E,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(ae,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${y?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:A,disabled:y,children:y?"Uploading...":"Upload"})})]})},me=({loaderData:s,user:a,userProfileData:C})=>{var B,M;const[r,u]=t.useState(null),[m,g]=t.useState(!1),i=G(),h=s.countries;let[x,N]=t.useState(s.states),[l,y]=t.useState(s.cities);s.categories;const[f,E]=t.useState((B=s.userProfileData)==null?void 0:B.country_code),[U,A]=t.useState((M=s.userProfileData)==null?void 0:M.state_code),[o,j]=t.useState(""),[S,_]=t.useState(""),w=async d=>{E(d),j(d);const v=await O(d);N(v),I("")},I=async d=>{A(d),_(d);const v=await $(f,d);y(v)},c=d=>{let v=d.target.value,R=d.target.name;u(F=>({...F,[R]:v}))},L=async d=>{g(!0),i.notify("Updating user profile..."),await new Promise(b=>setTimeout(b,1e3));const v="https://tynk.cc",R="/api/user/"+a.guid,F=v+R;try{const b=await fetch(F,{method:"PUT",headers:oe,body:JSON.stringify(d)});if(b.ok)i.alertReload("Success","Update is Successful!");else{var J=await b.json();throw new Error(`Error Code: ${b.status} - ${J.error}`)}}catch(b){i.alertCancel("Error",b.message);return}finally{g(!1)}},{register:p,handleSubmit:V,getValues:fe,setValue:T,watch:pe,setError:he,formState:{errors:k,isSubmitting:xe}}=Z({defaultValues:C,resolver:H(de)});return t.useEffect(()=>{o&&(T("state_code",""),T("city_id",""))},[o]),t.useEffect(()=>{S&&T("city_id","")},[S]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:W,children:e.jsxs("div",{className:`${ee} flex flex-col place-items-center`,children:[e.jsx("div",{className:D,children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(ue,{user:C,userProfileImageData:s.userProfileImageData})})]})}),e.jsx("hr",{}),e.jsx("form",{onSubmit:V(L),children:e.jsxs("div",{className:`${W} mt-0  rounded-lg pt-4
                 max-w-[400px] w-full mx-auto `,children:[e.jsx(P,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:p,changeHandler:c,error:k.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(P,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:p,changeHandler:c,error:k.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx(z,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:h,register:p,changeHandler:c,error:k.country_code,setCode:w,controlInformation:"Please select country. "}),e.jsx(z,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:x,register:p,changeHandler:c,setCode:I,controlInformation:"Please select state. "}),e.jsx(z,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:l,register:p,changeHandler:c,controlInformation:"Please select a city. "}),e.jsx(P,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:p,changeHandler:c,controlInformation:"Please a zipcode. "}),e.jsx(P,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:p,changeHandler:c,controlInformation:"Please enter a phone or mobile. "}),e.jsx(P,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:p,changeHandler:c,controlInformation:"Please enter an address. "}),e.jsx(P,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:p,changeHandler:c,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(te,{working:m})]})})]})},be=()=>{const{user:s}=ne(),[a,C]=t.useState(null),[r,u]=t.useState(null),[m,g]=t.useState(null),[i,h]=t.useState(null),[x,N]=t.useState(null),[l,y]=t.useState(null),[f,E]=t.useState(null),[U,A]=t.useState(!0);return t.useEffect(()=>{async function o(j){const S=await re(j||""),_=await le(),w=S,I=await O(w.country_code||""),c=await $(w.country_code||"",w.state_code||""),L=await ce(),p=await ie(j||"");C(S),g(_),u(I),h(c),N(p),y(L)}s!=null&&s.guid&&o(s==null?void 0:s.guid)},[s==null?void 0:s.guid]),t.useEffect(()=>{a&&m&&r&&i&&x&&l&&E({userProfile:a,countries:m,states:r,cities:i,userProfileImageData:x,categories:l})},[l,m,r,i,x,a]),t.useEffect(()=>{f&&A(!1)},[f]),U?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(q,{children:e.jsx(K,{title:"Account Profile",children:a&&f&&s&&!U?e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 text-md",children:[a==null?void 0:a.first_name," ",a==null?void 0:a.lastname]}),e.jsx(me,{loaderData:f,user:s,userProfileData:f.userProfile})]}):e.jsx("div",{children:"Loading..."})})})};export{be as default};
