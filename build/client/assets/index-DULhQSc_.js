import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as a}from"./components-kAvIA9Ge.js";import{A as S,C as y}from"./ContentLayout-8Ebijivq.js";import{h as P,i as v,u as E,j as N}from"./index-WKNWlyJ5.js";import{z as h,u as R,s as A}from"./index-CLh2UBG4.js";import{I as C,B as L}from"./Input-l9dxNTT7.js";import{f as q,e as k}from"./css-DMkAD1zc.js";import{u as I}from"./NotificationContext-ww5sY1hZ.js";import"./MobileNav-sL5bwZn0.js";import"./WhiteLogo-rEYCCE-c.js";import"./index-D1npojxj.js";import"./Hamburger-CJc3nZ7T.js";import"./UserMenu-DmWssK1n.js";import"./index-B5TRE6qw.js";const T=h.object({email:h.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),_=({loaderData:t,user:s})=>{var g;const[p,o]=a.useState(null),[c,l]=a.useState(!1),i=I(),m=n=>{let x=n.target.value,f=n.target.name;o(r=>({...r,[f]:x}))},d=async n=>{l(!0),i.notify("Sending reset password request."),await new Promise(r=>setTimeout(r,1e3));const f=v.BASE_URL+"/api/user/reset_password_request";n.owner=t.userProfile.user_guid;try{const r=await fetch(f,{method:"POST",headers:P,body:JSON.stringify(n)});if(r.ok)i.alertReload("Success!","Request Initiated. Please check your email to continue.");else{let D=r.json().then(b=>{i.alertCancel("Error handling request",b.message)})}}catch(r){i.alertCancel("Error handling request",r.message)}finally{l(!1)}},{register:u,handleSubmit:j,getValues:B,setValue:F,watch:U,setError:V,formState:{errors:w,isSubmitting:W}}=R({defaultValues:t.userProfile,resolver:A(T)});return e.jsx("form",{onSubmit:j(d),children:e.jsx("div",{className:`${q} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:k,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(g=t.userProfile)==null?void 0:g.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(C,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:u,changeHandler:m,error:w.email}),e.jsx(L,{working:c,value:"Send Reset Email"})]})})})},se=()=>{const{user:t}=E(),[s,p]=a.useState(null),[o,c]=a.useState(null),[l,i]=a.useState(!0);return a.useEffect(()=>{async function m(d){const u=await N(d||"");p(u)}t!=null&&t.guid&&m(t==null?void 0:t.guid)},[t==null?void 0:t.guid]),a.useEffect(()=>{s&&c({userProfile:s})},[s]),a.useEffect(()=>{o&&i(!1)},[o]),l?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(S,{children:e.jsxs(y,{title:"Reset Password",children:[s===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md",children:s==null?void 0:s.email}),o&&e.jsx(_,{loaderData:o,user:t})]})})};export{se as default};
