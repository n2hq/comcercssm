import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r}from"./components-kAvIA9Ge.js";import{A as S,C as y}from"./ContentLayout-Dn78VBwf.js";import{j as P,o as v,u as E,q as N}from"./index-DH32Dgz8.js";import{z as h,u as R,s as q}from"./index-CLh2UBG4.js";import{I as A,B as C}from"./Input-C4CMi0xl.js";import{f as L,e as k}from"./css-DPrdeFsB.js";import{u as I}from"./NotificationContext-B4iz9144.js";import"./MobileNav-CLmV9V7l.js";import"./Hamburger-DiDLOwFG.js";import"./HomeNav-B9UZLzFB.js";const T=h.object({email:h.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),_=({loaderData:t,user:s})=>{var g;const[p,o]=r.useState(null),[c,l]=r.useState(!1),i=I(),m=n=>{let x=n.target.value,f=n.target.name;o(a=>({...a,[f]:x}))},d=async n=>{l(!0),i.notify("Sending reset password request."),await new Promise(a=>setTimeout(a,1e3));const f=v.BASE_URL+"/api/user/reset_password_request";n.owner=t.userProfile.user_guid;try{const a=await fetch(f,{method:"POST",headers:P,body:JSON.stringify(n)});if(a.ok)i.alertReload("Success!","Request Initiated. Please check your email to continue.");else{let D=a.json().then(b=>{i.alertCancel("Error handling request",b.message)})}}catch(a){i.alertCancel("Error handling request",a.message)}finally{l(!1)}},{register:u,handleSubmit:j,getValues:B,setValue:F,watch:U,setError:V,formState:{errors:w,isSubmitting:W}}=R({defaultValues:t.userProfile,resolver:q(T)});return e.jsx("form",{onSubmit:j(d),children:e.jsx("div",{className:`${L} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:k,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(g=t.userProfile)==null?void 0:g.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(A,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:u,changeHandler:m,error:w.email}),e.jsx(C,{working:c,value:"Send Reset Email"})]})})})},Z=()=>{const{user:t}=E(),[s,p]=r.useState(null),[o,c]=r.useState(null),[l,i]=r.useState(!0);return r.useEffect(()=>{async function m(d){const u=await N(d||"");p(u)}t!=null&&t.guid&&m(t==null?void 0:t.guid)},[t==null?void 0:t.guid]),r.useEffect(()=>{s&&c({userProfile:s})},[s]),r.useEffect(()=>{o&&i(!1)},[o]),l?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(S,{children:e.jsxs(y,{title:"Reset Password",children:[s===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md",children:s==null?void 0:s.email}),o&&e.jsx(_,{loaderData:o,user:t})]})})};export{Z as default};
