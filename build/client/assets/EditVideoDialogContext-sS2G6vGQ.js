import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-qdL6XBti.js";import{u as se}from"./NotificationContext-CwI8K3Da.js";import{z as K}from"./index-C4bLmoCR.js";import{X as de,Y as X,B as ce,a as ue,Z as me,_ as fe,k as he,$ as ve,E as pe}from"./lib-CAoDFbwa.js";import{I as ge}from"./index-Ddk6WeWA.js";const ie=t.createContext(null);function ke(){return t.useContext(ie)}const xe=/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).{8,}$/;K.object({videolink:K.string({message:"Please enter the video link"}),url:K.string().url("Video link is not valid."),videotitle:K.string({message:"Please enter a password"}).min(8,"Password must be at least 8 characters").regex(xe,"Please enter a valid password"),videodescription:K.string().trim().max(500,"Description must be less than 500 characters.").optional()});function Ne({children:p}){const[T,c]=t.useState(!1),[m,C]=t.useState(!1),[o,_]=t.useState(null),[l,D]=t.useState(null),[N,G]=t.useState(null),[g,R]=t.useState(!1),[L,M]=t.useState(null),r=se(),[x,n]=t.useState(null),[u,h]=t.useState(null),[b,a]=t.useState(!1),[$,k]=t.useState(!1),[f,Z]=t.useState(void 0),[O,F]=t.useState("");t.useEffect(()=>{m&&(a(!1),k(!1),Z(void 0),F(""))},[m]),t.useEffect(()=>{O&&O.trim().length>0?(a(!1),k(!0)):(a(!1),k(!1))},[O]);const A=()=>{C(!1),_(null)};t.useEffect(()=>{const i=document.getElementById("videolink");Z(i)},[]),t.useEffect(()=>{(f==null?void 0:f.value.trim().length)>0&&k(!0)},[f]);const W=()=>{const i=document.getElementById("videolink");te(i.value)};async function J(i){const B=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${i}&format=json`;try{const s=await fetch(B);if(!s.ok)throw new Error("Video not found");const w=await s.json();return!0}catch{return console.error("❌ Invalid or unavailable video"),!1}}const te=async i=>{r.notify(),await new Promise(v=>setTimeout(v,1e3));const B=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,s=i.match(B);let w=s?s[1]:null,P=`https://img.youtube.com/vi/${w}/0.jpg`,y={videoId:w,videoUrl:i,videoThumbnail:P};if(await J(w))try{n(y),a(!0);const v=document.getElementById("yt-iframe");v.src=`https://www.youtube.com/embed/${y==null?void 0:y.videoId}`}finally{r.cancel()}else r.alertCancel("Video error!","Video could not be loaded!");await new Promise(v=>setTimeout(v,1e3)),n(y)};t.useEffect(()=>{const i=document.getElementById("yt-iframe");i!=null&&i.onload&&console.log("✅ Iframe page loaded"),h(i)},[]);const oe=i=>{F(i)},Y=async()=>{c(!0),r.notify("Submitting..."),await new Promise(Q=>setTimeout(Q,1e3));let i=document.getElementById("videolink"),B=document.getElementById("videotitle"),s=document.getElementById("videodescr"),w=i.value,P=B.value,y=s.value;if(w.trim().length<=0)return r.alertCancel("Submission error!","Enter a Video link!"),c(!1),!1;if(P.trim().length<=0)return r.alertCancel("Submission error!","Video title should not be empty!"),c(!1),!1;if(y.trim().length>500)return r.alertCancel("Submission error!","Video description should not be more than 500 characters!"),c(!1),!1;const v=await de({video_url:w,video_title:P,video_description:y,user_guid:l,business_guid:N,video_guid:""});v!=null&&v.data.videoInsertId?r==null||r.alertReload("Completed","Video Link Submitted Successfully."):r==null||r.alertCancel("Submission Error","Video Link submission failed.")};let q={dialog:m,setDialog:C,imgSrc:o,setImgSrc:_,handleCloseDialog:A,userGuid:l,setUserGuid:D,businessGuid:N,setBusinessGuid:G,isImgSelected:g,setIsImageSelected:R,selectedFile:L,setSelectedFile:M};return e.jsxs(ie.Provider,{value:q,children:[m&&e.jsx("div",{className:`flex w-screen h-screen z-[3000] 
                fixed top-0 left-0 right-0 bottom-0 bg-black/30 rounded-[8px]
                place-content-center place-items-center overflow-hidden`,children:e.jsx("div",{className:`relative w-[90%] h-[80%] bg-white 
                        rounded-[8px] overflow-x-hidden overflow-y-hidden z-[3000]`,onClick:i=>{i.preventDefault()},children:e.jsxs("div",{className:"relative h-full overflow-y-auto",children:[e.jsx("div",{className:"relative w-full h-[75%] max-h-[75%] bg-black",children:e.jsx("div",{className:" relative w-full h-full",children:e.jsx("iframe",{id:"yt-iframe",src:x!=null&&x.videoId?`https://www.youtube.com/embed/${x==null?void 0:x.videoId}`:void 0,className:"absolute top-0 left-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})})}),e.jsx("div",{className:"flex mb-1 ",children:e.jsx("input",{id:"videolink",type:"text",placeholder:"Enter Video Link",className:"w-full bg-gray-100 px-3 py-4 ",onKeyUp:i=>{oe(i.target.value)}})}),e.jsx("div",{className:"flex mb-1 ",children:e.jsx("input",{id:"videotitle",type:"text",placeholder:"Enter Video Title",className:"w-full bg-gray-100 px-3 py-4 "})}),e.jsx("div",{children:e.jsx("textarea",{id:"videodescr",placeholder:"Enter picture description.",className:"w-full bg-gray-100 px-3  h-[60px] py-3"})}),e.jsxs("div",{className:"flex place-content-end px-3 gap-2",children:[e.jsx("button",{onMouseDown:()=>A(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Cancel"}),e.jsx("button",{onClick:()=>Y(),className:`bg-blue-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4 ${b?"block":"hidden"}`,children:"Submit"}),e.jsx("button",{onClick:()=>W(),disabled:!$,className:`${$?"bg-blue-800":"bg-blue-300"} ${b&&"hidden"} text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Verify"})]})]})})}),p]})}const le=t.createContext(null);function Ie(){return t.useContext(le)}const Ee=({children:p})=>{const[T,c]=t.useState(!1),[m,C]=t.useState(null),[o,_]=t.useState([]),[l,D]=t.useState(0),[N,G]=t.useState(null);t.useRef(0),t.useRef(0);const[g,R]=t.useState(!1),L=()=>{c(!1)},M=()=>{const u=o[l],h=document.getElementById(u==null?void 0:u.video_guid);l!==0&&(h.src="");let b=l===0?o.length-1:l-1;const a=o[b],$=document.getElementById(a==null?void 0:a.video_guid),k=X(a==null?void 0:a.video_url);$.src=`https://www.youtube.com/embed/${k}`,D(f=>f===0?o.length-1:f-1)},r=()=>{const u=o[l],h=document.getElementById(u==null?void 0:u.video_guid);l!==o.length-1&&(h.src="");let b=l===o.length-1?0:l+1;const a=o[b],$=document.getElementById(a==null?void 0:a.video_guid),k=X(a==null?void 0:a.video_url);$.src=`https://www.youtube.com/embed/${k}`,D(f=>f===o.length-1?0:f+1)};t.useEffect(()=>{m!==null&&D(m-1)},[m]);let x={dialog:T,setDialog:c,selectedSlide:m,setSelectedSlide:C,slides:o,setGallery:_,setListing:G};return t.useEffect(()=>{const n=u=>{u.key==="Escape"&&L()};return T&&document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[T]),e.jsxs(le.Provider,{value:x,children:[T&&e.jsx("div",{className:`flex w-screen h-screen bg-white z-[20001] 
                fixed top-0 left-0 right-0 bottom-0 `,children:e.jsxs("div",{className:"grid grid-cols-12 gap-0 w-full",children:[e.jsxs("div",{className:`${g?"col-span-12":"col-span-12 md:col-span-9"}  w-full h-full relative bg-black flex`,children:[e.jsx("div",{className:" w-full h-screen flex overflow-hidden",children:o&&m&&o.map((n,u)=>{console.log(n==null?void 0:n.video_url);const h=X(n==null?void 0:n.video_url),b=`https://www.youtube.com/embed/${h}`;return Date.now().toString()+h,e.jsx("div",{style:{transform:`translateX(-${l*100}%)`},className:`object-scale-down w-full h-full 
                   block flex-shrink-0 flex-grow-0 transition-transform 
                   ease-in-out duration-1000 relative`,children:e.jsx("iframe",{id:n==null?void 0:n.video_guid,src:b,className:"absolute top-0 left-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})},u)})}),e.jsx("button",{onMouseDown:()=>{M()},className:`block absolute top-0 bottom-0 
                                                p-[1rem] cursor-pointer left-0 group h-full 
                                                transition duration-1000 ease-in-out`,children:e.jsx("div",{className:`w-[50px] h-[50px] bg-white/60 rounded-full flex place-content-center place-items-center group-hover:bg-white/30
                                                        transition duration-500 ease-in-out`,children:e.jsx(ce,{className:" stroke-white fill-black w-[2rem] h-[2rem]"})})}),e.jsx("button",{onMouseDown:r,className:`block absolute top-0 bottom-0 
                                                    p-[1rem] cursor-pointer ${g?"right-5":"right-5 md:right-0"}  group 
                                                     transition duration-1000 ease-in-out`,children:e.jsx("div",{className:`w-[50px] h-[50px] bg-white/60 rounded-full flex place-content-center place-items-center group-hover:bg-white/30
                                                        transition duration-500 ease-in-out`,children:e.jsx(ue,{className:" stroke-white fill-black w-[2rem] h-[2rem]"})})}),e.jsx("div",{onMouseDown:()=>L(),className:`w-[50px] h-[50px] z-[300] bg-white
                                                    flex place-content-center place-items-center
                                                    rounded-full absolute left-2 top-2 cursor-pointer
                                                    hover:bg-white/40 transition duration-1000 ease-in-out`,children:e.jsx(ge,{className:"text-[30px]"})}),e.jsx("div",{onClick:()=>{R(!g)},className:`w-[50px] h-[50px] z-[300] bg-white flex place-content-center place-items-center rounded-full absolute ${g?"right-10":"right-10 md:right-5"} top-20 cursor-pointer hover:bg-white/40 transition duration-1000 ease-in-out`,children:g?e.jsx(me,{className:"text-[30px]"}):e.jsx(fe,{className:"text-[30px]"})})]}),e.jsxs("div",{className:`${g?"hidden":"hidden md:block md:col-span-3"}   px-5 overflow-x-hidden overflow-y-auto h-full bg-white`,children:[e.jsxs("h1",{className:" text-[22px] my-4 font-sans font-extrabold tracking-tight leading-[24px]",children:["Videos for ",N&&N.title]}),e.jsxs("div",{className:" my-4 ",children:[l+1," / ",o.length]}),e.jsx("hr",{}),e.jsx("div",{className:"my-4 whitespace-pre-line border-b pb-2",children:o[l].video_title}),o[l].video_description&&e.jsxs("div",{className:"my-4 whitespace-pre-line  pt-0 pb-8 ",children:[e.jsx("div",{className:"font-bold text-lg mb-3",children:"Description"}),e.jsx("div",{children:o[l].video_description})]})]})]})}),p]})},ne=t.createContext(null);function Ce(){const p=t.useContext(ne);if(!p)throw new Error("Wrap the app with an EditVideoDialogProvider!");return p}function _e({children:p}){const[T,c]=t.useState(!1),[m,C]=t.useState(!1),[o,_]=t.useState(null),[l,D]=t.useState(null),[N,G]=t.useState(null),[g,R]=t.useState(!1),[L,M]=t.useState(null),[r,x]=t.useState(null),[n,u]=t.useState(null),[h,b]=t.useState(null),[a,$]=t.useState(null),[k,f]=t.useState(null),[Z,O]=t.useState(null),[F,A]=t.useState(!1),[W,J]=t.useState(!0),[te,oe]=t.useState(void 0),[Y,q]=t.useState(""),[i,B]=t.useState(null);t.useRef(null);const s=se();t.useEffect(()=>{Y.trim().length>0&&(A(!1),J(!0))},[Y]),t.useEffect(()=>{if(o){const d=X(o);B(d)}},[o]);const w=()=>{C(!1),_(null),c(!1)},P=async()=>{c(!0),s.notify("Submitting..."),await new Promise(ee=>setTimeout(ee,1e3));let d=document.getElementById("videolink"),U=document.getElementById("videotitle"),S=document.getElementById("videodescr"),I=d.value,z=U.value,j=S.value;if(I.trim().length<=0)return s.alertCancel("Submission error!","Enter a Video link!"),c(!1),!1;if(z.trim().length<=0)return s.alertCancel("Submission error!","Video title should not be empty!"),c(!1),!1;if(j.trim().length>500)return s.alertCancel("Submission error!","Video description should not be more than 500 characters!"),c(!1),!1;const V=await ve({video_url:I,video_title:z,video_description:j,user_guid:l,business_guid:N,video_guid:h});(V==null?void 0:V.data.success)===!0?s==null||s.alertReload("Successful","Video link updated successfully."):s==null||s.alertCancel("Submission Error","Video link update failed.")},y=async(d,U,S)=>{const z=pe.BASE_URL+"/api/listing/save_video_link",j={user_guid:d,business_guid:U,video_guid:S,video_url:"",video_description:"",video_title:""};c(!0),await new Promise(E=>setTimeout(E,1e3));try{const E=await fetch(z,{method:"DELETE",headers:he,body:JSON.stringify(j)});if(E.ok)s.alertReload("Deleted","Video deleted successfully!");else{let V=E.json().then(ee=>{s.alert(ee.message)})}}catch(E){return alert(E.message)}finally{c(!1)}},H=d=>{q(d)};async function v(d){const U=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${d}&format=json`;try{const S=await fetch(U);if(!S.ok)throw new Error("Video not found");const I=await S.json();return!0}catch{return console.error("❌ Invalid or unavailable video"),!1}}const Q=async d=>{s.notify(),await new Promise(V=>setTimeout(V,1e3));const U=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,S=d.match(U);let I=S?S[1]:null,z=`https://img.youtube.com/vi/${I}/0.jpg`,j={videoId:I,videoUrl:d,videoThumbnail:z};if(await v(I))try{f(j),A(!0);const V=document.getElementById("yt-iframe");V.src=`https://www.youtube.com/embed/${j==null?void 0:j.videoId}`}finally{s.cancel()}else s.alertCancel("Video error!","Video could not be loaded!");await new Promise(V=>setTimeout(V,1e3)),f(j)},ae=()=>{const d=document.getElementById("videolink");Q(d.value)};let re={dialog:m,setDialog:C,handleCloseDialog:w,videoSrc:o,setVideoSrc:_,userGuid:l,setUserGuid:D,businessGuid:N,setBusinessGuid:G,isImgSelected:g,setIsImageSelected:R,selectedFile:L,setSelectedFile:M,videoTitle:r,setVideoTitle:x,videoGuid:h,setVideoGuid:b,setVideoDescription:u,deleteVideo:y};return e.jsxs(ne.Provider,{value:re,children:[m&&e.jsx("div",{className:`flex w-screen h-screen z-[3000] 
                fixed top-0 left-0 right-0 bottom-0 bg-black/30 rounded-[8px]
                place-content-center place-items-center overflow-hidden`,children:e.jsx("div",{className:`relative w-[90%] h-[80%] bg-white 
                        rounded-[8px] overflow-x-hidden overflow-y-hidden z-[3000]`,onClick:d=>{d.preventDefault()},children:e.jsxs("div",{className:"relative h-full overflow-y-auto",children:[e.jsx("div",{className:"relative w-full h-[75%] max-h-[75%] bg-black",children:e.jsx("div",{className:" relative w-full h-full",children:e.jsx("iframe",{id:"yt-iframe",src:o?`https://www.youtube.com/embed/${i}`:void 0,className:"absolute top-0 left-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})})}),e.jsx("div",{className:"flex mb-1 ",children:e.jsx("input",{id:"videolink",type:"text",defaultValue:o,placeholder:"Enter Video Link",className:"w-full bg-gray-100 px-3 py-4 ",onKeyUp:d=>{H(d.target.value)}})}),e.jsx("div",{className:"flex mb-1 ",children:e.jsx("input",{id:"videotitle",defaultValue:r,type:"text",placeholder:"Enter Video Title",className:"w-full bg-gray-100 px-3 py-4 "})}),e.jsx("div",{children:e.jsx("textarea",{id:"videodescr",defaultValue:n,placeholder:"Enter video description.",className:"w-full bg-gray-100 px-3  h-[60px] py-3"})}),e.jsxs("div",{className:"flex place-content-end px-3 gap-2",children:[e.jsx("button",{onMouseDown:()=>w(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Cancel"}),e.jsx("button",{onClick:()=>P(),className:`bg-blue-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4 ${F?"block":"hidden"}`,children:"Submit"}),e.jsx("button",{onClick:()=>ae(),disabled:!W,className:`${W?"bg-blue-800":"bg-blue-300"} ${F&&"hidden"} text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Verify"})]})]})})}),p]})}export{Ne as A,_e as E,Ee as V,Ie as a,ke as b,Ce as u};
