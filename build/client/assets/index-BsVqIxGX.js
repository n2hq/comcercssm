import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,c as E}from"./components-BgCvqN9p.js";import{N as C,l as U,S as O}from"./lib-Chrm85BS.js";import{A as P}from"./AccountLayout-Dm9ImCVQ.js";import{C as R}from"./ContentLayout-C73nBUp4.js";import{u as k}from"./AuthContext-MlJIbiwB.js";import{u as I}from"./OperationContext-C5fIEC6d.js";import"./UserMenu-DaOWGWrZ.js";import"./index-TC6OkEb3.js";import"./HomeNav-CuElRuw1.js";import"./SrchNavbar-E_o6Ft9_.js";import"./HamburgerSecondary-BL3u-yWB.js";import"./json-Bu0UkMsl.js";import"./BusinessMenu-CuefsmTj.js";import"./BusinessDrawer-CjIflymb.js";function T({userGuid:b}){const[y,g]=t.useState(""),[f,r]=t.useState([]),[o,u]=t.useState(null),[S,l]=t.useState(""),[c,n]=t.useState([]),[d,w]=t.useState(null),{showOperation:x,showError:i,completeOperation:m,showSuccess:j}=I(),v=async e=>{if(g(e),e.length<2)return r([]);const h=await(await fetch(`/api/listing/business_single_search?q=${encodeURIComponent(e)}&user_guid=${b}`)).json();r(h)},_=async e=>{if(l(e),e.length<2)return n([]);const h=await(await fetch(`/api/listing/user_single_search?q=${encodeURIComponent(e)}`)).json();n(h)},B=async()=>{if(x("processing"),!d||!o){i("Error","Please select both a user and a business before submitting."),m();return}await new Promise(a=>setTimeout(a,1e3));const e=JSON.parse(JSON.stringify(d)),p=JSON.parse(JSON.stringify(o)),h={user_guid:e.user_guid,previous_owner_guid:p.owner,business_guid:p.gid};console.log(e),console.log(p),console.log(h);try{const a=await fetch("/api/listing/reassign_business",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!a.ok){const N=await a.text();console.error("Error response:",N),i("Error",`${N}`),m();return}const $=await a.json();j("Success","Business reassigned successfully!"),m()}catch(a){console.error("Request failed:",a),i("Error","Something went wrong while reassigning."),m()}};return s.jsxs("div",{className:"space-y-6 p-4 max-w-lg",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search Business"}),s.jsx("input",{id:"biz",type:"text",value:y,onChange:e=>v(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"Type business name..."}),f.length>0&&s.jsx("ul",{className:"border mt-2 rounded bg-white shadow divide-y",children:f.map((e,p)=>s.jsx("li",{onClick:()=>{u(e),r([]),g(e.title)},className:"p-2 cursor-pointer hover:bg-gray-100",children:e.title},e.id))}),o&&s.jsx("input",{type:"hidden",name:"businessId",value:o.id})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search User"}),s.jsx("input",{id:"user",type:"text",value:S,onChange:e=>_(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"Type user name..."}),c.length>0&&s.jsx("ul",{className:"border mt-2 rounded bg-white shadow divide-y",children:c.map(e=>s.jsxs("li",{onClick:()=>{w(e),n([]),l(`${e.first_name}, ${e.lastname}`)},className:"p-2 cursor-pointer hover:bg-gray-100",children:[e.first_name,", ",e.lastname]},e.id))}),d&&s.jsx("input",{type:"hidden",name:"userId",value:d.id})]}),s.jsx("button",{type:"submit",onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Submit"})]})}const Z=()=>{t.useEffect(()=>{C(localStorage)},[]);const[b,y]=t.useState(!0),[g,f]=t.useState(null),[r,o]=t.useState(""),[u,S]=t.useState(""),{business_guid:l,user_guid:c}=E(),[n,d]=t.useState(null);return k()?(t.useEffect(()=>{const x=async(i,m)=>{o(i),S(m);const j=await O(i||"");d(j)};try{l&&c&&x(l,c)}catch(i){U(i)}},[l,c]),t.useEffect(()=>{r&&u&&n&&(f({businessGuid:r,userGuid:u,businessProfile:n}),y(!1))},[r,u,n]),b?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(P,{children:s.jsx(R,{title:"Delete Business Profile",businessGuid:r,data:g,businessProfile:n,children:g&&s.jsx(T,{userGuid:u})})})):null};export{Z as default};
