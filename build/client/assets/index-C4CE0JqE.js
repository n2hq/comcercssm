import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,u as re}from"./components-CCwaTRgT.js";import{u as ne}from"./AuthContext-C7k3lHjW.js";import{x as W,u as ae,W as ie,X as Q,Y as ee,m as le,I as ce,j as ue,O as me,Z as de,_ as ge,a3 as fe,ab as pe,ac as he}from"./lib-d5lyMBXU.js";import{P as be}from"./ProfileLayout-tLXLRTfj.js";import{u as xe,s as we}from"./zod-PtQGc9r6.js";import{z as o}from"./index-C4bLmoCR.js";import{u as V}from"./NotificationContext-BVMvs2cM.js";import{u as se,O as Pe}from"./OperationContext-BhT9SWU1.js";import{I as x,B as ye}from"./Input-Be1j46Iq.js";import{f as Se,c as X}from"./WhiteLogo-hx6VZQD6.js";import{T as K}from"./TextareaWithWordLimit-Dw8UZ8ce.js";import{S as $}from"./Select-DQLS2q0Z.js";import{B as je}from"./BusinessMenu-lxtqnmPk.js";import"./UserMenu-BJva0xcL.js";import"./index-oI16Z90E.js";import"./HomeNav-CVNWGNT6.js";import"./SrchNavbar-BmbhUp-t.js";import"./HamburgerSecondary-BkHc2D4C.js";const _e=o.object({username:o.any(),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:o.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),long_description:o.string().nullish().refine(e=>!e||e.trim()===""?!0:e.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:o.any(),state_code:o.any(),state_text:o.any(),country_text:o.any(),city_id:o.any(),established:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Year established must contain only numbers"}).refine(e=>e===""||e.length<=4,{message:"Year established must not be more than 4 digits"}),zipcode:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Zipcode must contain only numbers"}).refine(e=>e===""||e.length<=7,{message:"Zipcode must not be more than 7 digits"}),call_code:o.any(),phone:o.string().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),intro:o.any(),category:o.string().min(2,{message:"Please select a business category"}),business_phrases:o.union([o.literal(""),o.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:o.any(),services:o.any(),xsocial:o.any(),fbsocial:o.any(),linksocial:o.any(),website:o.string().nullable().optional().refine(e=>{if(!e||e==="")return!0;try{return new URL(e),!0}catch{return!1}},{message:"Please enter a valid website. Example: http://example.com"})}).superRefine((e,l)=>{var c,i;((c=e==null?void 0:e.address_two)==null?void 0:c.length)!==0&&((i=e==null?void 0:e.address_two)==null?void 0:i.length)<3&&l.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),Ie=({listing:e,user:l,businessProfileBgData:c})=>{let i="";c.image_url&&(i=W.IMG_BASE_URL+c.image_url);const[_,M]=t.useState(i),[D,U]=t.useState(null),w=t.useRef(null),[O,T]=t.useState(!1),[y,u]=t.useState(!1),S=V(),{showOperation:I,showSuccess:k,showError:j,showWarning:m,showInfo:f,completeOperation:b}=se(),p=()=>{var d;(d=w.current)==null||d.click()},L=d=>{var C;const h=(C=d.target.files)==null?void 0:C[0];if(h){const P=URL.createObjectURL(h);M(P),U(h),T(!0)}},N=async()=>{u(!0),I("processing"),await new Promise(h=>setTimeout(h,1e3));const d=new FormData;if(O){d.append("file",D),d.append("guid",l.user_guid),d.append("bid",e.gid);const C=W.IMG_BASE_URL+"/business_profile_bg_upload";try{const P=await fetch(C,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:d});if(P.ok)k("Success","Image uploaded."),b();else{let z=P.json().then(E=>{j("Error",E.message),b()})}}catch(P){console.log(P.message),j("Error","Image upload failed."),b()}finally{u(!1)}}else S.alertCancel("","Please select an image to continue."),u(!1)};return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"relative bg-gray-600 w-full h-[200px] z-[40] shadow-lg",children:[_&&s.jsx("img",{src:_,alt:"Click to upload",className:" object-cover w-full h-full  absolute z-[40]"}),s.jsx("input",{type:"file",accept:"image/*",ref:w,className:" hidden",onChange:L})]}),s.jsxs("div",{className:` flex place-items-center gap-3
                place-content-center bottom-[5px] right-[5px] w-fit z-[120] absolute`,children:[s.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:y,onMouseDown:p,children:"Browse"}),s.jsx("button",{className:` bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:N,disabled:y,children:y?"Uploading...":"Upload"})]})]})},Ne=({listing:e,user:l,businessProfileImageData:c})=>{let i="";c.image_url?i=W.IMG_BASE_URL+c.image_url:i="/images/placeholder-icon.webp";const[_,M]=t.useState(i),[D,U]=t.useState(null),w=t.useRef(null),[O,T]=t.useState(!1),[y,u]=t.useState(!1),S=V(),I=()=>{var m;(m=w.current)==null||m.click()},k=m=>{var b;const f=(b=m.target.files)==null?void 0:b[0];if(f){const p=URL.createObjectURL(f);M(p),U(f),T(!0)}},j=async()=>{u(!0),S.notify("Working..."),await new Promise(f=>setTimeout(f,1e3));const m=new FormData;if(O){m.append("file",D),m.append("guid",l.user_guid),m.append("bid",e.gid);const b=W.IMG_BASE_URL+"/business_profile_pic_upload";try{const p=await fetch(b,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:m});if(p.ok)S.alertReload("","Image uploaded successfully!");else{let L=p.json().then(N=>{S.alertCancel("",N.message)})}}catch{return}finally{u(!1)}}else S.alertCancel("","Please select an image to continue."),u(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden border-[2px] border-gray-200",children:[s.jsx("img",{src:_,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),s.jsx("input",{type:"file",accept:"image/*",ref:w,className:" hidden",onChange:k}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:I,children:s.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(ae,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:s.jsx("button",{className:`${y?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:j,disabled:y,children:y?"Uploading...":"Upload"})})]})},Ce=({data:e})=>{var Y;console.log(e.businessProfile);const[l,c]=t.useState(null),[i,_]=t.useState(!1);V();const[M,D]=t.useState(null),{showOperation:U,showSuccess:w,showError:O,showWarning:T,showInfo:y,completeOperation:u}=se(),S=e.countries;let[I,k]=t.useState(e.states),[j,m]=t.useState(e.cities);const f=(Y=ie)==null?void 0:Y.sort((g,B)=>g.name.localeCompare(B.name)),[b,p]=t.useState(e.businessProfile.country_code),[L,N]=t.useState(e.businessProfile.state_code),[d,h]=t.useState(""),[C,P]=t.useState(""),z=async g=>{p(g),h(g);const B=await Q(g);k(B),E("")},E=async g=>{N(g),P(g);const B=await ee(b,g);m(B)},r=g=>{let B=g.target.value,Z=g.target.name;c(A=>({...A,[Z]:B}))},J=async g=>{_(!0),U("processing","Updating page profile"),await new Promise(A=>setTimeout(A,1e3));const B="/api/listing/"+e.businessProfile.gid,Z=W.BASE_URL+B;try{const A=await fetch(Z,{method:"PUT",headers:le,body:JSON.stringify(g)});if(A.ok)w("Success","Page profile updated."),u();else{const te=await A.text(),oe=JSON.parse(te);throw new Error(`${oe.error}`)}}catch(A){O("error",`${A.message}`),u()}finally{_(!1)}},{register:n,handleSubmit:G,getValues:R,setValue:v,watch:F,setError:q,formState:{errors:a,isSubmitting:H}}=xe({defaultValues:e.businessProfile,resolver:we(_e)});return t.useEffect(()=>{e.businessProfile&&(v("state_code",e.businessProfile.state_code),v("city_id",e.businessProfile.city_id))},[e.businessProfile]),t.useEffect(()=>{d&&(v("state_code",""),v("city_id",""))},[d,e]),t.useEffect(()=>{C&&v("city_id","")},[C]),s.jsxs("div",{children:[s.jsx(Ie,{listing:e.businessProfile,user:e.userProfile,businessProfileBgData:e.businessProfileBgData}),s.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:s.jsx("div",{className:"absolute top-[-50px]",children:s.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:s.jsx(Ne,{listing:e.businessProfile,user:e.userProfile,businessProfileImageData:e.businessProfileImageData})})})}),s.jsxs("div",{children:[s.jsx("hr",{}),s.jsxs("div",{className:"relative w-full flex place-items-center gap-1 place-content-end px-[10px]",children:[s.jsx("a",{href:"/web/account/portfolio",className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Portfolio"}),s.jsx("a",{href:`/${e.businessProfile.gid}`,className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Preview"}),(e==null?void 0:e.businessProfile)&&s.jsx(je,{guid:e==null?void 0:e.businessProfile.gid,userGuid:e==null?void 0:e.businessProfile.owner})]}),s.jsx("form",{className:"w-full px-[10px]",onSubmit:G(J),children:s.jsxs("div",{className:`${Se} mt-0  rounded-lg pt-4 md:max-w-[80%]
                                lg:max-w-[60%] w-full mx-auto `,children:[s.jsx(x,{controlTitle:"Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:r,error:a.username,controlInformation:"Choose a username. "}),s.jsx(x,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:r,error:a.email_address,controlInformation:"Email address is compulsory."}),s.jsx(x,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:r,error:a.title,controlInformation:"Please enter page name. Page name is compulsory. "}),s.jsx(x,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:r,error:a.established,controlInformation:"This is the name the business was registered or started "}),s.jsx(x,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:r,error:a.address_one,width:100,controlInformation:"Contact address for the business. "}),s.jsx(x,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:r,error:a.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),s.jsx($,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:S,register:n,changeHandler:r,error:a.country_code,setCode:z,controlInformation:"Country the business was registered. "}),s.jsx($,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:I,register:n,changeHandler:r,error:a.state_code,setCode:E,controlInformation:"State the business was registered. "}),s.jsx($,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:j,register:n,changeHandler:r,error:a.city_id,controlInformation:"City the business was registered. "}),s.jsx(x,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:r,error:a.zipcode,controlInformation:"Enter the zipcode. E.g.: 51234 or 845219 "}),s.jsx(x,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:r,error:a.phone,controlInformation:"Mobile number or phone number. "}),s.jsx($,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:f,register:n,changeHandler:r,error:a.category,controlInformation:"Select business category."}),s.jsx(x,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:n,changeHandler:r,error:a.business_phrases,controlInformation:"Enter business phrases like: Solicitor, Advocate, Plumber, Business Analyst, Mechanical Engineers."}),s.jsx(x,{controlTitle:"Products",controlPlaceholder:"E.g.: Publications, Accessories, Shoes, Subscriptions, Magazines, Cars",controlName:"products",register:n,changeHandler:r,error:a.products,controlInformation:"Enter your products name like: Magazines, Generators, Accessories, Perfumes, Publications etc."}),s.jsx(x,{controlTitle:"Services",controlPlaceholder:"E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc.",controlName:"services",register:n,changeHandler:r,error:a.services,controlInformation:"Enter your services E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc."}),s.jsx(K,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:r,error:a.short_description,setValue:v,getValues:R,watch:F,controlInformationClass:X,controlInformation:"Short description of business activities"}),s.jsx(K,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:r,error:a.long_description,setValue:v,getValues:R,watch:F,controlInformationClass:X,controlInformation:"More description about the business."}),s.jsx(x,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:r,error:a.website,controlInformation:"Your website should look like this: http://example.com "}),s.jsx(ye,{working:i})]})})]})]})},Ze=()=>{var P;t.useEffect(()=>{ce(localStorage)},[]);const e=re(),l=ne();if(!l)return null;const c=e.business_guid,i=(P=l==null?void 0:l.user)==null?void 0:P.guid,[_,M]=t.useState(!0),[D,U]=t.useState(null),[w,O]=t.useState(null),[T,y]=t.useState(null),[u,S]=t.useState(null),[I,k]=t.useState(null),[j,m]=t.useState(null),[f,b]=t.useState(null),[p,L]=t.useState(null),[N,d]=t.useState(null),[h,C]=t.useState(null);return t.useEffect(()=>{async function z(E,r){const J=await ue(E||""),n=await me(r||""),G=await de(),R=n,v=await Q(R.country_code||""),F=await ee(R.country_code||"",R.state_code||""),q=await ge(),a=await fe(E||""),H=await pe(r||""),Y=await he(r||"");U(J),O(n),S(G),y(v),k(F),m(a),b(H),d(q),L(Y)}try{i&&c&&z(i,c)}catch(E){console.log(E.message)}},[i,c]),t.useEffect(()=>{D&&w&&u&&T&&I&&j&&N&&f&&p&&C({userProfile:D,businessProfile:w,countries:u,states:T,cities:I,userProfileImageData:j,businessProfileImageData:f,businessProfileBgData:p,categories:N})},[N,u,T,I,j,f,D,w,p]),t.useEffect(()=>{h&&M(!1)},[h]),_?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(be,{children:s.jsx(Pe,{children:h!==null&&s.jsx(Ce,{data:h})})})};export{Ze as default};
