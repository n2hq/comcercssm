import{j as t}from"./jsx-runtime-0DLF9kdB.js";import{r as s,a as K}from"./components-CCwaTRgT.js";import{A as X}from"./AccountLayout-DO3oyorg.js";import{u as q}from"./AuthContext-BLT8eIBS.js";import{u as G,s as Q}from"./zod-PtQGc9r6.js";import{W as ee,X as Z,Y as $,m as te,E as se,I as oe,Z as re,_ as ne,j as ae}from"./lib-CC-22j43.js";import{I as d,B as ie}from"./Input-BAJOR40w.js";import{S as b}from"./Select-DTLR1wti.js";import{f as ce,c as le}from"./WhiteLogo-E4eqNMj1.js";import{T as me}from"./TextareaWithWordLimit-BXM3V1nG.js";import{z as o}from"./index-C4bLmoCR.js";import{u as de}from"./NotificationContext-u_i63fMA.js";import{u as ue,O as ge}from"./OperationContext-BhT9SWU1.js";import{P as fe}from"./ProfileContentLayout-CC3RBmKX.js";import"./UserMenu-CJEstezG.js";import"./index-CdGC67h0.js";import"./HomeNav-C-07gCFe.js";import"./SrchNavbar-DUfsO58m.js";import"./HamburgerSecondary-D_c9cnZn.js";import"./json-OCF5soII.js";import"./BusinessMenu-MNSt271k.js";const he=o.object({title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),category:o.string().min(1,{message:"Please select a business category."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),state_code:o.any(),city_id:o.any(),zipcode:o.string().max(7,{message:"Zipcode must not be more than 7 characters"}).optional().or(o.literal("")),short_description:o.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),phone:o.string().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),address_two:o.any(),established:o.string().optional().refine(e=>!e||/^\d{1,4}$/.test(e),{message:"Must be only numbers and not more than 4 digits"})}).superRefine((e,c)=>{var f,u;((f=e==null?void 0:e.address_two)==null?void 0:f.length)!==0&&((u=e==null?void 0:e.address_two)==null?void 0:u.length)<3&&c.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),pe=({data:e,user:c})=>{const[f,u]=s.useState(null),[C,h]=s.useState(!1),P=de();K();const{showOperation:p,showSuccess:E,showError:O,showWarning:L,showInfo:W,completeOperation:_}=ue(),w=e.countries;let[j,Y]=s.useState(e.states),[N,y]=s.useState(e.cities);const l=ee,[I,T]=s.useState(""),[z,v]=s.useState(""),[S,k]=s.useState(""),[D,R]=s.useState(""),U=async r=>{T(r),k(r);const g=await Z(r);Y(g),J("")},J=async r=>{v(r),R(r);const g=await $(I,r);y(g)},n=r=>{let g=r.target.value,A=r.target.name;u(B=>({...B,[A]:g}))},F=async r=>{h(!0),p("processing","Creating a page"),await new Promise(m=>setTimeout(m,1e3)),r.owner=c.guid;const A=se.BASE_URL+"/api/listing";try{const m=await fetch(A,{method:"POST",headers:te,body:JSON.stringify(r)});if(m.ok)E("success","Page created successfully."),_();else{var B=await m.json();throw new Error(`Error Code: ${m.status} - ${B.message}`)}}catch(m){P.alertCancel("Error!",m.message)}finally{h(!1)}},{register:a,handleSubmit:V,getValues:M,watch:H,setValue:x,setError:we,formState:{errors:i,isSubmitting:ye}}=G({resolver:Q(he)});return s.useEffect(()=>{S&&(x("state_code",""),x("city_id",""))},[S]),s.useEffect(()=>{D&&x("city_id","")},[D]),t.jsx("form",{onSubmit:V(F),children:t.jsxs("div",{className:`${ce} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto `,children:[t.jsx(d,{controlTitle:"Business Name",controlPlaceholder:"Enter business name",controlName:"title",register:a,changeHandler:n,error:i.title,width:80,controlInformation:"Business name is compulsory."}),t.jsx(d,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:a,changeHandler:n,error:i.email_address,controlInformation:"Email address is compulsory."}),t.jsx(b,{controlTitle:"Business Category",controlName:"category",controlPlaceholder:"Select business category",selectJson:l,register:a,changeHandler:n,error:i.category,controlInformation:"Select business category."}),t.jsx(d,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:a,changeHandler:n,error:i.address_one,width:100,controlInformation:"Address of Business. E.g. 28 New York Street "}),t.jsx(d,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:a,changeHandler:n,error:i.address_two,width:100,controlInformation:"Continuation of address. E.g. Crown Tower, Off Belleveu Avenue or Valu Complex, Kingston Donnel Boulevard. "}),t.jsx(b,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:w,register:a,changeHandler:n,error:i.country_code,setCode:U,controlInformation:"Country the business was registered or active. "}),t.jsx(b,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:j,register:a,changeHandler:n,error:i.state_code,setCode:J,controlInformation:"State the business is registered or active. "}),t.jsx(b,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:N,register:a,changeHandler:n,error:i.city_id,controlInformation:"City the business is registered or active. "}),t.jsx(d,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:a,changeHandler:n,error:i.zipcode,controlInformation:"Zipcode of location of business. Eg. 92829 or 239484 "}),t.jsx(d,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:a,changeHandler:n,error:i.phone,controlInformation:"Phone OR Mobile number. "}),t.jsx(d,{controlTitle:"Year established - Optional",controlPlaceholder:"Enter year established",controlName:"established",register:a,changeHandler:n,error:i.established,controlInformation:"Year registered is compulsory."}),t.jsx(me,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:a,changeHandler:n,error:i.short_description,setValue:x,getValues:M,watch:H,controlInformationClass:le,controlInformation:"Enter a short description of this business. It should be a maximum of 50 words. "}),t.jsx(ie,{working:C})]})})},Ze=()=>{s.useEffect(()=>{oe(localStorage)},[]);const e=q();if(!e)return null;const[c,f]=s.useState(null),[u,C]=s.useState(!0),[h,P]=s.useState(null),[p,E]=s.useState(null),[O,L]=s.useState(null),[W,_]=s.useState(null),[w,j]=s.useState(null),[Y,N]=s.useState(null);return s.useEffect(()=>{const y=async l=>{const I=await re(),T=await Z(""),z=await $("",""),v=await ne(),S=await ae((l==null?void 0:l.guid)||"");N(S),E(I),L(T),_(z),j(v),f(l)};try{e!=null&&e.user&&y(e==null?void 0:e.user)}catch(l){console.log(l.message)}},[e]),s.useEffect(()=>{c&&p&&w&&(P({user:c,countries:p,states:O,cities:W,categories:w}),C(!1))},[p,c]),u?t.jsx("div",{className:"flex justify-center items-center h-screen",children:t.jsx("div",{className:"text-lg",children:"Loading..."})}):t.jsx(X,{children:t.jsx(fe,{title:"Create Page",children:t.jsx(ge,{children:h&&t.jsx("div",{children:t.jsx(pe,{data:h,user:c})})})})})};export{Ze as default};
