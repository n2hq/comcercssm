import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-CCwaTRgT.js";import{A as I}from"./AccountLayout-5U_AUe5s.js";import{u as O}from"./AuthContext-Crea6u0m.js";import{p as k,J as U,L as W,m as _}from"./lib-B-TVjvlj.js";import{u as q,s as B}from"./zod-PtQGc9r6.js";import{I as F,B as R}from"./Input-BRG1qQUx.js";import{z as P}from"./index-C4bLmoCR.js";import{f as T,g as V}from"./WhiteLogo-BBidgNJe.js";import{u as J}from"./NotificationContext-Bgz3_41l.js";import{u as z}from"./OperationContext-CaoUEJma.js";import{P as H}from"./ProfileContentLayout-B6sZACja.js";import"./UserMenu-C2Rk3u9z.js";import"./index-C7mLXbsN.js";import"./HomeNav-DE440SxH.js";import"./SrchNavbar-DscsmWtA.js";import"./HamburgerSecondary-Bmo0MaKr.js";import"./json-DW8pLu6r.js";import"./BusinessMenu-BPCH-skN.js";const $=P.object({email:P.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),D=({loaderData:r,user:t})=>{var j,w;const[n,u]=s.useState(null),[a,l]=s.useState(!1),d=J(),[x,f]=s.useState(!0),{showOperation:m,showSuccess:p,showError:E,showWarning:G,showInfo:K,completeOperation:g}=z(),y=o=>{let b=o.target.value,h=o.target.name;u(c=>({...c,[h]:b}))},v=async o=>{var c,S;if(l(!0),m("processing"),await new Promise(i=>setTimeout(i,1e3)),o.email===((c=r.userProfile)==null?void 0:c.email))return E("Error","Email is in use. Enter a new email."),g(),l(!1),!1;const h=U.BASE_URL+"/api/user/change_email_request";o.guid=(S=r.userProfile)==null?void 0:S.user_guid;try{const i=await fetch(h,{method:"POST",headers:k,body:JSON.stringify(o)});if(i.ok)p("Success","Please check your new email to continue."),g();else{let ee=i.json().then(C=>{d.alertCancel("Error",C.error)})}}catch(i){console.log(i.message),E("Error","Email change request failed."),g();return}finally{l(!1)}},{register:N,handleSubmit:L,getValues:M,setValue:Q,watch:X,setError:Y,formState:{errors:A,isSubmitting:Z}}=q({defaultValues:r.listing,resolver:B($)});return e.jsx("form",{onSubmit:L(v),children:e.jsx("div",{className:`${T} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:V,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(j=r.userProfile)==null?void 0:j.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-full px-3 py-3 bg-gray-50",children:[(w=r.userProfile)==null?void 0:w.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(F,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:N,changeHandler:y,error:A.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(R,{working:a})]})})})},we=()=>{s.useEffect(()=>{W(localStorage)},[]);const r=O();if(!r)return null;const{user:t}=r,[n,u]=s.useState(null),[a,l]=s.useState(null),[d,x]=s.useState(!0);return s.useEffect(()=>{async function f(m){const p=await _(m||"");u(p)}try{t!=null&&t.guid&&f(t==null?void 0:t.guid)}catch(m){console.log(m.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{n&&l({userProfile:n})},[n]),s.useEffect(()=>{a&&x(!1)},[a]),d?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(I,{children:e.jsxs(H,{title:"Email Address",children:[n===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md"}),a&&e.jsx(D,{loaderData:a,user:t})]})})};export{we as default};
