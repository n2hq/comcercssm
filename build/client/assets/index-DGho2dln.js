import{r as o,j as s}from"./components-UScJPEQZ.js";import{A as C,C as v}from"./ContentLayout-CH9JGj2M.js";import{h as S,c as E,u as I,g as R}from"./AuthContext-DP2umk9J.js";import{z as i,u as T,s as A}from"./index-DFVatVxl.js";import{f as L,i as U,I as x,B as V}from"./Input-BLmtOyFp.js";import{u as k}from"./NotificationContext-LbrYtE65.js";import"./MobileNav-aPg5T7ro.js";import"./index-DOwvlINV.js";import"./UserMenu-Bxj1AbP9.js";const P=new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!()Â£@$%^&*-]).{8,}$/),B=i.object({oldpassword:i.string().min(1,{message:"Please enter old password."}).min(8,{message:"Password must be up to 8 characters."}).regex(P,{message:"Please enter a valid password"}),newpassword:i.string().min(1,{message:"Please enter new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(P,{message:"Please enter a valid password"}),newpassword2:i.string().min(1,{message:"Please retype new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(P,{message:"Please enter a valid password"})}).superRefine((e,r)=>{e.oldpassword===e.newpassword&&r.addIssue({code:i.ZodIssueCode.custom,path:["newpassword"],message:"New password cannot be the same as old password"}),e.newpassword!==e.newpassword2&&r.addIssue({code:i.ZodIssueCode.custom,path:["newpd2"],message:"Your new password don't match"})}),F=({loaderData:e,user:r})=>{var b;const[j,t]=o.useState(null),[p,m]=o.useState(!1),n=k(),l=a=>{let f=a.target.value,h=a.target.name;t(w=>({...w,[h]:f}))},u=async a=>{var w;m(!0),n.notify("In progress..."),await new Promise(d=>setTimeout(d,1e3));const f="/api/user/change_password/"+((w=e.userProfile)==null?void 0:w.user_guid),h=E.BASE_URL+f;a.password=a==null?void 0:a.newpassword,delete a.oldpassword,delete a.newpassword,delete a.newpassword2;try{const d=await fetch(h,{method:"PUT",headers:S,body:JSON.stringify(a)});if(d.ok)n.alertReload("Success","Password Successfully Changed! Use new password on next login");else{let D=d.json().then(N=>{n.alertCancel("",N.message)})}}catch(d){n.alertCancel("",d.message)}finally{m(!1)}},{register:c,handleSubmit:y,getValues:W,setValue:Z,watch:_,setError:$,formState:{errors:g,isSubmitting:z}}=T({defaultValues:e.listing,resolver:A(B)});return s.jsx("form",{onSubmit:y(u),children:s.jsx("div",{className:`${L} mt-0  
            rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:s.jsxs("div",{className:U,children:[s.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Change Password"}),s.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[s.jsx("b",{children:(b=e.userProfile)==null?void 0:b.email})," is your current email. It will be used be used for password resets or changes."]}),s.jsx("div",{className:"mt-[20px]"}),s.jsx(x,{controlTitle:"Current Password",controlPlaceholder:"Enter current password",controlType:"password",controlName:"oldpassword",register:c,changeHandler:l,error:g.oldpassword}),s.jsx(x,{controlTitle:"New Password",controlType:"password",controlPlaceholder:"Enter new password",controlName:"newpassword",register:c,changeHandler:l,error:g.newpassword}),s.jsx(x,{controlTitle:"Retype New Password",controlPlaceholder:"Retype new password",controlName:"newpassword2",controlType:"password",register:c,changeHandler:l,error:g.newpassword2}),s.jsx(V,{working:p})]})})})},X=()=>{const{user:e}=I(),[r,j]=o.useState(null),[t,p]=o.useState(null),[m,n]=o.useState(!0);return o.useEffect(()=>{async function l(u){const c=await R(u||"");j(c)}e!=null&&e.guid&&l(e==null?void 0:e.guid)},[e==null?void 0:e.guid]),o.useEffect(()=>{r&&p({userProfile:r})},[r]),o.useEffect(()=>{t&&n(!1)},[t]),m?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(C,{children:s.jsxs(v,{title:"Change Password",children:[r===null?"Loading...":"",s.jsx("div",{className:"font-semibold mb-2 text-md",children:r==null?void 0:r.email}),t&&s.jsx(F,{loaderData:t,user:e})]})})};export{X as default};
