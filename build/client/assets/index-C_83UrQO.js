import{j as t}from"./jsx-runtime-0DLF9kdB.js";import{r as s,u as V}from"./components-qdL6XBti.js";import{A as M}from"./AccountLayout-DqEKwYFJ.js";import{u as H}from"./AuthContext-BnKqVxnU.js";import{u as K,s as X}from"./zod-g2XesUsp.js";import{W as q,X as O,Y,p as G,z as Q,I as ee,Z as te,_ as se,j as oe}from"./lib-gdbuLEb8.js";import{I as u,B as re}from"./Input-BGESB1pz.js";import{S as P}from"./Select-BF1xdZV7.js";import{f as ne,c as ae}from"./WhiteLogo-BTe8ysqQ.js";import{T as ie}from"./TextareaWithWordLimit-DtoNUebA.js";import{z as o}from"./index-C4bLmoCR.js";import{u as ce}from"./NotificationContext-BN71CfFW.js";import{P as le}from"./ProfileContentLayout-BTr2le8U.js";import"./UserMenu-CECLlKRK.js";import"./index-CeMHKdet.js";import"./HomeNav-CYWF0wT0.js";import"./SrchNavbar-AcngZQKL.js";import"./json-BNowKBeR.js";import"./BusinessMenu-CriD0Rgx.js";const me=o.object({title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),category:o.string().min(1,{message:"Please select a business category."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),state_code:o.any(),city_id:o.any(),zipcode:o.string().max(7,{message:"Zipcode must not be more than 7 characters"}).optional().or(o.literal("")),short_description:o.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),phone:o.string().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),address_two:o.any(),established:o.string().optional().refine(e=>!e||/^\d{1,4}$/.test(e),{message:"Must be only numbers and not more than 4 digits"})}).superRefine((e,c)=>{var h,g;((h=e==null?void 0:e.address_two)==null?void 0:h.length)!==0&&((g=e==null?void 0:e.address_two)==null?void 0:g.length)<3&&c.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),de=({data:e,user:c})=>{const[h,g]=s.useState(null),[_,p]=s.useState(!1),m=ce();V();const y=e.countries;let[E,j]=s.useState(e.states),[N,I]=s.useState(e.cities);const T=q,[S,v]=s.useState(""),[J,A]=s.useState(""),[w,l]=s.useState(""),[x,B]=s.useState(""),z=async n=>{v(n),l(n);const f=await O(n);j(f),b("")},b=async n=>{A(n),B(n);const f=await Y(S,n);I(f)},r=n=>{let f=n.target.value,D=n.target.name;g(L=>({...L,[D]:f}))},W=async n=>{p(!0),m.notify("Creating page..."),await new Promise(d=>setTimeout(d,1e3)),n.owner=c.guid;const D=Q.BASE_URL+"/api/listing";try{const d=await fetch(D,{method:"POST",headers:G,body:JSON.stringify(n)});if(d.ok){const R=async U=>{U||(window.location.href="/web/account/portfolio",await new Promise(F=>setTimeout(F,1e3))),m.cancel()};m.confirm("Page created. Do you wish to create another page?",R)}else{var L=await d.json();throw new Error(`Error Code: ${d.status} - ${L.message}`)}}catch(d){m.alertCancel("Error!",d.message)}finally{p(!1)}},{register:a,handleSubmit:Z,getValues:$,watch:k,setValue:C,setError:ue,formState:{errors:i,isSubmitting:ge}}=K({resolver:X(me)});return s.useEffect(()=>{w&&(C("state_code",""),C("city_id",""))},[w]),s.useEffect(()=>{x&&C("city_id","")},[x]),t.jsx("form",{onSubmit:Z(W),children:t.jsxs("div",{className:`${ne} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto `,children:[t.jsx(u,{controlTitle:"Business Name",controlPlaceholder:"Enter business name",controlName:"title",register:a,changeHandler:r,error:i.title,width:80,controlInformation:"Business name is compulsory."}),t.jsx(u,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:a,changeHandler:r,error:i.email_address,controlInformation:"Email address is compulsory."}),t.jsx(P,{controlTitle:"Business Category",controlName:"category",controlPlaceholder:"Select business category",selectJson:T,register:a,changeHandler:r,error:i.category,controlInformation:"Select business category."}),t.jsx(u,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:a,changeHandler:r,error:i.address_one,width:100,controlInformation:"Address of Business. E.g. 28 New York Street "}),t.jsx(u,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:a,changeHandler:r,error:i.address_two,width:100,controlInformation:"Continuation of address. E.g. Crown Tower, Off Belleveu Avenue or Valu Complex, Kingston Donnel Boulevard. "}),t.jsx(P,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:y,register:a,changeHandler:r,error:i.country_code,setCode:z,controlInformation:"Country the business was registered or active. "}),t.jsx(P,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:E,register:a,changeHandler:r,error:i.state_code,setCode:b,controlInformation:"State the business is registered or active. "}),t.jsx(P,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:N,register:a,changeHandler:r,error:i.city_id,controlInformation:"City the business is registered or active. "}),t.jsx(u,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:a,changeHandler:r,error:i.zipcode,controlInformation:"Zipcode of location of business. Eg. 92829 or 239484 "}),t.jsx(u,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:a,changeHandler:r,error:i.phone,controlInformation:"Phone OR Mobile number. "}),t.jsx(u,{controlTitle:"Year established - Optional",controlPlaceholder:"Enter year established",controlName:"established",register:a,changeHandler:r,error:i.established,controlInformation:"Year registered is compulsory."}),t.jsx(ie,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:a,changeHandler:r,error:i.short_description,setValue:C,getValues:$,watch:k,controlInformationClass:ae,controlInformation:"Enter a short description of this business. It should be a maximum of 50 words. "}),t.jsx(re,{working:_})]})})},ze=()=>{s.useEffect(()=>{ee(localStorage)},[]);const e=H();if(!e)return null;const[c,h]=s.useState(null),[g,_]=s.useState(!0),[p,m]=s.useState(null),[y,E]=s.useState(null),[j,N]=s.useState(null),[I,T]=s.useState(null),[S,v]=s.useState(null),[J,A]=s.useState(null);return s.useEffect(()=>{const w=async l=>{const x=await te(),B=await O(""),z=await Y("",""),b=await se(),r=await oe((l==null?void 0:l.guid)||"");A(r),E(x),N(B),T(z),v(b),h(l)};try{e!=null&&e.user&&w(e==null?void 0:e.user)}catch(l){console.log(l.message)}},[e]),s.useEffect(()=>{c&&y&&S&&(m({user:c,countries:y,states:j,cities:I,categories:S}),_(!1))},[y,c]),g?t.jsx("div",{className:"flex justify-center items-center h-screen",children:t.jsx("div",{className:"text-lg",children:"Loading..."})}):t.jsx(M,{children:t.jsx(le,{title:"Create Page",children:p&&t.jsx("div",{children:t.jsx(de,{data:p,user:c})})})})};export{ze as default};
