import{j as t}from"./jsx-runtime-0DLF9kdB.js";import{r as e}from"./components-CooaLra5.js";import{u as te}from"./NotificationContext-4uw7ZiBa.js";import{z as U}from"./index-C4bLmoCR.js";import{v as de,i as ne,l as re,w as ce,x as ue}from"./lib-BfDGzk_Z.js";const ie=e.createContext(null);function ge(){return e.useContext(ie)}const me=/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).{8,}$/;U.object({videolink:U.string({message:"Please enter the video link"}),url:U.string().url("Video link is not valid."),videotitle:U.string({message:"Please enter a password"}).min(8,"Password must be at least 8 characters").regex(me,"Please enter a valid password"),videodescription:U.string().trim().max(500,"Description must be less than 500 characters.").optional()});function we({children:b}){const[se,a]=e.useState(!1),[g,j]=e.useState(!1),[f,k]=e.useState(null),[E,z]=e.useState(null),[I,A]=e.useState(null),[R,F]=e.useState(!1),[K,W]=e.useState(null),l=te(),[v,T]=e.useState(null),[Q,P]=e.useState(null),[B,N]=e.useState(!1),[Y,C]=e.useState(!1),[w,M]=e.useState(void 0),[$,D]=e.useState("");e.useEffect(()=>{g&&(N(!1),C(!1),M(void 0),D(""))},[g]),e.useEffect(()=>{$&&$.trim().length>0?(N(!1),C(!0)):(N(!1),C(!1))},[$]);const _=()=>{j(!1),k(null)};e.useEffect(()=>{const o=document.getElementById("videolink");M(o)},[]),e.useEffect(()=>{(w==null?void 0:w.value.trim().length)>0&&C(!0)},[w]);const L=()=>{const o=document.getElementById("videolink");X(o.value)};async function O(o){const x=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${o}&format=json`;try{const i=await fetch(x);if(!i.ok)throw new Error("Video not found");const n=await i.json();return!0}catch{return console.error("❌ Invalid or unavailable video"),!1}}const X=async o=>{l.notify(),await new Promise(d=>setTimeout(d,1e3));const x=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,i=o.match(x);let n=i?i[1]:null,V=`https://img.youtube.com/vi/${n}/0.jpg`,r={videoId:n,videoUrl:o,videoThumbnail:V};if(await O(n))try{T(r),N(!0);const d=document.getElementById("yt-iframe");d.src=`https://www.youtube.com/embed/${r==null?void 0:r.videoId}`}finally{l.cancel()}else l.alertCancel("Video error!","Video could not be loaded!");await new Promise(d=>setTimeout(d,1e3)),T(r)};e.useEffect(()=>{const o=document.getElementById("yt-iframe");o!=null&&o.onload&&console.log("✅ Iframe page loaded"),P(o)},[]);const ee=o=>{D(o)},G=async()=>{a(!0),l.notify("Submitting..."),await new Promise(q=>setTimeout(q,1e3));let o=document.getElementById("videolink"),x=document.getElementById("videotitle"),i=document.getElementById("videodescr"),n=o.value,V=x.value,r=i.value;if(n.trim().length<=0)return l.alertCancel("Submission error!","Enter a Video link!"),a(!1),!1;if(V.trim().length<=0)return l.alertCancel("Submission error!","Video title should not be empty!"),a(!1),!1;if(r.trim().length>500)return l.alertCancel("Submission error!","Video description should not be more than 500 characters!"),a(!1),!1;const d=await de({video_url:n,video_title:V,video_description:r,user_guid:E,business_guid:I,video_guid:""});d!=null&&d.data.videoInsertId?l==null||l.alertReload("Completed","Video Link Submitted Successfully."):l==null||l.alertCancel("Submission Error","Video Link submission failed.")};let J={dialog:g,setDialog:j,imgSrc:f,setImgSrc:k,handleCloseDialog:_,userGuid:E,setUserGuid:z,businessGuid:I,setBusinessGuid:A,isImgSelected:R,setIsImageSelected:F,selectedFile:K,setSelectedFile:W};return t.jsxs(ie.Provider,{value:J,children:[g&&t.jsx("div",{className:`flex w-screen h-screen z-[3000] 
                fixed top-0 left-0 right-0 bottom-0 bg-black/30 rounded-[8px]
                place-content-center place-items-center overflow-hidden`,children:t.jsx("div",{className:`relative w-[90%] h-[80%] bg-white 
                        rounded-[8px] overflow-x-hidden overflow-y-hidden z-[3000]`,onClick:o=>{o.preventDefault()},children:t.jsxs("div",{className:"relative h-full overflow-y-auto",children:[t.jsx("div",{className:"relative w-full h-[75%] max-h-[75%] bg-black",children:t.jsx("div",{className:" relative w-full h-full",children:t.jsx("iframe",{id:"yt-iframe",src:v!=null&&v.videoId?`https://www.youtube.com/embed/${v==null?void 0:v.videoId}`:void 0,className:"absolute top-0 left-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})})}),t.jsx("div",{className:"flex mb-1 ",children:t.jsx("input",{id:"videolink",type:"text",placeholder:"Enter Video Link",className:"w-full bg-gray-100 px-3 py-4 ",onKeyUp:o=>{ee(o.target.value)}})}),t.jsx("div",{className:"flex mb-1 ",children:t.jsx("input",{id:"videotitle",type:"text",placeholder:"Enter Video Title",className:"w-full bg-gray-100 px-3 py-4 "})}),t.jsx("div",{children:t.jsx("textarea",{id:"videodescr",placeholder:"Enter picture description.",className:"w-full bg-gray-100 px-3  h-[60px] py-3"})}),t.jsxs("div",{className:"flex place-content-end px-3 gap-2",children:[t.jsx("button",{onMouseDown:()=>_(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Cancel"}),t.jsx("button",{onClick:()=>G(),className:`bg-blue-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4 ${B?"block":"hidden"}`,children:"Submit"}),t.jsx("button",{onClick:()=>L(),disabled:!Y,className:`${Y?"bg-blue-800":"bg-blue-300"} ${B&&"hidden"} text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Verify"})]})]})})}),b]})}const oe=e.createContext(null);function xe(){const b=e.useContext(oe);if(!b)throw new Error("Wrap the app with an EditVideoDialogProvider!");return b}function ye({children:b}){const[se,a]=e.useState(!1),[g,j]=e.useState(!1),[f,k]=e.useState(null),[E,z]=e.useState(null),[I,A]=e.useState(null),[R,F]=e.useState(!1),[K,W]=e.useState(null),[l,v]=e.useState(null),[T,Q]=e.useState(null),[P,B]=e.useState(null),[N,Y]=e.useState(null),[C,w]=e.useState(null),[M,$]=e.useState(null),[D,_]=e.useState(!1),[L,O]=e.useState(!0),[X,ee]=e.useState(void 0),[G,J]=e.useState(""),[o,x]=e.useState(null);e.useRef(null);const i=te();e.useEffect(()=>{G.trim().length>0&&(_(!1),O(!0))},[G]),e.useEffect(()=>{if(f){const s=ne(f);x(s)}},[f]);const n=()=>{j(!1),k(null),a(!1)},V=async()=>{a(!0),i.notify("Submitting..."),await new Promise(H=>setTimeout(H,1e3));let s=document.getElementById("videolink"),y=document.getElementById("videotitle"),c=document.getElementById("videodescr"),h=s.value,S=y.value,u=c.value;if(h.trim().length<=0)return i.alertCancel("Submission error!","Enter a Video link!"),a(!1),!1;if(S.trim().length<=0)return i.alertCancel("Submission error!","Video title should not be empty!"),a(!1),!1;if(u.trim().length>500)return i.alertCancel("Submission error!","Video description should not be more than 500 characters!"),a(!1),!1;const m=await ce({video_url:h,video_title:S,video_description:u,user_guid:E,business_guid:I,video_guid:P});(m==null?void 0:m.data.success)===!0?i==null||i.alertReload("Successful","Video link updated successfully."):i==null||i.alertCancel("Submission Error","Video link update failed.")},r=async(s,y,c)=>{const S=ue.BASE_URL+"/api/listing/save_video_link",u={user_guid:s,business_guid:y,video_guid:c,video_url:"",video_description:"",video_title:""};a(!0),await new Promise(p=>setTimeout(p,1e3));try{const p=await fetch(S,{method:"DELETE",headers:re,body:JSON.stringify(u)});if(p.ok)i.alertReload("Deleted","Video deleted successfully!");else{let m=p.json().then(H=>{i.alert(H.message)})}}catch(p){return alert(p.message)}finally{a(!1)}},Z=s=>{J(s)};async function d(s){const y=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${s}&format=json`;try{const c=await fetch(y);if(!c.ok)throw new Error("Video not found");const h=await c.json();return!0}catch{return console.error("❌ Invalid or unavailable video"),!1}}const q=async s=>{i.notify(),await new Promise(m=>setTimeout(m,1e3));const y=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,c=s.match(y);let h=c?c[1]:null,S=`https://img.youtube.com/vi/${h}/0.jpg`,u={videoId:h,videoUrl:s,videoThumbnail:S};if(await d(h))try{w(u),_(!0);const m=document.getElementById("yt-iframe");m.src=`https://www.youtube.com/embed/${u==null?void 0:u.videoId}`}finally{i.cancel()}else i.alertCancel("Video error!","Video could not be loaded!");await new Promise(m=>setTimeout(m,1e3)),w(u)},le=()=>{const s=document.getElementById("videolink");q(s.value)};let ae={dialog:g,setDialog:j,handleCloseDialog:n,videoSrc:f,setVideoSrc:k,userGuid:E,setUserGuid:z,businessGuid:I,setBusinessGuid:A,isImgSelected:R,setIsImageSelected:F,selectedFile:K,setSelectedFile:W,videoTitle:l,setVideoTitle:v,videoGuid:P,setVideoGuid:B,setVideoDescription:Q,deleteVideo:r};return t.jsxs(oe.Provider,{value:ae,children:[g&&t.jsx("div",{className:`flex w-screen h-screen z-[3000] 
                fixed top-0 left-0 right-0 bottom-0 bg-black/30 rounded-[8px]
                place-content-center place-items-center overflow-hidden`,children:t.jsx("div",{className:`relative w-[90%] h-[80%] bg-white 
                        rounded-[8px] overflow-x-hidden overflow-y-hidden z-[3000]`,onClick:s=>{s.preventDefault()},children:t.jsxs("div",{className:"relative h-full overflow-y-auto",children:[t.jsx("div",{className:"relative w-full h-[75%] max-h-[75%] bg-black",children:t.jsx("div",{className:" relative w-full h-full",children:t.jsx("iframe",{id:"yt-iframe",src:f?`https://www.youtube.com/embed/${o}`:void 0,className:"absolute top-0 left-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})})}),t.jsx("div",{className:"flex mb-1 ",children:t.jsx("input",{id:"videolink",type:"text",defaultValue:f,placeholder:"Enter Video Link",className:"w-full bg-gray-100 px-3 py-4 ",onKeyUp:s=>{Z(s.target.value)}})}),t.jsx("div",{className:"flex mb-1 ",children:t.jsx("input",{id:"videotitle",defaultValue:l,type:"text",placeholder:"Enter Video Title",className:"w-full bg-gray-100 px-3 py-4 "})}),t.jsx("div",{children:t.jsx("textarea",{id:"videodescr",defaultValue:T,placeholder:"Enter video description.",className:"w-full bg-gray-100 px-3  h-[60px] py-3"})}),t.jsxs("div",{className:"flex place-content-end px-3 gap-2",children:[t.jsx("button",{onMouseDown:()=>n(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Cancel"}),t.jsx("button",{onClick:()=>V(),className:`bg-blue-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4 ${D?"block":"hidden"}`,children:"Submit"}),t.jsx("button",{onClick:()=>le(),disabled:!L,className:`${L?"bg-blue-800":"bg-blue-300"} ${D&&"hidden"} text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Verify"})]})]})})}),b]})}export{we as A,ye as E,ge as a,xe as u};
