import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t,u as _,b as B}from"./components-qdL6XBti.js";import{P as L,p as T,z as A,I,J as O,O as k}from"./lib-gdbuLEb8.js";import{A as z}from"./AccountLayout-DqEKwYFJ.js";import{C}from"./ContentLayout-CstOjNHK.js";import{u as F}from"./AuthContext-BnKqVxnU.js";import{u as J,s as U}from"./zod-g2XesUsp.js";import{I as P,B as V}from"./Input-BGESB1pz.js";import{u as R}from"./NotificationContext-BN71CfFW.js";import{z as y}from"./index-C4bLmoCR.js";import"./UserMenu-CECLlKRK.js";import"./WhiteLogo-BTe8ysqQ.js";import"./index-CeMHKdet.js";import"./HomeNav-CYWF0wT0.js";import"./SrchNavbar-AcngZQKL.js";import"./json-BNowKBeR.js";import"./BusinessMenu-CriD0Rgx.js";const W=/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).{8,}$/,$=y.object({confirm_delete:y.string().refine(i=>i==="DELETE",{message:'You must type "DELETE" to confirm'}),password:y.string({message:"Please enter a password"}).min(8,"Password must be at least 8 characters").regex(W,"Please enter a valid password")}),G=({userGuid:i,businessGuid:u})=>{const[f,p]=t.useState(null),[r,g]=t.useState(!0),o=R(),h=_(),[d,l]=t.useState(!1),[c,x]=t.useState(null),w=s=>{let E=s.target.value,j=s.target.name;x(n=>({...n,[j]:E}))},m=async s=>{l(!0),o.notify("Deleting business..."),await new Promise(n=>setTimeout(n,1e3)),s.user_guid=i;const E="/api/listing/delete_business/"+u,j=A.BASE_URL+E;try{const n=await fetch(j,{method:"PUT",headers:T,body:JSON.stringify(s)});if(n.ok)o.cancel(),h("/web/account/portfolio");else{const D=await n.text(),N=JSON.parse(D);throw new Error(`${N.error}`)}}catch{}},{register:a,handleSubmit:b,getValues:v,setValue:H,watch:Y,setError:Z,formState:{errors:S,isSubmitting:q}}=J({defaultValues:{},resolver:U($)});return t.useEffect(()=>{try{L(i,u).then(s=>{p(s[0].active_status),g(!1)})}catch{alert("Could not fetch business")}},[]),r?e.jsx("div",{children:"Loading..."}):e.jsx("div",{children:e.jsx("form",{className:" w-full",onSubmit:b(m),children:e.jsxs("div",{className:`p-6  rounded  max-w-2xl
        mx-auto mt-12`,children:[e.jsx("h2",{className:"text-lg mb-4 font-semibold",children:"Delete this Business or Organization"}),e.jsx("p",{className:"mb-4 text-gray-500",children:"Once you delete this business, it cannot be undone. Every resource or item entered under this business will be deleted completely and will not be recoverable."}),e.jsxs("div",{className:"border-[3px] border-gray-100 pt-5 pl-5 pr-5 rounded-lg shadow",children:[e.jsx(P,{controlTitle:"Confirm Delete",controlPlaceholder:'Type the word "DELETE"',controlName:"confirm_delete",register:a,controlType:"text",changeHandler:w,error:S.confirm_delete,controlInformation:"Please enter password to delete this business."}),e.jsx(P,{controlTitle:"Password",controlPlaceholder:"Enter password",controlName:"password",register:a,controlType:"password",changeHandler:w,error:S.password,controlInformation:"Please enter password to delete this business."}),e.jsx(V,{value:"Delete Business",working:!1})]})]})})})},fe=()=>{t.useEffect(()=>{I(localStorage)},[]);const[i,u]=t.useState(!0),[f,p]=t.useState(null),[r,g]=t.useState(""),[o,h]=t.useState(""),{business_guid:d,user_guid:l}=B(),[c,x]=t.useState(null);return F()?(t.useEffect(()=>{const m=async(a,b)=>{g(a),h(b);const v=await k(a||"");x(v)};try{d&&l&&m(d,l)}catch(a){O(a)}},[d,l]),t.useEffect(()=>{r&&o&&c&&(p({businessGuid:r,userGuid:o,businessProfile:c}),u(!1))},[r,o,c]),i?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(z,{children:e.jsx(C,{title:"Delete Business Profile",businessGuid:r,data:f,businessProfile:c,children:f&&e.jsx(G,{userGuid:o,businessGuid:r})})})):null};export{fe as default};
