import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-qdL6XBti.js";import{u as G}from"./AuthContext-VWDihtkd.js";import{x as H,ab as Z,u as q,X as O,Y as V,o as X,h as D,a1 as K,U as J,I as Q,Z as ee,_ as te,ac as se}from"./lib-gBiJsvjS.js";import{u as W}from"./NotificationContext-C5SCs4G2.js";import{u as oe,s as ae}from"./zod-g2XesUsp.js";import{z as c}from"./index-C4bLmoCR.js";import{I as U,B as ne}from"./Input-BNvsdA6b.js";import{S as $}from"./Select-XPpetk2h.js";import{f as re}from"./WhiteLogo-B3Ep-zpl.js";import{L as le}from"./UserMenu-BSa44Rm0.js";import{H as ie}from"./HomeNav-CU038EwL.js";import{S as ce}from"./SrchNavbar-Bv17_pyv.js";import"./index-yejPY_Il.js";import"./json-DN8jjR4S.js";const de=({user:l,userProfileImageData:o})=>{const a=W();let d="";o!=null&&o.image_url&&(d=H.IMG_BASE_URL+o.image_url);const[g,_]=t.useState(d),[h,w]=t.useState(null),y=t.useRef(null),[s,j]=t.useState(!1),[S,f]=t.useState(!1),n=()=>{var r;(r=y.current)==null||r.click()},i=r=>{var N;const b=(N=r.target.files)==null?void 0:N[0];if(b){const m=URL.createObjectURL(b);_(m),w(b),j(!0)}},v=async()=>{if(f(!0),a.notify("Working..."),await new Promise(r=>setTimeout(r,1e3)),s){const r=new FormData;r.append("file",h),r.append("guid",l.user_guid);const N=H.IMG_BASE_URL+"/user_profile_pic_upload";try{const m=await fetch(N,{method:"POST",body:r});if(m.ok)a.alertReload("","Image uploaded successfully!");else{let P=m.json().then(k=>{a.alertCancel("",k.message)})}}catch{return}finally{f(!1)}}else a.alertCancel("","Please select an image to continue."),f(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden
                flex place-content-center place-items-center border-[3px] border-white`,children:[g!==""?e.jsx("img",{src:g,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}):e.jsx(Z,{className:"object-cover w-[70%] h-[70%]"}),e.jsx("input",{type:"file",accept:"image/*",ref:y,className:" hidden",onChange:i}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:n,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out bg-white/50`,children:e.jsx(q,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${S?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:v,disabled:S,children:S?"Uploading...":"Submit"})})]})},ue=c.object({first_name:c.string().min(1,{message:"Enter a first name"}),lastname:c.any(),country_code:c.any(),state_code:c.any(),city_id:c.any(),phone:c.any(),address_one:c.any(),address_two:c.any(),country:c.any(),xsocial:c.any(),linksocial:c.any(),fbsocial:c.any(),zipcode:c.any()}),fe=({loaderData:l,user:o,userProfileData:a})=>{var F,M;const[d,g]=t.useState(null),[_,h]=t.useState(!1),w=W(),y=l.countries;let[s,j]=t.useState(l.states),[S,f]=t.useState(l.cities);l.categories;const[n,i]=t.useState((F=l.userProfileData)==null?void 0:F.country_code),[v,r]=t.useState((M=l.userProfileData)==null?void 0:M.state_code),[b,N]=t.useState(""),[m,P]=t.useState(""),k=async u=>{i(u),N(u);const C=await O(u);j(C),I("")},I=async u=>{r(u),P(u);const C=await V(n,u);f(C)},x=u=>{let C=u.target.value,R=u.target.name;g(z=>({...z,[R]:C}))},A=async u=>{h(!0),w.notify("Updating user profile..."),await new Promise(E=>setTimeout(E,1e3));const C="https://edition.garssete.com",R="/api/user/"+o.guid,z=C+R;try{const E=await fetch(z,{method:"PUT",headers:X,body:JSON.stringify(u)});if(E.ok)w.alertReload("Success","Update is Successful!");else{var Y=await E.json();throw new Error(`Error Code: ${E.status} - ${Y.error}`)}}catch(E){w.alertCancel("Error",E.message);return}finally{h(!1)}},{register:p,handleSubmit:T,getValues:xe,setValue:L,watch:pe,setError:ge,formState:{errors:B,isSubmitting:he}}=oe({defaultValues:a,resolver:ae(ue)});return t.useEffect(()=>{b&&(L("state_code",""),L("city_id",""))},[b]),t.useEffect(()=>{m&&L("city_id","")},[m]),e.jsxs("div",{children:[e.jsx("div",{className:"bg-black w-full h-[200px] relative",children:e.jsx("img",{src:"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/1d/33/b1/a3/hotel-building-exterior.jpg?w=1200&h=-1&s=1",alt:"user",className:"object-cover w-full h-full"})}),e.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:e.jsx("div",{className:"absolute top-[-50px]",children:e.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:e.jsx(de,{user:a,userProfileImageData:l.userProfileImageData})})})}),e.jsxs("div",{children:[e.jsx("hr",{}),e.jsx("form",{onSubmit:T(A),children:e.jsxs("div",{className:`${re} mt-0  rounded-lg pt-4
                 max-w-[400px] w-full mx-auto `,children:[e.jsx(U,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:p,changeHandler:x,error:B.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(U,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:p,changeHandler:x,error:B.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx($,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:y,register:p,changeHandler:x,error:B.country_code,setCode:k,controlInformation:"Please select country. "}),e.jsx($,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:s,register:p,changeHandler:x,setCode:I,controlInformation:"Please select state. "}),e.jsx($,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:S,register:p,changeHandler:x,controlInformation:"Please select a city. "}),e.jsx(U,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:p,changeHandler:x,controlInformation:"Please a zipcode. "}),e.jsx(U,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:p,changeHandler:x,controlInformation:"Please enter a phone or mobile. "}),e.jsx(U,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:p,changeHandler:x,controlInformation:"Please enter an address. "}),e.jsx(U,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:p,changeHandler:x,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(ne,{working:_})]})})]})]})},me=({children:l})=>{const[o,a]=t.useState(!0),[d,g]=t.useState(null),[_,h]=t.useState(!0),[w,y]=t.useState(null),s=G();if(!s)return null;t.useEffect(()=>{s.user===null&&(window.location.href="/web/signin")},[s]);const[j,S]=t.useState(!0),f=()=>{a(o===!1)};return t.useEffect(()=>{var n,i,v;((n=s==null?void 0:s.user)==null?void 0:n.guid)!==null&&((i=s==null?void 0:s.user)==null?void 0:i.guid)!==void 0&&((v=s==null?void 0:s.user)==null?void 0:v.guid)!==""?S(!1):window.location.href="/web/signin"},[s==null?void 0:s.user]),t.useEffect(()=>{const n=async i=>{const v=await J(i||"");g(v)};s!=null&&s.user&&n(s==null?void 0:s.user.guid)},[s==null?void 0:s.user]),t.useEffect(()=>{const n=localStorage.getItem("authTokens");(n==null||n==="")&&(window.location.href="/web/signin")},[]),t.useEffect(()=>{d&&h(!!(d!=null&&d.active))},[d]),t.useEffect(()=>{_===!1&&y("You are currently deactivated. Some operations like creating new business cannot be performed. Activate your profile to continue.")},[_]),j?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsxs("div",{className:"h-screen flex flex-col relative",children:[e.jsx("div",{className:`h-[${D.NAVBAR_HEIGHT}px] md:h-[0px]`}),e.jsx(ce,{}),e.jsx("div",{className:"md:hidden",children:e.jsx(ie,{})}),e.jsx("button",{onClick:f,className:`text-xl text-white bg-blue-700 p-2 
                rounded-full hover:bg-gray-700 shadow-lg top-[72px]
                ${o?"left-[295px]":"left-[15px]"}
                focus:outline-none fixed z-50 top-[60px] 
                transition-all duration-1000 ease-in-out
                hidden lg:block`,children:e.jsx(K,{className:`${o?"rotate-0 transition-all duration-1000 ease-in-out":"rotate-90 transition-all duration-1000 ease-in-out"}`})}),e.jsxs("div",{className:`flex flex-1 md:mt-[${D.NAVBAR_HEIGHT}px] h-full
                overflow-hidden`,children:[e.jsxs("aside",{className:`bg-gray-50 text-gray-900 
                        h-full overflow-y-auto transition-all z-30
                        duration-1000 ease-in-out border-r shadow-md
                        hidden lg:block 
                        ${o?"w-[350px] min-w-[350px]":"w-0 min-w-0 overflow-hidden"}`,children:[e.jsx("div",{className:"mt-[20px]"}),e.jsx(le,{userProfile:d}),e.jsx("div",{className:"h-[20px]"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 pb-6 px-[0px] relative",children:[w&&e.jsx("div",{className:"max-w-[100%] mx-auto w-full bg-blue-500 p-3 text-white text-center",children:w}),e.jsx("div",{className:"max-w-[100%] mx-auto w-full  ",children:l})]})]})]})},Te=()=>{t.useEffect(()=>{Q(localStorage)},[]);const l=G();if(!l)return null;const{user:o}=l,[a,d]=t.useState(null),[g,_]=t.useState(null),[h,w]=t.useState(null),[y,s]=t.useState(null),[j,S]=t.useState(null),[f,n]=t.useState(null),[i,v]=t.useState(null),[r,b]=t.useState(!0);return t.useEffect(()=>{async function N(m){try{const P=await J(m||""),k=await ee(),I=P,x=await O(I.country_code||""),A=await V(I.country_code||"",I.state_code||""),p=await te(),T=await se(m||"");d(P),w(k),_(x),s(A),S(T),n(p)}catch(P){console.log(P.message)}}o!=null&&o.guid&&N(o==null?void 0:o.guid)},[o==null?void 0:o.guid]),t.useEffect(()=>{a&&h&&g&&y&&j&&f&&v({userProfile:a,countries:h,states:g,cities:y,userProfileImageData:j,categories:f})},[f,h,g,y,j,a]),t.useEffect(()=>{i&&b(!1)},[i]),r?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Garssete"})}):e.jsx(me,{children:a&&i&&!r&&o&&e.jsx(fe,{loaderData:i,user:o,userProfileData:i.userProfile})})};export{Te as default};
