import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-DN9bEK-g.js";import{A as V,C as H}from"./ContentLayout-Ge08Qd1N.js";import{z as a,u as q,s as Z}from"./index-CORT_df8.js";import{I,B as K}from"./Input-B_aZf7-x.js";import{S as z}from"./Select-dg_cbP-x.js";import{m as W,n as $,h as Q,l as X,o as Y,p as ee,r as te}from"./lib-Beoi9XbN.js";import{g as se}from"./index-D_01F9sx.js";import{b as oe}from"./index-CFPekBpB.js";import{u as J}from"./NotificationContext-Bn-KUFn_.js";import{f as D,e as ne,a as ae}from"./WhiteLogo-Jdu1eOyO.js";import{u as re}from"./AuthContext-Di52-8xF.js";import"./MobileNav-BH38HMnf.js";import"./index-CCT4pt4V.js";import"./HomeNav-CTGmPU1H.js";const ce=a.object({first_name:a.string().min(1,{message:"Enter a first name"}),lastname:a.any(),country_code:a.any(),state_code:a.any(),city_id:a.any(),phone:a.any(),address_one:a.any(),address_two:a.any(),country:a.any(),xsocial:a.any(),linksocial:a.any(),fbsocial:a.any(),zipcode:a.any()}),le=({user:c,userProfileImageData:s})=>{const o="https://tynkpro.com",x=J();let p="";s!=null&&s.image_url&&(p=o+s.image_url);const[v,h]=t.useState(p),[y,S]=t.useState(null),P=t.useRef(null),[j,U]=t.useState(!1),[d,w]=t.useState(!1),u=()=>{var n;(n=P.current)==null||n.click()},A=n=>{var f;const m=(f=n.target.files)==null?void 0:f[0];if(m){const g=URL.createObjectURL(m);h(g),S(m),U(!0)}},E=async()=>{if(w(!0),x.notify("Working..."),await new Promise(n=>setTimeout(n,1e3)),j){const n=new FormData;n.append("file",y),n.append("guid",c.user_guid);const g="https://tynkpro.com"+"/user_profile_pic_upload";try{const C=await fetch(g,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:n});if(C.ok)x.alertReload("","Image uploaded successfully!");else{let _=C.json().then(r=>{x.alertCancel("",r.message)})}}catch{return}finally{w(!1)}}else x.alertCancel("","Please select an image to continue."),w(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-blue-100 w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden
                flex place-content-center place-items-center`,children:[v!==""?e.jsx("img",{src:v,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}):e.jsx(se,{className:"object-cover w-[70%] h-[70%]"}),e.jsx("input",{type:"file",accept:"image/*",ref:P,className:" hidden",onChange:A}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:u,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(oe,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${d?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:E,disabled:d,children:d?"Uploading...":"Upload"})})]})},ie=({loaderData:c,user:s,userProfileData:o})=>{var M,O;const[x,p]=t.useState(null),[v,h]=t.useState(!1),y=J(),S=c.countries;let[P,j]=t.useState(c.states),[U,d]=t.useState(c.cities);c.categories;const[w,u]=t.useState((M=c.userProfileData)==null?void 0:M.country_code),[A,E]=t.useState((O=c.userProfileData)==null?void 0:O.state_code),[n,m]=t.useState(""),[f,g]=t.useState(""),C=async l=>{u(l),m(l);const N=await W(l);j(N),_("")},_=async l=>{E(l),g(l);const N=await $(w,l);d(N)},r=l=>{let N=l.target.value,F=l.target.name;p(B=>({...B,[F]:N}))},k=async l=>{h(!0),y.notify("Updating user profile..."),await new Promise(b=>setTimeout(b,1e3));const N="https://tynk.cc",F="/api/user/"+s.guid,B=N+F;try{const b=await fetch(B,{method:"PUT",headers:Q,body:JSON.stringify(l)});if(b.ok)y.alertReload("Success","Update is Successful!");else{var G=await b.json();throw new Error(`Error Code: ${b.status} - ${G.error}`)}}catch(b){y.alertCancel("Error",b.message);return}finally{h(!1)}},{register:i,handleSubmit:L,getValues:de,setValue:T,watch:ue,setError:me,formState:{errors:R,isSubmitting:fe}}=q({defaultValues:o,resolver:Z(ce)});return t.useEffect(()=>{n&&(T("state_code",""),T("city_id",""))},[n]),t.useEffect(()=>{f&&T("city_id","")},[f]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:D,children:e.jsxs("div",{className:`${ne} flex flex-col place-items-center`,children:[e.jsx("div",{className:ae,children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(le,{user:o,userProfileImageData:c.userProfileImageData})})]})}),e.jsx("hr",{}),e.jsx("form",{onSubmit:L(k),children:e.jsxs("div",{className:`${D} mt-0  rounded-lg pt-4
                 max-w-[400px] w-full mx-auto `,children:[e.jsx(I,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:i,changeHandler:r,error:R.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(I,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:i,changeHandler:r,error:R.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx(z,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:S,register:i,changeHandler:r,error:R.country_code,setCode:C,controlInformation:"Please select country. "}),e.jsx(z,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:P,register:i,changeHandler:r,setCode:_,controlInformation:"Please select state. "}),e.jsx(z,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:U,register:i,changeHandler:r,controlInformation:"Please select a city. "}),e.jsx(I,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:i,changeHandler:r,controlInformation:"Please a zipcode. "}),e.jsx(I,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:i,changeHandler:r,controlInformation:"Please enter a phone or mobile. "}),e.jsx(I,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:i,changeHandler:r,controlInformation:"Please enter an address. "}),e.jsx(I,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:i,changeHandler:r,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(K,{working:v})]})})]})},Ie=()=>{const c=re();if(!c)return null;const{user:s}=c,[o,x]=t.useState(null),[p,v]=t.useState(null),[h,y]=t.useState(null),[S,P]=t.useState(null),[j,U]=t.useState(null),[d,w]=t.useState(null),[u,A]=t.useState(null),[E,n]=t.useState(!0);return t.useEffect(()=>{async function m(f){const g=await X(f||""),C=await Y(),_=g,r=await W(_.country_code||""),k=await $(_.country_code||"",_.state_code||""),i=await ee(),L=await te(f||"");x(g),y(C),v(r),P(k),U(L),w(i)}s!=null&&s.guid&&m(s==null?void 0:s.guid)},[s==null?void 0:s.guid]),t.useEffect(()=>{o&&h&&p&&S&&j&&d&&A({userProfile:o,countries:h,states:p,cities:S,userProfileImageData:j,categories:d})},[d,h,p,S,j,o]),t.useEffect(()=>{u&&n(!1)},[u]),E?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(V,{children:e.jsx(H,{title:"Account Profile",children:o&&u&&s&&!E?e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold mb-2 text-md",children:[o==null?void 0:o.first_name," ",o==null?void 0:o.lastname]}),e.jsx(ie,{loaderData:u,user:s,userProfileData:u.userProfile})]}):e.jsx("div",{children:"Loading..."})})})};export{Ie as default};
