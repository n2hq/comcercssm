import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as a}from"./components-kAvIA9Ge.js";import{A as C,C as v}from"./ContentLayout-BZVXqL1o.js";import{k as S,p as E,u as I,t as R}from"./index-BXHtOMuL.js";import{z as i,u as T,s as A}from"./index-CLh2UBG4.js";import{I as x,B as L}from"./Input-CazsMSW4.js";import{f as U,g as k}from"./MobileNav-DSoEjn7G.js";import{u as V}from"./NotificationContext-DyVriLyu.js";import"./Hamburger-D7h4OXGR.js";import"./HomeNav-aEovIiAp.js";const P=new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!()Â£@$%^&*-]).{8,}$/),B=i.object({oldpassword:i.string().min(1,{message:"Please enter old password."}).min(8,{message:"Password must be up to 8 characters."}).regex(P,{message:"Please enter a valid password"}),newpassword:i.string().min(1,{message:"Please enter new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(P,{message:"Please enter a valid password"}),newpassword2:i.string().min(1,{message:"Please retype new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(P,{message:"Please enter a valid password"})}).superRefine((e,r)=>{e.oldpassword===e.newpassword&&r.addIssue({code:i.ZodIssueCode.custom,path:["newpassword"],message:"New password cannot be the same as old password"}),e.newpassword!==e.newpassword2&&r.addIssue({code:i.ZodIssueCode.custom,path:["newpd2"],message:"Your new password don't match"})}),F=({loaderData:e,user:r})=>{var b;const[j,t]=a.useState(null),[p,m]=a.useState(!1),n=V(),l=o=>{let f=o.target.value,h=o.target.name;t(w=>({...w,[h]:f}))},u=async o=>{var w;m(!0),n.notify("In progress..."),await new Promise(d=>setTimeout(d,1e3));const f="/api/user/change_password/"+((w=e.userProfile)==null?void 0:w.user_guid),h=E.BASE_URL+f;o.password=o==null?void 0:o.newpassword,delete o.oldpassword,delete o.newpassword,delete o.newpassword2;try{const d=await fetch(h,{method:"PUT",headers:S,body:JSON.stringify(o)});if(d.ok)n.alertReload("Success","Password Successfully Changed! Use new password on next login");else{let D=d.json().then(N=>{n.alertCancel("",N.message)})}}catch(d){n.alertCancel("",d.message)}finally{m(!1)}},{register:c,handleSubmit:y,getValues:W,setValue:Z,watch:_,setError:$,formState:{errors:g,isSubmitting:z}}=T({defaultValues:e.listing,resolver:A(B)});return s.jsx("form",{onSubmit:y(u),children:s.jsx("div",{className:`${U} mt-0  
            rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:s.jsxs("div",{className:k,children:[s.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Change Password"}),s.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[s.jsx("b",{children:(b=e.userProfile)==null?void 0:b.email})," is your current email. It will be used be used for password resets or changes."]}),s.jsx("div",{className:"mt-[20px]"}),s.jsx(x,{controlTitle:"Current Password",controlPlaceholder:"Enter current password",controlType:"password",controlName:"oldpassword",register:c,changeHandler:l,error:g.oldpassword}),s.jsx(x,{controlTitle:"New Password",controlType:"password",controlPlaceholder:"Enter new password",controlName:"newpassword",register:c,changeHandler:l,error:g.newpassword}),s.jsx(x,{controlTitle:"Retype New Password",controlPlaceholder:"Retype new password",controlName:"newpassword2",controlType:"password",register:c,changeHandler:l,error:g.newpassword2}),s.jsx(L,{working:p})]})})})},ee=()=>{const{user:e}=I(),[r,j]=a.useState(null),[t,p]=a.useState(null),[m,n]=a.useState(!0);return a.useEffect(()=>{async function l(u){const c=await R(u||"");j(c)}e!=null&&e.guid&&l(e==null?void 0:e.guid)},[e==null?void 0:e.guid]),a.useEffect(()=>{r&&p({userProfile:r})},[r]),a.useEffect(()=>{t&&n(!1)},[t]),m?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(C,{children:s.jsxs(v,{title:"Change Password",children:[r===null?"Loading...":"",s.jsx("div",{className:"font-semibold mb-2 text-md",children:r==null?void 0:r.email}),t&&s.jsx(F,{loaderData:t,user:e})]})})};export{ee as default};
