import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-qdL6XBti.js";import{A as E,C as N}from"./ContentLayout-BxrbsZcp.js";import{u as P}from"./AuthContext-BnCYfHn3.js";import{Q as b,I as C,P as R}from"./lib-Vg6a-bJE.js";import{u as A,s as I}from"./zod-g2XesUsp.js";import{I as L,B as T}from"./Input-BrM5rnni.js";import{z as S}from"./index-C4bLmoCR.js";import{f as D,g as F}from"./WhiteLogo-CmRTgcFd.js";import{u as V}from"./NotificationContext-jkHr5VFO.js";import{C as W}from"./CardHeader-BiYrjiNN.js";import"./UserMenu-C8vdknC1.js";import"./index-Cj0zFx3r.js";import"./HomeNav-DdgaWdh1.js";import"./SrchNavbar-8eek0ggc.js";import"./json-CfA3Rlrt.js";import"./CardTitle-BY0Ps6Ga.js";const k=S.object({email:S.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),B=({loaderData:i,user:t})=>{var h;const[a,d]=s.useState(null),[o,l]=s.useState(!1),n=V(),r=P();if(!r)return null;const u=p=>{let w=p.target.value,g=p.target.name;d(c=>({...c,[g]:w}))},m=async p=>{var j;l(!0),n.notify("Sending reset password request."),await new Promise(x=>setTimeout(x,1e3));const g={email:(j=r==null?void 0:r.user)==null?void 0:j.email.trim()},c=await r.resetpw(g);JSON.stringify(c).includes("Error")?(l(!1),n.alertCancel("",b(c))):(n.alertCancel("",b(c)),await new Promise(x=>setTimeout(x,1e3)),l(!1))},{register:f,handleSubmit:y,getValues:H,setValue:U,watch:q,setError:z,formState:{errors:v,isSubmitting:J}}=A({defaultValues:i.userProfile,resolver:I(k)});return e.jsx("form",{onSubmit:y(m),children:e.jsx("div",{className:`${D} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:F,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(h=i.userProfile)==null?void 0:h.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(L,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:f,changeHandler:u,error:v.email}),e.jsx(T,{working:o,value:"Send Reset Email"})]})})})},le=()=>{s.useEffect(()=>{C(localStorage)},[]);const i=P();if(!i)return null;const{user:t}=i,[a,d]=s.useState(null),[o,l]=s.useState(null),[n,r]=s.useState(!0);return s.useEffect(()=>{async function u(m){const f=await R(m||"");d(f)}try{t!=null&&t.guid&&u(t==null?void 0:t.guid)}catch(m){console.log(m.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{a&&l({userProfile:a})},[a]),s.useEffect(()=>{o&&r(!1)},[o]),n?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(E,{children:e.jsxs(N,{title:"Reset Password",children:[a===null?"Loading...":"",e.jsx(W,{base_url:"/web/account/profile",title:a==null?void 0:a.email}),o&&e.jsx(B,{loaderData:o,user:t})]})})};export{le as default};
