import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as o,c as Q}from"./components-Bk2QJ2_x.js";import{A as X,C as ee}from"./ContentLayout-BeYjVuwK.js";import{u as se}from"./AuthContext-ClW6sHFY.js";import{j as J,A as V,D as G,h as te,I as oe,y as re,f as ne,E as ae,H as ie,M as le,N as ce}from"./lib-b8ou2Urd.js";import{z as t,u as ue,s as de}from"./index-BH1rD2l9.js";import{b as me}from"./index-CaK4Np1I.js";import{u as Z}from"./NotificationContext-DVKa4Cs6.js";import{f as H,e as fe,a as ge}from"./WhiteLogo-cBTi0kEn.js";import{I as g,B as he}from"./Input-BkUqjZ-6.js";import{T as $}from"./TextareaWithWordLimit-DhwYv1qi.js";import{S as W}from"./Select-D2hnRqJZ.js";import{b as pe}from"./json-DSHujVEz.js";import{B as be,a as xe}from"./BusinessHeader-CdtMAgP4.js";import"./UserMenu-Qz3FSf7r.js";import"./index-Bacbrlt4.js";import"./HomeNav-CQDjG9_r.js";import"./SrchNavbar-tnOjiheL.js";import"./HamburgerSecondary-u7E3-61-.js";import"./index-DchK8fR3.js";import"./CardTitle-e_7rmtxE.js";const ye=t.object({username:t.any(),email_address:t.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:t.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:t.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:t.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:t.string().refine(s=>s.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(s=>s.trim().split(/\s+/).filter(Boolean).length<=50,{message:"You can only write up to 50 words."}),long_description:t.string().refine(s=>s.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:t.any(),state_code:t.any(),state_text:t.any(),country_text:t.any(),city_id:t.any(),established:t.string({message:"Please enter year established"}).min(4,{message:"Year must be at least 4 characters"}),call_code:t.any(),phone:t.any(),zipcode:t.any(),intro:t.any(),category:t.string().min(2,{message:"Please select a business category"}),business_phrases:t.union([t.literal(""),t.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:t.any(),services:t.any(),xsocial:t.any(),fbsocial:t.any(),linksocial:t.any(),website:t.union([t.string().url().nullish(),t.literal("")])}).superRefine((s,m)=>{var l,c;((l=s==null?void 0:s.address_two)==null?void 0:l.length)!==0&&((c=s==null?void 0:s.address_two)==null?void 0:c.length)<3&&m.addIssue({code:t.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),we=({listing:s,user:m,businessProfileImageData:l})=>{let c="";l.image_url?c=J.IMG_BASE_URL+l.image_url:c="/images/imgplaceholder.jpg";const[E,j]=o.useState(c),[I,A]=o.useState(null),p=o.useRef(null),[T,_]=o.useState(!1),[N,y]=o.useState(!1),w=Z(),C=()=>{var u;(u=p.current)==null||u.click()},B=u=>{var P;const d=(P=u.target.files)==null?void 0:P[0];if(d){const f=URL.createObjectURL(d);j(f),A(d),_(!0)}},v=async()=>{y(!0),w.notify("Working..."),await new Promise(d=>setTimeout(d,1e3));const u=new FormData;if(T){u.append("file",I),u.append("guid",m.user_guid),u.append("bid",s.gid);const P=J.IMG_BASE_URL+"/business_profile_pic_upload";try{const f=await fetch(P,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:u});if(f.ok)w.alertReload("","Image uploaded successfully!");else{let D=f.json().then(b=>{w.alertCancel("",b.message)})}}catch{return}finally{y(!1)}}else w.alertCancel("","Please select an image to continue."),y(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden",children:[e.jsx("img",{src:E,alt:"Click to upload",className:" object-cover w-full h-full z-0 absolute"}),e.jsx("input",{type:"file",accept:"image/*",ref:p,className:" hidden",onChange:B}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:C,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out`,children:e.jsx(me,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`${N?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:v,disabled:N,children:N?"Uploading...":"Upload"})})]})},Pe=({data:s})=>{var O;const[m,l]=o.useState(null),[c,E]=o.useState(!1),j=Z(),[I,A]=o.useState(null),p=s.countries;let[T,_]=o.useState(s.states),[N,y]=o.useState(s.cities);const w=(O=pe)==null?void 0:O.sort((i,h)=>i.name.localeCompare(h.name)),[C,B]=o.useState(s.businessProfile.country_code),[v,u]=o.useState(s.businessProfile.state_code),[d,P]=o.useState(""),[f,D]=o.useState(""),b=async i=>{B(i),P(i);const h=await V(i);_(h),U("")},U=async i=>{u(i),D(i);const h=await G(C,i);y(h)},r=i=>{let h=i.target.value,F=i.target.name;l(S=>({...S,[F]:h}))},L=async i=>{E(!0),j.notify("Updating business profile..."),await new Promise(S=>setTimeout(S,1e3));const h="/api/listing/"+s.businessProfile.gid,F=J.BASE_URL+h;try{const S=await fetch(F,{method:"PUT",headers:te,body:JSON.stringify(i)});if(S.ok)j.alertReload("Success!","Successfully updated!");else{const q=await S.text(),K=JSON.parse(q);throw new Error(`${K.error}`)}}catch(S){j.alertCancel("Unsuccessful",S.message)}finally{E(!1)}},{register:n,handleSubmit:k,getValues:R,setValue:x,watch:M,setError:z,formState:{errors:a,isSubmitting:Y}}=ue({defaultValues:s.businessProfile,resolver:de(ye)});return o.useEffect(()=>{s.businessProfile&&(x("state_code",s.businessProfile.state_code),x("city_id",s.businessProfile.city_id))},[s.businessProfile]),o.useEffect(()=>{d&&(x("state_code",""),x("city_id",""))},[d,s]),o.useEffect(()=>{f&&x("city_id","")},[f]),e.jsx("div",{children:e.jsxs("div",{className:H,children:[e.jsxs("div",{className:`${fe} flex flex-col place-items-center`,children:[e.jsx("div",{className:ge,children:"Add/Change Photo"}),e.jsx("div",{className:"mt-4",children:e.jsx(we,{listing:s.businessProfile,user:s.userProfile,businessProfileImageData:s.businessProfileImageData})})]}),e.jsx("hr",{className:"w-full"}),e.jsx("form",{className:" w-full",onSubmit:k(L),children:e.jsxs("div",{className:`${H} mt-0  rounded-lg pt-4
                                lg:max-w-[500px] w-full mx-auto  `,children:[e.jsx(g,{controlTitle:"Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:r,error:a.username,controlInformation:"Choose a username. "}),e.jsx(g,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:r,error:a.email_address,controlInformation:"Email address is compulsory."}),e.jsx(g,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:r,error:a.title,controlInformation:"Please enter page name. Page name is compulsory. "}),e.jsx(g,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:r,error:a.established,controlInformation:"This is the name the business was registered or started "}),e.jsx(W,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:p,register:n,changeHandler:r,error:a.country_code,setCode:b,controlInformation:"This is the country the business was registered. "}),e.jsx(W,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:T,register:n,changeHandler:r,error:a.state_code,setCode:U,controlInformation:"This is the state the business was registered. "}),e.jsx(W,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:N,register:n,changeHandler:r,error:a.city_id,controlInformation:"This is the city the business was registered. "}),e.jsx(g,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:r,error:a.address_one,width:100,controlInformation:"Contact address for the business. "}),e.jsx(g,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:r,error:a.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),e.jsx(g,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:r,error:a.zipcode,controlInformation:"Enter the zipcode. "}),e.jsx(g,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:r,error:a.phone,controlInformation:"Mobile number or phoone number. "}),e.jsx(W,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:w,register:n,changeHandler:r,error:a.category}),e.jsx(g,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:n,changeHandler:r,error:a.business_phrases}),e.jsx(g,{controlTitle:"Products",controlPlaceholder:"Enter products",controlName:"products",register:n,changeHandler:r,error:a.products}),e.jsx(g,{controlTitle:"Services",controlPlaceholder:"Enter services",controlName:"services",register:n,changeHandler:r,error:a.services}),e.jsx($,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:r,error:a.short_description,setValue:x,getValues:R,watch:M}),e.jsx($,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:r,error:a.long_description,setValue:x,getValues:R,watch:M}),e.jsx(g,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:r,error:a.website}),e.jsx(he,{working:c})]})})]})})},Je=()=>{var r;o.useEffect(()=>{oe(localStorage)},[]);const s=Q(),m=se();if(!m)return null;const l=s.business_guid,c=(r=m==null?void 0:m.user)==null?void 0:r.guid,[E,j]=o.useState(!0),[I,A]=o.useState(null),[p,T]=o.useState(null),[_,N]=o.useState(null),[y,w]=o.useState(null),[C,B]=o.useState(null),[v,u]=o.useState(null),[d,P]=o.useState(null),[f,D]=o.useState(null),[b,U]=o.useState(null);return o.useEffect(()=>{async function L(n,k){const R=await re(n||""),x=await ne(k||""),M=await ae(),z=x,a=await V(z.country_code||""),Y=await G(z.country_code||"",z.state_code||""),O=await ie(),i=await le(n||""),h=await ce(k||"");A(R),T(x),w(M),N(a),B(Y),u(i),P(h),D(O)}c&&l&&L(c,l)},[c,l]),o.useEffect(()=>{I&&p&&y&&_&&C&&v&&f&&d&&U({userProfile:I,businessProfile:p,countries:y,states:_,cities:C,userProfileImageData:v,businessProfileImageData:d,categories:f})},[f,y,_,C,v,d,I,p]),o.useEffect(()=>{b&&j(!1)},[b]),E?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(X,{children:e.jsxs(ee,{title:"Update Business",businessGuid:l,data:b,businessProfile:p,children:[e.jsx(be,{businessGuid:l,data:b,businessProfile:p}),b&&e.jsxs("div",{children:[l&&c&&e.jsx(xe,{guid:l,userGuid:c}),e.jsx(Pe,{data:b})]})]})})};export{Je as default};
