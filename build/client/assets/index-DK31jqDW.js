import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-CooaLra5.js";import{A as N,C as P}from"./ContentLayout-nkga6CC2.js";import{u as A}from"./AuthContext-a-szS8iM.js";import{h as L,e as I,I as R,O as U}from"./lib-BhfUFVcs.js";import{u as _,s as q}from"./zod-CNQGm8c5.js";import{I as k,B}from"./Input-LKsXFt_f.js";import{z as S}from"./index-C4bLmoCR.js";import{f as F,g as O}from"./WhiteLogo-Dr6RRIef.js";import{u as T}from"./NotificationContext-BC1zLXan.js";import{C as V}from"./CardHeader-i8vu4Aui.js";import"./UserMenu-DPGD_Nj9.js";import"./index-C-tqg277.js";import"./index-DSqZvp0J.js";import"./HomeNav-Dv8GUi4i.js";import"./SrchNavbar-C92ikz5O.js";import"./json-hcEJPlxz.js";import"./index-Dmq_GUIc.js";import"./HamburgerSecondary-DUkaVWm8.js";import"./CardTitle-0ozTtK0F.js";const W=S.object({email:S.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),H=({loaderData:a,user:t})=>{var h,j;const[r,u]=s.useState(null),[i,l]=s.useState(!1),o=T(),[x,d]=s.useState(!0),f=n=>{let E=n.target.value,g=n.target.name;u(c=>({...c,[g]:E}))},p=async n=>{var c,b;if(l(!0),o.notify("","Updating email..."),await new Promise(m=>setTimeout(m,1e3)),n.email===((c=a.userProfile)==null?void 0:c.email))return o.alertCancel("Email is the same.","Enter a different email to continue."),l(!1),!1;const g=I.BASE_URL+"/api/user/change_email_request";n.guid=(b=a.userProfile)==null?void 0:b.user_guid;try{const m=await fetch(g,{method:"POST",headers:L,body:JSON.stringify(n)});if(m.ok)o.alertCancel("Email Change Request","Email Change Request Successfully Sent!");else{let K=m.json().then(C=>{o.alertCancel("Error",C.error)})}}catch{return}finally{l(!1)}},{register:y,handleSubmit:v,getValues:z,setValue:J,watch:$,setError:D,formState:{errors:w,isSubmitting:G}}=_({defaultValues:a.listing,resolver:q(W)});return e.jsx("form",{onSubmit:v(p),children:e.jsx("div",{className:`${F} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:O,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(h=a.userProfile)==null?void 0:h.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-[8px] px-3 py-3 bg-gray-100",children:[(j=a.userProfile)==null?void 0:j.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(k,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:y,changeHandler:f,error:w.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(B,{working:i})]})})})},ge=()=>{s.useEffect(()=>{R(localStorage)},[]);const a=A();if(!a)return null;const{user:t}=a,[r,u]=s.useState(null),[i,l]=s.useState(null),[o,x]=s.useState(!0);return s.useEffect(()=>{async function d(f){const p=await U(f||"");u(p)}t!=null&&t.guid&&d(t==null?void 0:t.guid)},[t==null?void 0:t.guid]),s.useEffect(()=>{r&&l({userProfile:r})},[r]),s.useEffect(()=>{i&&x(!1)},[i]),o?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(N,{children:e.jsxs(P,{title:"Email Address",children:[r===null?"Loading...":"",e.jsx(V,{base_url:"/web/account/profile",title:r==null?void 0:r.email}),e.jsx("div",{className:"font-semibold mb-2 text-md"}),i&&e.jsx(H,{loaderData:i,user:t})]})})};export{ge as default};
